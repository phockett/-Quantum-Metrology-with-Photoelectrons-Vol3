%% Generated by Sphinx.
\def\sphinxdocclass{jupyterBook}
\documentclass[letterpaper,10pt,english]{jupyterBook}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}
%% turn off hyperref patch of \index as sphinx.xdy xindy module takes care of
%% suitable \hyperpage mark-up, working around hyperref-xindy incompatibility
\PassOptionsToPackage{hyperindex=false}{hyperref}
%% memoir class requires extra handling
\makeatletter\@ifclassloaded{memoir}
{\ifdefined\memhyperindexfalse\memhyperindexfalse\fi}{}\makeatother

\PassOptionsToPackage{warn}{textcomp}

\catcode`^^^^00a0\active\protected\def^^^^00a0{\leavevmode\nobreak\ }
\usepackage{cmap}
\usepackage{fontspec}
\defaultfontfeatures[\rmfamily,\sffamily,\ttfamily]{}
\usepackage{amsmath,amssymb,amstext}
\usepackage{polyglossia}
\setmainlanguage{english}



\setmainfont{FreeSerif}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Italic,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldItalic
]
\setsansfont{FreeSans}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]
\setmonofont{FreeMono}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]



\usepackage[Bjarne]{fncychap}
\usepackage[,numfigreset=1,mathnumfig]{sphinx}

\fvset{fontsize=\small}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}

\addto\captionsenglish{\renewcommand{\contentsname}{Frontmatter}}

\usepackage{sphinxmessages}



        % Start of preamble defined in sphinx-jupyterbook-latex %
         \usepackage[Latin,Greek]{ucharclasses}
        \usepackage{unicode-math}
        % fixing title of the toc
        \addto\captionsenglish{\renewcommand{\contentsname}{Contents}}
        \hypersetup{
            pdfencoding=auto,
            psdextra
        }
        % End of preamble defined in sphinx-jupyterbook-latex %
        

\title{Quantum Metrology with Photoelectrons Vol. 3 *Analysis methodologies*}
\date{Nov 10, 2022}
\release{}
\author{Paul Hockett}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{intro::doc}}


\sphinxAtStartPar
Quantum Metrology with Photoelectrons Volume 3: \sphinxstyleemphasis{Analysis
methodologies}, an open source executable book. This repository contains the source documents (mainly Jupyter Notebooks in Python) and notes for the book, as of Jan 2022 writing is in progress, and the \sphinxhref{https://phockett.github.io/Quantum-Metrology-with-Photoelectrons-Vol3/}{current HTML build can be found online}. The book is due to be finished in 2023, and will be published by IOP Press \sphinxhyphen{} see below for more details.

\begin{DUlineblock}{0em}
\item[] \sphinxstylestrong{\Large Series abstract}
\end{DUlineblock}

\sphinxAtStartPar
Photoionization is an interferometric process, in which multiple paths can contribute to the final continuum photoelectron wavefunction. At the simplest level, interferences between different final angular momentum states are manifest in the energy and angle resolved photoelectron spectra: metrology schemes making use of these interferograms are thus phase\sphinxhyphen{}sensitive, and provide a powerful route to detailed understanding of photoionization. In these cases, the continuum wavefunction (and underlying scattering dynamics) can be characterised. At a more complex level, such measurements can also provide a powerful probe for other processes of interest, leading to a more general class of quantum metrology built on phase\sphinxhyphen{}sensitive photoelectron imaging.  Since the turn of the century, the increasing availability of photoelectron imaging experiments, along with the increasing sophistication of experimental techniques, and the availability of computational resources for analysis and numerics, has allowed for significant developments in such photoelectron metrology.

\begin{DUlineblock}{0em}
\item[] \sphinxstylestrong{\large About the books}
\end{DUlineblock}

\sphinxAtStartPar
\sphinxincludegraphics{{mock_covers_2vol_020318}.png}
\begin{itemize}
\item {} 
\sphinxAtStartPar
Volume I covers the core physics of photoionization, including a range of computational examples. The material is presented as both reference and tutorial, and should appeal to readers of all levels. ISBN 978\sphinxhyphen{}1\sphinxhyphen{}6817\sphinxhyphen{}4684\sphinxhyphen{}5, \sphinxurl{http://iopscience.iop.org/book/978-1-6817-4684-5} (IOP Press, 2018)

\item {} 
\sphinxAtStartPar
Volume II explores applications, and the development of quantum metrology schemes based on photoelectron measurements. The material is more technical, and will appeal more to the specialist reader. ISBN 978\sphinxhyphen{}1\sphinxhyphen{}6817\sphinxhyphen{}4688\sphinxhyphen{}3, \sphinxurl{http://iopscience.iop.org/book/978-1-6817-4688-3} (IOP Press, 2018)

\end{itemize}

\sphinxAtStartPar
Additional online resources for Vols. I \& II can be found on \sphinxhref{https://osf.io/q2v3g/wiki/home/}{OSF} and \sphinxhref{https://github.com/phockett/Quantum-Metrology-with-Photoelectrons}{Github}.
\begin{itemize}
\item {} 
\sphinxAtStartPar
Volume III in the series will continue this exploration, with a focus on numerical analysis techniques, forging a closer link between experimental and theoretical results, and making the methodologies discussed directly accessible via new software. The book is due for publication by IOP due in 2023; this volume is also open\sphinxhyphen{}source, with a live HTML version at \sphinxurl{https://phockett.github.io/Quantum-Metrology-with-Photoelectrons-Vol3/} and source available at \sphinxurl{https://github.com/phockett/Quantum-Metrology-with-Photoelectrons-Vol3}.

\end{itemize}

\sphinxAtStartPar
For some additional details and motivations (including topical video), see \sphinxhref{https://phockett.github.io/ePSdata/about.html\#Motivation}{the ePSdata project}.

\begin{DUlineblock}{0em}
\item[] \sphinxstylestrong{\large Technical details}
\end{DUlineblock}

\sphinxAtStartPar
This repository contains:
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{doc\sphinxhyphen{}source}}: the source documents (mainly Jupyter Notebooks in Python)

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{notes}}: additional notes for the book,

\item {} 
\sphinxAtStartPar
the \sphinxcode{\sphinxupquote{gh\sphinxhyphen{}pages}} branch contains the current HTML build, also available at \sphinxurl{https://phockett.github.io/Quantum-Metrology-with-Photoelectrons-Vol3/}

\end{itemize}

\sphinxAtStartPar
The project has been setup to use the \sphinxhref{https://jupyterbook.org/}{Jupyter Book} build\sphinxhyphen{}chain (which uses Sphinx on the back\sphinxhyphen{}end) to generate HTML and Latex outputs for publication from source Jupyter notebooks \& markdown files.

\sphinxAtStartPar
The work \sphinxstyleemphasis{within} the book will make use of the \sphinxhref{https://pemtk.readthedocs.io/en/latest/about.html}{Photoelectron Metrology Toolkit} platform for working with experimental \& theoretical data.

\sphinxAtStartPar
\sphinxincludegraphics{{ccdcf3feb912fb992ab79da89d86a2521bfe1c21}.png}

\begin{DUlineblock}{0em}
\item[] \sphinxstylestrong{\large Running code examples}
\end{DUlineblock}

\sphinxAtStartPar
Each Jupyter notebook (\sphinxcode{\sphinxupquote{*.ipynb}}) can be treated as a stand\sphinxhyphen{}alone computational document. These can be run/used/modified independently with an appropriately setup python environment (details to follow).

\begin{DUlineblock}{0em}
\item[] \sphinxstylestrong{\large Building the book}
\end{DUlineblock}

\sphinxAtStartPar
The full book can also be built from source:
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Clone this repository

\item {} 
\sphinxAtStartPar
Run \sphinxcode{\sphinxupquote{pip install \sphinxhyphen{}r requirements.txt}} (it is recommended you do this within a virtual environment)

\item {} 
\sphinxAtStartPar
(Optional) Edit the books source files located in the \sphinxcode{\sphinxupquote{doc\sphinxhyphen{}source/}} directory

\item {} 
\sphinxAtStartPar
Run \sphinxcode{\sphinxupquote{jupyter\sphinxhyphen{}book clean doc\sphinxhyphen{}source/}} to remove any existing builds

\item {} 
\sphinxAtStartPar
For an HTML build:
\begin{itemize}
\item {} 
\sphinxAtStartPar
Run \sphinxcode{\sphinxupquote{jupyter\sphinxhyphen{}book build doc\sphinxhyphen{}source/}}

\item {} 
\sphinxAtStartPar
A fully\sphinxhyphen{}rendered HTML version of the book will be built in \sphinxcode{\sphinxupquote{doc\sphinxhyphen{}source/\_build/html/}}.

\end{itemize}

\item {} 
\sphinxAtStartPar
For a LaTex \& PDF build:
\begin{itemize}
\item {} 
\sphinxAtStartPar
Run \sphinxcode{\sphinxupquote{jupyter\sphinxhyphen{}book build doc\sphinxhyphen{}source/ \sphinxhyphen{}\sphinxhyphen{}builder pdflatex}}

\item {} 
\sphinxAtStartPar
A fully\sphinxhyphen{}rendered HTML version of the book will be built in \sphinxcode{\sphinxupquote{doc\sphinxhyphen{}source/\_build/latex/}}.

\end{itemize}

\end{enumerate}

\sphinxAtStartPar
See \sphinxurl{https://jupyterbook.org/basics/building/index.html} for more information.

\begin{DUlineblock}{0em}
\item[] \sphinxstylestrong{\large Credits}
\end{DUlineblock}

\sphinxAtStartPar
This project is created using the open source \sphinxhref{https://jupyterbook.org/}{Jupyter Book project} and the \sphinxhref{https://github.com/executablebooks/cookiecutter-jupyter-book}{executablebooks/cookiecutter\sphinxhyphen{}jupyter\sphinxhyphen{}book template}.

\sphinxAtStartPar
To add: build env \& main software packages (see automation for this…)

\sphinxAtStartPar
\sphinxincludegraphics{{logo}.png}

\sphinxstepscope


\part{Frontmatter}

\sphinxstepscope


\chapter{Overview}
\label{\detokenize{frontmatter/overview_270122:overview}}\label{\detokenize{frontmatter/overview_270122::doc}}

\section{General overview}
\label{\detokenize{frontmatter/overview_270122:general-overview}}
\sphinxAtStartPar
Vol. 3. will focus on analysis techniques for quantum metrology with photoelectrons, including:
\begin{itemize}
\item {} 
\sphinxAtStartPar
Interpreting experimental data.

\item {} 
\sphinxAtStartPar
Extraction/reconstruction/determination of quantum mechanical properties (matrix elements, wavefunctions, density matrices) from experimental data.

\item {} 
\sphinxAtStartPar
Comparison of experimental and theoretical data.

\item {} 
\sphinxAtStartPar
New analysis methodologies \& techniques.

\item {} 
\sphinxAtStartPar
Introduction to newly\sphinxhyphen{}developed software platform (see below).

\end{itemize}


\section{Provisional contents}
\label{\detokenize{frontmatter/overview_270122:provisional-contents}}

\subsection{Part 1: theory \& software}
\label{\detokenize{frontmatter/overview_270122:part-1-theory-software}}
\sphinxAtStartPar
General review \& update of the topic, including recent theory developments.
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Introduction

\sphinxAtStartPar
a.  Topic overview.

\sphinxAtStartPar
b.  Context of vol. 3 (following vols. 1 \& 2).

\sphinxAtStartPar
c.  Aims: Vol. 3 in the series will continue the exploration of quantum metrology with photoelectrons, with a focus on numerical analysis techniques, forging a closer link between experimental and theoretical results, and making the methodologies discussed directly accessible via a new software platform/ecosystem.

\item {} 
\sphinxAtStartPar
Quantum metrology software platform/ecosystem overview

\sphinxAtStartPar
a.  Introduction to python packages for simulation, data analysis, and open\sphinxhyphen{}data.

\sphinxAtStartPar
b.  Photoelectron metrology toolkit (PEMtk) package/platform for experimental data processing \& analysis. (See \sphinxhref{https://pemtk.readthedocs.io}{\sphinxstyleemphasis{pemtk.readthedocs.io}}.)

\sphinxAtStartPar
c.  ePSproc package for theory \& simulation. (See \sphinxhref{https://epsproc.readthedocs.io}{\sphinxstyleemphasis{epsproc.readthedocs.io}}.)

\sphinxAtStartPar
d.  ePSdata platform for data/results library (see \sphinxhref{https://phockett.github.io/ePSdata/about.html\#Motivation}{\sphinxstyleemphasis{ePSdata motivations}}).

\item {} 
\sphinxAtStartPar
General method development: geometric tensor treatment of
photoionization, fitting \& matrix\sphinxhyphen{}inversion techniques

\sphinxAtStartPar
a.  Theory development overview \sphinxhyphen{} tensor methods (e.g. \sphinxhref{https:///epsproc.readthedocs.io/en/latest/methodsgeometric\_method\_dev\_pt3\_AFBLM\_090620\_010920\_dev\_bk100920.html}{\sphinxstyleemphasis{ePSproc tensor methods}})

\sphinxAtStartPar
b.  Direct molecular frame reconstruction via matrix\sphinxhyphen{}inversion methods (see Gregory, Margaret, Paul Hockett, Albert Stolow, and Varun Makhija. “Towards Molecular Frame Photoelectron Angular Distributions in Polyatomic Molecules from Lab Frame Coherent Rotational Wavepacket Evolution.” \sphinxstyleemphasis{Journal of Physics B: Atomic, Molecular and Optical Physics} 54, no. 14 (July 2021): 145601.\sphinxhref{https://doi.org/10.1088/1361-6455/ac135f}{\sphinxstyleemphasis{DOI: 10.1088/1361\sphinxhyphen{}6455/ac135f}}.)

\item {} 
\sphinxAtStartPar
Numerical implementation \& analysis platform tools

\sphinxAtStartPar
a.  Tensor methods implementation in ePSproc/PEMtk.

\sphinxAtStartPar
b.  Information content analysis (inc. basis\sphinxhyphen{}set exploration, e.g. \sphinxhref{https://pemtk.readthedocs.io/en/latest/fitting/PEMtk\_fitting\_basis-set\_demo\_050621\_full.html}{\sphinxstyleemphasis{PEMtk fitting demo}}), see also vol. 2, sect. 12.1.

\sphinxAtStartPar
c.  Density matrix analysis. (e.g. \sphinxhref{https://epsproc.readthedocs.io/en/dev/methods/density\_mat\_notes\_demo\_300821.html}{\sphinxstyleemphasis{ePSproc density matrix method dev notes}})

\sphinxAtStartPar
d.  Generalised bootstrapping implementation in PEMtk (see vol. 2, sects. 11.3 \& 12.3)

\end{enumerate}


\subsection{Part 2: numerical examples}
\label{\detokenize{frontmatter/overview_270122:part-2-numerical-examples}}
\sphinxAtStartPar
Open\sphinxhyphen{}source worked examples using the new software platform.
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Quantum metrology example: generalised bootstrapping for a homonuclear diatomic scattering system (N2)*

\sphinxAtStartPar
a.  Experimental data overview \& simulation.

\sphinxAtStartPar
b.  Matrix element extraction (bootstrap protocol, see vol. 2, sects. 11.3 \& 12.3) \& statistical analysis.

\sphinxAtStartPar
c.  Direct molecular frame reconstruction via matrix\sphinxhyphen{}inversion methods.

\sphinxAtStartPar
d.  Comparison of methods.

\sphinxAtStartPar
e.  Information content/quantum information analysis. (See vol. 2, sect. 12.1.)

\item {} 
\sphinxAtStartPar
Quantum metrology example: generalised bootstrapping for a heteronuclear scattering system (CO)*

\sphinxAtStartPar
a.  Experimental data overview \& simulation.

\sphinxAtStartPar
b.  Matrix element extraction (bootstrap protocol, see vol. 2, sects. 11.3 \& 12.3) \& statistical analysis.

\sphinxAtStartPar
c.  Direct molecular frame reconstruction via matrix\sphinxhyphen{}inversion methods.

\sphinxAtStartPar
d.  Comparison of methods.

\sphinxAtStartPar
e.  Information content/quantum information analysis. (See vol. 2,
sect. 12.1.)

\item {} 
\sphinxAtStartPar
Quantum metrology example: generalised bootstrapping and
matrix\sphinxhyphen{}inversion methods for a complex/general asymmetric top
scattering system (C2H4 (ethylene))*

\sphinxAtStartPar
a.  Experimental data overview \& simulation.

\sphinxAtStartPar
b.  Matrix element extraction (bootstrap protocol, see vol. 2,
sects. 11.3 \& 12.3) \& statistical analysis.

\sphinxAtStartPar
c.  Direct molecular frame reconstruction via matrix\sphinxhyphen{}inversion
methods.

\sphinxAtStartPar
d.  Comparison of methods.

\sphinxAtStartPar
e.  Information content/quantum information analysis.

\item {} 
\sphinxAtStartPar
Future directions \& outlook

\item {} 
\sphinxAtStartPar
Summary \& conclusions

\end{enumerate}

\sphinxAtStartPar
* Exact choice of “simple” and “complex” systems may change, but should
include a homonuclear diatomic and/or heteronuclear diatomic, and
symmetric and asymmetric top polyatomic systems. May also include an
atomic example.

\sphinxstepscope


\part{Theory \& software}

\sphinxstepscope


\chapter{Introduction}
\label{\detokenize{part1/main_intro_051122:introduction}}\label{\detokenize{part1/main_intro_051122::doc}}
\sphinxAtStartPar
The overall aim of Vol. 3 is to expand, explore, and illustrate, quantum metrology with photoelectrons: specifically, the application of new python\sphinxhyphen{}based tools to tackle problems in matrix element retrieval. The book itself is written as a set of Jupyter Notebooks, hence all the material herein is available directly to readers, and can be run locally to further explore the topic, or adapt the methodology to new problems

\sphinxAtStartPar
Whilst this volume aims to provide a self\sphinxhyphen{}contained text, and computational examples which may be used without extensive background knowledge, a brief introduction to the core physics and some recent extensions is presented herein. The unfamiliar reader is referred to Volume 1 of the series for a more detailed presentation, and gateway to the literature {[}{]}. Following the topical introduction, the remainder of Part I introduces the main computational and software tools, recent theory developments, and concludes with a general overview for approaching matrix element retrieval numerically.

\sphinxAtStartPar
Part II details the application of these tools to a few specific cases, starting with a (relatively) simple homonuclear diatomic example, then escalating to a polyatomic asymetric top case.


\section{Topical introduction}
\label{\detokenize{part1/main_intro_051122:topical-introduction}}

\section{Context \& aims for Vol. 3}
\label{\detokenize{part1/main_intro_051122:context-aims-for-vol-3}}
\sphinxAtStartPar
As noted previously, Vol. 3 is somewhat distinct from the previous volumes in the series; although involving computational elements, Vols. 1 \& 2 {[}{]} are more traditional publications. The material presented in this volume aims to continue the exploration of quantum metrology with photoelectrons, with a focus on numerical analysis techniques, forging a closer link between experimental and theoretical results, and making the methodologies discussed directly accessible via a new software platform/ecosystem. In order to fulfil this aim, Vol. 3 is a computational/computable document, with code directly available to readers. Each chapter or section is composed of a Jupyter Notebook (\sphinxcode{\sphinxupquote{.ipynb}}), each of which can be modified and used independently.

\sphinxAtStartPar
To facilitate code transparency and reuse, the book is available via a Github repository, \sphinxhref{https://github.com/phockett/Quantum-Metrology-with-Photoelectrons-Vol3}{Quantum Metrology Vol. 3}. An HTML version is also available, which includes interactive figures. A full introduction to the relevant tool\sphinxhyphen{}chain, including installation instructions, can be found in \hyperref[\detokenize{part1/platform_intro_071122:chpt-platformintro}]{Chapter \ref{\detokenize{part1/platform_intro_071122:chpt-platformintro}}:} {\hyperref[\detokenize{part1/platform_intro_071122:chpt-platformintro}]{\sphinxcrossref{\DUrole{std,std-ref}{Quantum metrology software platform/ecosystem overview}}}}.

\sphinxstepscope


\chapter{Quantum metrology software platform/ecosystem overview}
\label{\detokenize{part1/platform_intro_071122:quantum-metrology-software-platform-ecosystem-overview}}\label{\detokenize{part1/platform_intro_071122:chpt-platformintro}}\label{\detokenize{part1/platform_intro_071122::doc}}
\sphinxAtStartPar
STUB

\sphinxAtStartPar
In recent years, a unified Python codebase/ecosystem/platform has been in development to tackle various aspects of photoionization problems, including \sphinxstyleemphasis{ab initio} computations and experimental data handling, and (generalised) matrix element retrieval methods. The eponymous \sphinxstyleemphasis{Quantum Metrology with Photoelectrons} platform is introduced here, and is used for the analysis herein. The main aim of the platform is to provide a unifying data platform, and analysis routines, for photoelectron metrology, including new methods and tools, as well as a unifying bridge between these and existing tools. \hyperref[\detokenize{part1/platform_intro_071122:qm-platform-diag}]{Fig.\@ \ref{\detokenize{part1/platform_intro_071122:qm-platform-diag}}} provides a general overview of some of the main tools and tasks/layers.

\sphinxAtStartPar
As of late 2022, the new parts of the platform \sphinxhyphen{} primarily the \sphinxhref{https://github.com/phockett/PEMtk}{Photoelectron Metrology Toolkit} {[}{]} library \sphinxhyphen{} implement general data handling (although not a full experimental analysis toolchain), matrix element handling and retrieval, which will be the main topic of this volume.
In the future, it is hoped that the platform will be extended to other theoretical and experimental methods, including full experimental data handling.


\section{Analysis components}
\label{\detokenize{part1/platform_intro_071122:analysis-components}}\label{\detokenize{part1/platform_intro_071122:sect-platform-analysis}}
\sphinxAtStartPar
The two main components of the platform for analysis tasks, as used herein, are:
\begin{itemize}
\item {} 
\sphinxAtStartPar
The \sphinxhref{https://github.com/phockett/PEMtk}{Photoelectron Metrology Toolkit} {[}{]} (PEMtk) codebase aims to provide various general data handling routines for photoionization problems. At the time of writing, simulation of observables and fitting routines are implemented, along with some basic utility functions.
Much of this is detailed herein, and more technical details and ongoing documentation case be found in the \sphinxhref{https://pemtk.readthedocs.io}{PEMtk documentation} {[}{]}.

\item {} 
\sphinxAtStartPar
The \sphinxhref{https://epsproc.readthedocs.io}{ePSproc codebase} {[}{]} aims to provide methods for post\sphinxhyphen{}processing with \sphinxstyleemphasis{ab initio} radial dipole matrix
elements from \sphinxhref{https://epolyscat.droppages.com/}{ePolyScat (ePS)} {[}{]}, or equivalent matrix elements from other sources (dedicated support for R\sphinxhyphen{}matrix results from \sphinxhref{https://gitlab.com/Uk-amor/RMT/rmt}{the RMT suite} {[}{]} is in development).
The core functionality includes the computation of AF and MF observables. Manual computation without known matrix elements is also possible, e.g. for investigating
limiting cases, or data analysis and fitting \sphinxhyphen{} hence these routines also provide the backend functionality for PEMtk fitting routines. Again more technical details can be found in the \sphinxhref{https://epsproc.readthedocs.io}{ePSproc documentation} {[}{]}.

\end{itemize}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{QM_unified_schema_wrapped_280820_gv}.png}
\caption{Quantum metrology with photoelectrons ecosystem overview.}\label{\detokenize{part1/platform_intro_071122:qm-platform-diag}}\end{figure}

\sphinxAtStartPar
Other tools listed in \hyperref[\detokenize{part1/platform_intro_071122:qm-platform-diag}]{Fig.\@ \ref{\detokenize{part1/platform_intro_071122:qm-platform-diag}}} include:
\begin{itemize}
\item {} 
\sphinxAtStartPar
Quantum chemistry layer. The starting point for \sphinxstyleemphasis{ab initio} computations. For the examples herein, all computations made use of \sphinxhref{http://www.msg.ameslab.gov/gamess/}{Gamess (“The General Atomic and Molecular Electronic Structure System”)} {[}{]} for electronic structure computations, and inputs to ePolyScat.

\item {} 
\sphinxAtStartPar
\sphinxhref{https://epolyscat.droppages.com/}{ePolyScat (ePS)} {[}{]} is an open\sphinxhyphen{}source tool for numerical computation of electron\sphinxhyphen{}molecule scattering \& photoionization by Lucchese \& coworkers. All matrix elements used herein were obtained via ePS calculations. For more details see \sphinxhref{https://epolyscat.droppages.com/}{ePolyScat website and manual} {[}{]} and Refs. {[}{]}.

\item {} 
\sphinxAtStartPar
\sphinxhref{https://phockett.github.io/ePSdata/about.html}{ePSdata} is an open\sphinxhyphen{}data/open\sphinxhyphen{}science collection of ePS + ePSproc results {[}{]}.
\begin{itemize}
\item {} 
\sphinxAtStartPar
ePSdata collects ePS datasets, post\sphinxhyphen{}processed via ePSproc (Python) in \sphinxhref{https://jupyter.org}{Jupyter notebooks}, for a full open\sphinxhyphen{}data/open\sphinxhyphen{}science transparent pipeline.

\end{itemize}
\begin{itemize}
\item {} 
\sphinxAtStartPar
Source notebooks are available on the \sphinxhref{https://github.com/phockett/ePSdata/}{Github project pages}, and notebooks + datasets via \sphinxhref{https://about.zenodo.org}{Zenodo repositories} (one per dataset). Each notebook + dataset is given a Zenodo DOI for full traceability, and notebooks are versioned on Github.

\item {} 
\sphinxAtStartPar
Note: ePSdata may also be linked or mirrored on the existing \sphinxhref{https://osf.io/psjxt/}{ePolyScat Collected Results OSF project}, but will effectively supercede those pages.

\item {} 
\sphinxAtStartPar
All results are released under <a href=”https://creativecommons.org/licenses/by\sphinxhyphen{}nc\sphinxhyphen{}sa/4.0/”>Creative Commons Attribution\sphinxhyphen{}NonCommercial\sphinxhyphen{}ShareAlike 4.0 (CC BY\sphinxhyphen{}NC\sphinxhyphen{}SA 4.0) license, and are part of our ongoing \sphinxhref{http://femtolab.ca/?p=877}{Open Science initiative}.

\end{itemize}

\end{itemize}

\sphinxAtStartPar
A Docker\sphinxhyphen{}based distribution of various codes for tackling
photoionization problems is also available from the \sphinxhref{https://github.com/phockett/open-photoionization-docker-stacks}{Open Photoionization Docker Stacks} {[}{]}
project, which aims to make a range of these tools more accessible to
interested researchers, and currently includes Docker builds for \sphinxcode{\sphinxupquote{ePS}}, \sphinxcode{\sphinxupquote{ePSproc}} and \sphinxcode{\sphinxupquote{PEMtk}}.

\sphinxAtStartPar
Note that, at the time of writing, rotational wavepacket simulation is
not yet implemented in the PEMtk suite, and these must be obtained via
other codes. An intial build of the \sphinxcode{\sphinxupquote{limapack}} suite for rotational wavepacket simulations is currently part of the \sphinxhref{https://github.com/phockett/open-photoionization-docker-stacks}{Open Photoionization Docker Stacks} {[}{]}, but has yet to be tested.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{For} \PYG{n}{related} \PYG{n}{tools} \PYG{o+ow}{and} \PYG{n}{more} \PYG{n}{Docker} \PYG{n}{builds}\PYG{p}{,} \PYG{n}{see} \PYG{n}{also} \PYG{n}{the} \PYG{p}{[}\PYG{n}{Open} \PYG{n}{Photoionization} \PYG{n}{Docker} \PYG{n}{Stacks} \PYG{n}{repo}\PYG{p}{]}\PYG{p}{(}\PYG{n}{https}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{n}{github}\PYG{o}{.}\PYG{n}{com}\PYG{o}{/}\PYG{n}{phockett}\PYG{o}{/}\PYG{n+nb}{open}\PYG{o}{\PYGZhy{}}\PYG{n}{photoionization}\PYG{o}{\PYGZhy{}}\PYG{n}{docker}\PYG{o}{\PYGZhy{}}\PYG{n}{stacks}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\part{Test pages}

\sphinxstepscope


\chapter{Formatting tests}
\label{\detokenize{tests/formatting_syntax_tests_081122:formatting-tests}}\label{\detokenize{tests/formatting_syntax_tests_081122::doc}}
\sphinxAtStartPar
For directives and how\sphinxhyphen{}tos see:
\begin{itemize}
\item {} 
\sphinxAtStartPar
General Jupyter Book intro: \sphinxurl{https://jupyterbook.org/en/stable/content/myst.html}

\item {} 
\sphinxAtStartPar
\sphinxurl{https://jupyterbook.org/en/stable/content/index.html}

\item {} 
\sphinxAtStartPar
\sphinxurl{https://myst-parser.readthedocs.io/en/latest/faq/index.html} (includes direct rst directive for native rst/Sphinx blocks).

\end{itemize}

\sphinxAtStartPar
Only outstanding point is use of raw latex? Is this possible…?


\section{Links and refs}
\label{\detokenize{tests/formatting_syntax_tests_081122:links-and-refs}}
\sphinxAtStartPar
See \sphinxurl{https://jupyterbook.org/en/stable/content/references.html}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{\{numref\}}} for numbered ref with custom text: \hyperref[\detokenize{part1/platform_intro_071122:chpt-platformintro}]{Chapter \ref{\detokenize{part1/platform_intro_071122:chpt-platformintro}}} (always works in PDF, need to \sphinxhref{https://jupyterbook.org/en/stable/content/references.html\#reference-numbered-sections}{set numbered sections for HTML})

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{\{ref\}}} for named ref: {\hyperref[\detokenize{part1/platform_intro_071122:chpt-platformintro}]{\sphinxcrossref{\DUrole{std,std-ref}{Quantum metrology software platform/ecosystem overview}}}}

\item {} 
\sphinxAtStartPar
Combined for full number and name: \hyperref[\detokenize{part1/platform_intro_071122:chpt-platformintro}]{Chapter \ref{\detokenize{part1/platform_intro_071122:chpt-platformintro}}:} {\hyperref[\detokenize{part1/platform_intro_071122:chpt-platformintro}]{\sphinxcrossref{\DUrole{std,std-ref}{Quantum metrology software platform/ecosystem overview}}}}

\item {} 
\sphinxAtStartPar
Nested as a link? \hyperref[\detokenize{part1/platform_intro_071122:chpt-platformintro}]{Chapter \ref{\detokenize{part1/platform_intro_071122:chpt-platformintro}}: {[}{]}(chpt:platformIntro)}

\end{itemize}


\subsection{Substitution tests}
\label{\detokenize{tests/formatting_syntax_tests_081122:substitution-tests}}
\sphinxAtStartPar
See \sphinxurl{https://jupyterbook.org/en/stable/content/content-blocks.html?highlight=substitutions\#substitutions-and-variables-in-markdown}

\sphinxAtStartPar
For global subs define in \sphinxcode{\sphinxupquote{\_config.yml}}. Uses Jinja on backend.

\sphinxAtStartPar
Basic: Something

\sphinxAtStartPar
Sub test with URL: \sphinxhref{https://github.com/phockett/PEMtk}{Photoelectron Metrology Toolkit} {[}{]}


\section{Fig testing (from file)}
\label{\detokenize{tests/formatting_syntax_tests_081122:fig-testing-from-file}}
\sphinxAtStartPar
As a figure, see \sphinxurl{https://jupyterbook.org/en/stable/content/figures.html}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{QM_unified_schema_wrapped_280820_gv}.png}
\caption{Here is my figure caption!}\label{\detokenize{tests/formatting_syntax_tests_081122:qm-platform-diag-test}}\end{figure}


\section{Fig testing (from URL)}
\label{\detokenize{tests/formatting_syntax_tests_081122:fig-testing-from-url}}
\sphinxAtStartPar
Seemed to work OK for both HTML and PDF output, although did get some build errors in latter case. For PDF, image copied locally to hashed\sphinxhyphen{}named file, so probably not ideal (and seems to break build…?).

\sphinxAtStartPar
Markdown image link

\sphinxAtStartPar
\sphinxincludegraphics{{ccdcf3feb912fb992ab79da89d86a2521bfe1c21}.png}

\sphinxAtStartPar
As a figure, see \sphinxurl{https://jupyterbook.org/en/stable/content/figures.html}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[height=300\sphinxpxdimen]{{ccdcf3feb912fb992ab79da89d86a2521bfe1c21}.png}
\caption{Here is my figure caption!}\label{\detokenize{tests/formatting_syntax_tests_081122:directive-fig}}\end{figure}


\section{Testing raw latex…}
\label{\detokenize{tests/formatting_syntax_tests_081122:testing-raw-latex}}
\sphinxAtStartPar
Both options fail in PDF and HTML export tests.

\sphinxAtStartPar
BETTER: JUST USE PANDOC FOR EXTENDED LATEX SECTIONS > Markdown. Will generally only need to fix minor issues (formatting and citations) in most cases anyway, if maths works.

\sphinxAtStartPar
For MyST markdown…?
\begin{itemize}
\item {} 
\sphinxAtStartPar
RST to MySt with Pandoc: \sphinxurl{https://github.com/executablebooks/rst2myst/issues/2} and \sphinxurl{https://github.com/executablebooks/rst-to-myst}

\end{itemize}

\sphinxAtStartPar
Code cell with \sphinxcode{\sphinxupquote{\%\%latex}}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZpc{}\PYGZpc{}latex

\PYGZbs{}bf\PYGZob{}This is a test\PYGZcb{} \PYGZbs{}\PYGZbs{}
It allows latex \PYGZdl{}\PYGZbs{}alpha=\PYGZbs{}beta\PYGZdl{} and test:

\PYGZbs{}begin\PYGZob{}equation\PYGZcb{}
\PYGZbs{}alpha = \PYGZbs{}beta
\PYGZbs{}end\PYGZob{}equation\PYGZcb{}
\PYGZpc{} this is a latex comment
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
Cell below marked as raw > latex in metadata.

\sphinxAtStartPar
With \sphinxcode{\sphinxupquote{\{latex\}}} directive

\sphinxAtStartPar
With MyST\sphinxhyphen{}rst wrapper \sphinxhyphen{} this appears in PDF output, but not HTML. Also bold sticks for rest of output!

\bf{This is a test} \\
It allows latex $\alpha=\beta$ and test:

\begin{equation}
\alpha = \beta
\end{equation}
% this is a latex comment

\sphinxAtStartPar
Testing maths only \sphinxhyphen{} OK in notebook, and all output forms too.
\label{equation:tests/formatting_syntax_tests_081122:19aa4979-fd2b-4e7f-b426-c6d626f1ecbb}\begin{equation}
\alpha = \beta
\end{equation}

\section{Include}
\label{\detokenize{tests/formatting_syntax_tests_081122:include}}
\sphinxAtStartPar
Working.

\sphinxAtStartPar
Include with \sphinxcode{\sphinxupquote{\{include\}}} directive:

\sphinxAtStartPar
Some text to be included from another file.

\sphinxstepscope


\chapter{Plotly surface render test}
\label{\detokenize{tests/plotly_surface_render_test:plotly-surface-render-test}}\label{\detokenize{tests/plotly_surface_render_test::doc}}
\sphinxAtStartPar
Quick tests for plotly compatibility.

\sphinxAtStartPar
For JupyterLab, need additional extensions \sphinxhyphen{} see \sphinxurl{https://plotly.com/python/getting-started/\#jupyterlab-support:}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{conda install \sphinxhyphen{}c conda\sphinxhyphen{}forge \sphinxhyphen{}c plotly jupyter\sphinxhyphen{}dash}}

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{jupyter labextension install jupyterlab\sphinxhyphen{}plotly}}

\end{itemize}

\sphinxAtStartPar
In some cases may get partially working installation with, e.g., blank surface plots, or plots via HV only. This usually means JupyterLab needs a restart (and maybe a rebuild).
For more see \sphinxurl{https://plotly.com/python/troubleshooting/}

\sphinxAtStartPar
Also unstable behaviour in some Firefox builds? May be issue with add\sphinxhyphen{}ons? v106.0.3 on Win seems bad, but Linux versions seem OK?

\sphinxAtStartPar
Exports to HTML:
\begin{itemize}
\item {} 
\sphinxAtStartPar
Manual from JupyterLab OK.

\item {} 
\sphinxAtStartPar
Read the docs may be OK, but might depend on theme, see \sphinxurl{https://github.com/readthedocs/readthedocs.org/issues/4367}. For default RTD theme, ensuring \sphinxcode{\sphinxupquote{sphinx\_rtd\_theme >= 1.0.0}} in project \sphinxcode{\sphinxupquote{requirements.txt}} should make things work. Alternatively, can manually set script load per page (see link above).

\item {} 
\sphinxAtStartPar
Jupyter book (via Sphinx), fails to render unless \sphinxcode{\sphinxupquote{\_config.yml}} set as per \sphinxurl{https://jupyterbook.org/en/stable/interactive/interactive.html\#plotly}. But… seem to be missing figs in PDF output? (Although figs via ePSproc PAD plotting routines are appearing \sphinxhyphen{} may be missing some additional settings in this test notebook?)

\end{itemize}


\section{Plotly example}
\label{\detokenize{tests/plotly_surface_render_test:plotly-example}}
\sphinxAtStartPar
From \sphinxurl{https://plotly.com/python/3d-surface-plots/\#passing-x-and-y-data-to-3d-surface-plot}

\sphinxAtStartPar
On blank plots or \sphinxcode{\sphinxupquote{Javascript error "t is null".}} try a browser refresh and/or Jupyterlab restart. Seeing this frequently in testing March 2022, Firefox 98.0.2, JupyterLab 3.3.2, see end of page for other versions \sphinxhyphen{} running via Holoviews wrapper seems to be more robust here?

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{plotly}\PYG{n+nn}{.}\PYG{n+nn}{graph\PYGZus{}objects} \PYG{k}{as} \PYG{n+nn}{go}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{c+c1}{\PYGZsh{} Read data from a csv}
\PYG{n}{z\PYGZus{}data} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{read\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{https://raw.githubusercontent.com/plotly/datasets/master/api\PYGZus{}docs/mt\PYGZus{}bruno\PYGZus{}elevation.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{z} \PYG{o}{=} \PYG{n}{z\PYGZus{}data}\PYG{o}{.}\PYG{n}{values}
\PYG{n}{sh\PYGZus{}0}\PYG{p}{,} \PYG{n}{sh\PYGZus{}1} \PYG{o}{=} \PYG{n}{z}\PYG{o}{.}\PYG{n}{shape}
\PYG{n}{x}\PYG{p}{,} \PYG{n}{y} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{linspace}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{sh\PYGZus{}0}\PYG{p}{)}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{linspace}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{sh\PYGZus{}1}\PYG{p}{)}
\PYG{n}{fig} \PYG{o}{=} \PYG{n}{go}\PYG{o}{.}\PYG{n}{Figure}\PYG{p}{(}\PYG{n}{data}\PYG{o}{=}\PYG{p}{[}\PYG{n}{go}\PYG{o}{.}\PYG{n}{Surface}\PYG{p}{(}\PYG{n}{z}\PYG{o}{=}\PYG{n}{z}\PYG{p}{,} \PYG{n}{x}\PYG{o}{=}\PYG{n}{x}\PYG{p}{,} \PYG{n}{y}\PYG{o}{=}\PYG{n}{y}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{update\PYGZus{}layout}\PYG{p}{(}\PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Mt Bruno Elevation}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{autosize}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,}
                  \PYG{n}{width}\PYG{o}{=}\PYG{l+m+mi}{500}\PYG{p}{,} \PYG{n}{height}\PYG{o}{=}\PYG{l+m+mi}{500}\PYG{p}{,}
                  \PYG{n}{margin}\PYG{o}{=}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{l}\PYG{o}{=}\PYG{l+m+mi}{65}\PYG{p}{,} \PYG{n}{r}\PYG{o}{=}\PYG{l+m+mi}{50}\PYG{p}{,} \PYG{n}{b}\PYG{o}{=}\PYG{l+m+mi}{65}\PYG{p}{,} \PYG{n}{t}\PYG{o}{=}\PYG{l+m+mi}{90}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} From https://www.tutorialspoint.com/plotly/plotly\PYGZus{}3d\PYGZus{}scatter\PYGZus{}and\PYGZus{}surface\PYGZus{}plot.htm}
\PYG{c+c1}{\PYGZsh{} Also empty}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{n}{x} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{outer}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{linspace}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{30}\PYG{p}{)}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{ones}\PYG{p}{(}\PYG{l+m+mi}{30}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{y} \PYG{o}{=} \PYG{n}{x}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{T} \PYG{c+c1}{\PYGZsh{} transpose}
\PYG{n}{z} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{cos}\PYG{p}{(}\PYG{n}{x} \PYG{o}{*}\PYG{o}{*} \PYG{l+m+mi}{2} \PYG{o}{+} \PYG{n}{y} \PYG{o}{*}\PYG{o}{*} \PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{n}{trace} \PYG{o}{=} \PYG{n}{go}\PYG{o}{.}\PYG{n}{Surface}\PYG{p}{(}\PYG{n}{x} \PYG{o}{=} \PYG{n}{x}\PYG{p}{,} \PYG{n}{y} \PYG{o}{=} \PYG{n}{y}\PYG{p}{,} \PYG{n}{z} \PYG{o}{=}\PYG{n}{z} \PYG{p}{)}
\PYG{n}{data} \PYG{o}{=} \PYG{p}{[}\PYG{n}{trace}\PYG{p}{]}
\PYG{n}{layout} \PYG{o}{=} \PYG{n}{go}\PYG{o}{.}\PYG{n}{Layout}\PYG{p}{(}\PYG{n}{title} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{3D Surface plot}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{fig} \PYG{o}{=} \PYG{n}{go}\PYG{o}{.}\PYG{n}{Figure}\PYG{p}{(}\PYG{n}{data} \PYG{o}{=} \PYG{n}{data}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} iplot(fig)}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Holoviews 3D surface test}
\label{\detokenize{tests/plotly_surface_render_test:holoviews-3d-surface-test}}
\sphinxAtStartPar
From: \sphinxurl{https://holoviews.org/gallery/demos/plotly/surface\_3d.html}

\sphinxAtStartPar
See also
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxurl{http://holoviews.org/reference/elements/matplotlib/Surface.html}

\item {} 
\sphinxAtStartPar
\sphinxurl{http://holoviews.org/reference/elements/plotly/Surface.html}

\end{itemize}

\sphinxAtStartPar
This wrapper seems robust, and works even when Plotly native rendering is giving issues?

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{holoviews} \PYG{k}{as} \PYG{n+nn}{hv}
\PYG{n}{hv}\PYG{o}{.}\PYG{n}{extension}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{plotly}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\subsection{Define data}
\label{\detokenize{tests/plotly_surface_render_test:define-data}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Make data.}
\PYG{n}{X} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mf}{0.25}\PYG{p}{)}
\PYG{n}{Y} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mf}{0.25}\PYG{p}{)}
\PYG{n}{X}\PYG{p}{,} \PYG{n}{Y} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{meshgrid}\PYG{p}{(}\PYG{n}{X}\PYG{p}{,} \PYG{n}{Y}\PYG{p}{)}
\PYG{n}{R} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{sqrt}\PYG{p}{(}\PYG{n}{X}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{2} \PYG{o}{+} \PYG{n}{Y}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{n}{Z} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{sin}\PYG{p}{(}\PYG{n}{R}\PYG{p}{)}

\PYG{n}{surface} \PYG{o}{=} \PYG{n}{hv}\PYG{o}{.}\PYG{n}{Surface}\PYG{p}{(}\PYG{n}{Z}\PYG{p}{,} \PYG{n}{bounds}\PYG{o}{=}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\subsection{Plot}
\label{\detokenize{tests/plotly_surface_render_test:plot}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{surface}\PYG{o}{.}\PYG{n}{opts}\PYG{p}{(}\PYG{n}{colorbar}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{width}\PYG{o}{=}\PYG{l+m+mi}{500}\PYG{p}{,} \PYG{n}{height}\PYG{o}{=}\PYG{l+m+mi}{500}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
:Surface   [x,y]   (z)
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\subsection{Plotting with coords}
\label{\detokenize{tests/plotly_surface_render_test:plotting-with-coords}}
\sphinxAtStartPar
BUT only supports regularly gridded coord systems (not x,y as grids). Trying to pass \sphinxcode{\sphinxupquote{(X,Y,Z)}} in latter case gives \sphinxcode{\sphinxupquote{ValueError: Surface coordinates must be 1D arrays, x and y dimension(s) were found to have multiple dimensions. Either supply 1D arrays or use the QuadMesh element for curvilinear coordinates.}}.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{xs} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mf}{0.25}\PYG{p}{)}
\PYG{n}{ys} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mf}{0.25}\PYG{p}{)}
\PYG{n}{X}\PYG{p}{,} \PYG{n}{Y} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{meshgrid}\PYG{p}{(}\PYG{n}{xs}\PYG{p}{,} \PYG{n}{ys}\PYG{p}{)}
\PYG{n}{R} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{sqrt}\PYG{p}{(}\PYG{n}{X}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{2} \PYG{o}{+} \PYG{n}{Y}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{n}{Z} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{sin}\PYG{p}{(}\PYG{n}{R}\PYG{p}{)}

\PYG{n}{surface} \PYG{o}{=} \PYG{n}{hv}\PYG{o}{.}\PYG{n}{Surface}\PYG{p}{(}\PYG{p}{(}\PYG{n}{xs}\PYG{p}{,} \PYG{n}{ys}\PYG{p}{,} \PYG{n}{Z}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{surface}\PYG{o}{.}\PYG{n}{opts}\PYG{p}{(}\PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{fire}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{height}\PYG{o}{=}\PYG{l+m+mi}{500}\PYG{p}{,} \PYG{n}{width}\PYG{o}{=}\PYG{l+m+mi}{500}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
:Surface   [x,y]   (z)
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Versions}
\label{\detokenize{tests/plotly_surface_render_test:versions}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{scooby}
\PYG{n}{scooby}\PYG{o}{.}\PYG{n}{Report}\PYG{p}{(}\PYG{n}{additional}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{xarray}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{jupyterlab}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{plotly}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{holoviews}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
  Date: Tue Nov 08 13:16:43 2022 UTC

                OS : Linux
            CPU(s) : 64
           Machine : x86\PYGZus{}64
      Architecture : 64bit
               RAM : 62.8 GiB
       Environment : Jupyter
       File system : btrfs

  Python 3.9.7 | packaged by conda\PYGZhy{}forge | (default, Sep 29 2021, 19:20:46)
  [GCC 9.4.0]

            xarray : 2022.3.0
        jupyterlab : 3.2.1
            plotly : 5.11.0
         holoviews : 1.15.2
             numpy : 1.20.3
             scipy : 1.7.1
           IPython : 7.28.0
        matplotlib : 3.4.3
            scooby : 0.7.0
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
March 2022 testing: Docker with jupyter/scipy\sphinxhyphen{}notebook base + Firefox 98.0.2.

\sphinxstepscope


\chapter{ePSproc base and multijob class intro}
\label{\detokenize{testChpt/ePSproc_class_demo_161020:epsproc-base-and-multijob-class-intro}}\label{\detokenize{testChpt/ePSproc_class_demo_161020::doc}}
\sphinxAtStartPar
16/10/20

\sphinxAtStartPar
As of Oct. 2020, v1.3.0\sphinxhyphen{}dev, basic data classes are now implemented, and are now the easiest/preferred method for using ePSproc (as opposed to calling core functions directly, as \sphinxhref{https://epsproc.readthedocs.io/en/latest/demos/ePSproc\_demo\_Aug2019.html}{illustrated in the functions guide}).

\sphinxAtStartPar
A brief intro and guide to use is given here.

\sphinxAtStartPar
Aims:
\begin{itemize}
\item {} 
\sphinxAtStartPar
Provide unified data architecture for ePSproc, ePSdata and PEMtk.

\item {} 
\sphinxAtStartPar
Wrap plotting and computational functions for ease of use.

\item {} 
\sphinxAtStartPar
Handle multiple datasets inc. comparitive plots.

\end{itemize}


\section{Setup}
\label{\detokenize{testChpt/ePSproc_class_demo_161020:setup}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} For module testing, include path to module here, otherwise use global installation}
\PYG{n}{local} \PYG{o}{=} \PYG{k+kc}{True}

\PYG{k}{if} \PYG{n}{local}\PYG{p}{:}
    \PYG{k+kn}{import} \PYG{n+nn}{sys}
    \PYG{k}{if} \PYG{n}{sys}\PYG{o}{.}\PYG{n}{platform} \PYG{o}{==} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{win32}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:}
        \PYG{n}{modPath} \PYG{o}{=} \PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{D:}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{code}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{github}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{ePSproc}\PYG{l+s+s1}{\PYGZsq{}}  \PYG{c+c1}{\PYGZsh{} Win test machine}
        \PYG{n}{winFlag} \PYG{o}{=} \PYG{k+kc}{True}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{modPath} \PYG{o}{=} \PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/home/femtolab/github/ePSproc/}\PYG{l+s+s1}{\PYGZsq{}}  \PYG{c+c1}{\PYGZsh{} Linux test machine}
        \PYG{n}{winFlag} \PYG{o}{=} \PYG{k+kc}{False}

    \PYG{n}{sys}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{modPath}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Base}
\PYG{k+kn}{import} \PYG{n+nn}{epsproc} \PYG{k}{as} \PYG{n+nn}{ep}

\PYG{c+c1}{\PYGZsh{} Class dev code}
\PYG{k+kn}{from} \PYG{n+nn}{epsproc}\PYG{n+nn}{.}\PYG{n+nn}{classes}\PYG{n+nn}{.}\PYG{n+nn}{multiJob} \PYG{k+kn}{import} \PYG{n}{ePSmultiJob}
\PYG{k+kn}{from} \PYG{n+nn}{epsproc}\PYG{n+nn}{.}\PYG{n+nn}{classes}\PYG{n+nn}{.}\PYG{n+nn}{base} \PYG{k+kn}{import} \PYG{n}{ePSbase}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
* pyevtk not found, VTK export not available. 
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{ePSbase class}
\label{\detokenize{testChpt/ePSproc_class_demo_161020:epsbase-class}}
\sphinxAtStartPar
The ePSbase class wraps most of the core functionality, and will handle all ePolyScat output files in a single data directory. In general, we’ll assume:
\begin{itemize}
\item {} 
\sphinxAtStartPar
an ePS \sphinxstyleemphasis{job} constitutes a single ionization event/channel (ionizing orbital) for a given molecule, stored in one or more output files.

\item {} 
\sphinxAtStartPar
the data dir contains one or more files, where each file will contain a set of symmetries and energies, with either
\begin{itemize}
\item {} 
\sphinxAtStartPar
one file per ionizing event. In this case, each file will equate to one job, and one entry in the class datastructure.

\item {} 
\sphinxAtStartPar
a single ionizing event, where each file contains a different set of energies for the given event (\sphinxstyleemphasis{energy chunked} fileset). In this case, the files will be stacked, and the dir will equate to one job and one entry in the class datastructure.

\end{itemize}

\end{itemize}

\sphinxAtStartPar
The class datastructure is (currently) a set of dictionaries, with entries per job as above, and various data for each job. In general the data is \sphinxhref{http://xarray.pydata.org/en/stable/why-xarray.html}{stored in Xarrays}.

\sphinxAtStartPar
The \sphinxcode{\sphinxupquote{multiJob}} class extends the base class with reading from multple directories.


\subsection{Load data}
\label{\detokenize{testChpt/ePSproc_class_demo_161020:load-data}}
\sphinxAtStartPar
Firstly, set the data path, instantiate a class object and load the data.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Set for ePSproc test data, available from https://github.com/phockett/ePSproc/tree/master/data}
\PYG{c+c1}{\PYGZsh{} Here this is assumed to be on the epsproc path}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{n}{dataPath} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{path}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{data}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{photoionization}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{n2\PYGZus{}multiorb}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Instantiate class object.}
\PYG{c+c1}{\PYGZsh{} Minimally this needs just the dataPath, if verbose = 1 is set then some useful output will also be printed.}
\PYG{n}{data} \PYG{o}{=} \PYG{n}{ePSbase}\PYG{p}{(}\PYG{n}{dataPath}\PYG{p}{,} \PYG{n}{verbose} \PYG{o}{=} \PYG{l+m+mi}{1}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} ScanFiles() \PYGZhy{} this will look for data files on the path provided, and read from them.}
\PYG{n}{data}\PYG{o}{.}\PYG{n}{scanFiles}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
*** Job orb6 details
Key: orb6
Dir D:\PYGZbs{}code\PYGZbs{}github\PYGZbs{}ePSproc\PYGZbs{}data\PYGZbs{}photoionization\PYGZbs{}n2\PYGZus{}multiorb, 1 files.
\PYGZob{}   \PYGZsq{}batch\PYGZsq{}: \PYGZsq{}ePS n2, batch n2\PYGZus{}1pu\PYGZus{}0.1\PYGZhy{}50.1eV, orbital A2\PYGZsq{},
    \PYGZsq{}event\PYGZsq{}: \PYGZsq{} N2 A\PYGZhy{}state (1piu\PYGZhy{}1)\PYGZsq{},
    \PYGZsq{}orbE\PYGZsq{}: \PYGZhy{}17.096913836366,
    \PYGZsq{}orbLabel\PYGZsq{}: \PYGZsq{}1piu\PYGZhy{}1\PYGZsq{}\PYGZcb{}

*** Job orb5 details
Key: orb5
Dir D:\PYGZbs{}code\PYGZbs{}github\PYGZbs{}ePSproc\PYGZbs{}data\PYGZbs{}photoionization\PYGZbs{}n2\PYGZus{}multiorb, 1 files.
\PYGZob{}   \PYGZsq{}batch\PYGZsq{}: \PYGZsq{}ePS n2, batch n2\PYGZus{}3sg\PYGZus{}0.1\PYGZhy{}50.1eV, orbital A2\PYGZsq{},
    \PYGZsq{}event\PYGZsq{}: \PYGZsq{} N2 X\PYGZhy{}state (3sg\PYGZhy{}1)\PYGZsq{},
    \PYGZsq{}orbE\PYGZsq{}: \PYGZhy{}17.341816310545997,
    \PYGZsq{}orbLabel\PYGZsq{}: \PYGZsq{}3sg\PYGZhy{}1\PYGZsq{}\PYGZcb{}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
In this case, two files are read, and each file is a different ePS job \sphinxhyphen{} here the \(3\sigma_g^{-1}\) and \(1\pi_u^{-1}\) channels in N2. The keys for the job are also used as the job names.


\subsection{Basic info \& plots}
\label{\detokenize{testChpt/ePSproc_class_demo_161020:basic-info-plots}}
\sphinxAtStartPar
A few basic methods to summarise the data…

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Summarise jobs, this will also be output by scanFile() if verbose = 1 is set, as illustrated above.}
\PYG{n}{data}\PYG{o}{.}\PYG{n}{jobsSummary}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
*** Job orb6 details
Key: orb6
Dir D:\PYGZbs{}code\PYGZbs{}github\PYGZbs{}ePSproc\PYGZbs{}data\PYGZbs{}photoionization\PYGZbs{}n2\PYGZus{}multiorb, 1 files.
\PYGZob{}   \PYGZsq{}batch\PYGZsq{}: \PYGZsq{}ePS n2, batch n2\PYGZus{}1pu\PYGZus{}0.1\PYGZhy{}50.1eV, orbital A2\PYGZsq{},
    \PYGZsq{}event\PYGZsq{}: \PYGZsq{} N2 A\PYGZhy{}state (1piu\PYGZhy{}1)\PYGZsq{},
    \PYGZsq{}orbE\PYGZsq{}: \PYGZhy{}17.096913836366,
    \PYGZsq{}orbLabel\PYGZsq{}: \PYGZsq{}1piu\PYGZhy{}1\PYGZsq{}\PYGZcb{}

*** Job orb5 details
Key: orb5
Dir D:\PYGZbs{}code\PYGZbs{}github\PYGZbs{}ePSproc\PYGZbs{}data\PYGZbs{}photoionization\PYGZbs{}n2\PYGZus{}multiorb, 1 files.
\PYGZob{}   \PYGZsq{}batch\PYGZsq{}: \PYGZsq{}ePS n2, batch n2\PYGZus{}3sg\PYGZus{}0.1\PYGZhy{}50.1eV, orbital A2\PYGZsq{},
    \PYGZsq{}event\PYGZsq{}: \PYGZsq{} N2 X\PYGZhy{}state (3sg\PYGZhy{}1)\PYGZsq{},
    \PYGZsq{}orbE\PYGZsq{}: \PYGZhy{}17.341816310545997,
    \PYGZsq{}orbLabel\PYGZsq{}: \PYGZsq{}3sg\PYGZhy{}1\PYGZsq{}\PYGZcb{}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Molecular info}
\PYG{c+c1}{\PYGZsh{} Note that this is currently assumed to be the same for all jobs in the data dir.}
\PYG{n}{data}\PYG{o}{.}\PYG{n}{molSummary}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
*** Molecular structure
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_12_1}.png}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
*** Molecular orbital list (from ePS output file)
EH = Energy (Hartrees), E = Energy (eV), NOrbGrp, OrbGrp, GrpDegen = degeneracies and corresponding orbital numbering by group in ePS, NormInt = single centre expansion convergence (should be \PYGZti{}1.0).
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
props Sym       EH  Occ           E  NOrbGrp  OrbGrp  GrpDegen   NormInt
orb                                                                     
1      SG \PYGZhy{}15.6719  2.0 \PYGZhy{}426.454121      1.0     1.0       1.0  0.999532
2      SU \PYGZhy{}15.6676  2.0 \PYGZhy{}426.337112      1.0     2.0       1.0  0.999458
3      SG  \PYGZhy{}1.4948  2.0  \PYGZhy{}40.675580      1.0     3.0       1.0  0.999979
4      SU  \PYGZhy{}0.7687  2.0  \PYGZhy{}20.917392      1.0     4.0       1.0  0.999979
5      SG  \PYGZhy{}0.6373  2.0  \PYGZhy{}17.341816      1.0     5.0       1.0  1.000000
6      PU  \PYGZhy{}0.6283  2.0  \PYGZhy{}17.096914      1.0     6.0       2.0  1.000000
7      PU  \PYGZhy{}0.6283  2.0  \PYGZhy{}17.096914      2.0     6.0       2.0  1.000000
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\subsection{Plot cross\sphinxhyphen{}sections and betas}
\label{\detokenize{testChpt/ePSproc_class_demo_161020:plot-cross-sections-and-betas}}
\sphinxAtStartPar
These are taken from the \sphinxcode{\sphinxupquote{GetCro}} segments in the ePS output files, and correspond to results for an isotropic ensemble of molecules, i.e. observables in the lab frame (LF) for 1\sphinxhyphen{}photon ionization (see \sphinxhref{https://epsproc.readthedocs.io/en/latest/ePS\_ePSproc\_tutorial/ePS\_tutorial\_080520.html\#Theoretical-background}{the ePS tutorial for more details}).

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Minimal method call will plot cross\PYGZhy{}sections for all ePS jobs found in the data directory.}
\PYG{n}{data}\PYG{o}{.}\PYG{n}{plotGetCro}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_14_0}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_14_1}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Plot beta parameters with the \PYGZsq{}BETA\PYGZsq{} flag}
\PYG{n}{data}\PYG{o}{.}\PYG{n}{plotGetCro}\PYG{p}{(}\PYG{n}{pType} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{BETA}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_15_0}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_15_1}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
TODO: fix labelling here.


\subsection{Compute MFPADs}
\label{\detokenize{testChpt/ePSproc_class_demo_161020:compute-mfpads}}
\sphinxAtStartPar
The class currently wraps just the \sphinxhref{https://epsproc.readthedocs.io/en/latest/demos/ePSproc\_demo\_Aug2019.html\#Calculate-MFPADs}{basic numerical routine for MFPADs}. This defaults to computing MFPADs for all energies and \((z,x,y)\) polarization geometries (where the z\sphinxhyphen{}axis is the molecular symmetry axis, and corresponds to the molecular structure plot shown above).

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Compute MFPADs...}
\PYG{n}{data}\PYG{o}{.}\PYG{n}{mfpadNumeric}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
To plot it’s advisable to set an enery slice, \sphinxcode{\sphinxupquote{Erange = {[}start, stop, step{]}}}, since MFPADs are currently shown as individual plots in the default case, and there may be a lot of them.

\sphinxAtStartPar
We’ll also just set for a single key here, otherwise all jobs will be plotted.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{data}\PYG{o}{.}\PYG{n}{padPlot}\PYG{p}{(}\PYG{n}{keys} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{orb5}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{Erange} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}TODO: fix plot layout!}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Found dims (\PYGZsq{}Labels\PYGZsq{}, \PYGZsq{}Phi\PYGZsq{}, \PYGZsq{}Theta\PYGZsq{}, \PYGZsq{}Eke\PYGZsq{}, \PYGZsq{}Sym\PYGZsq{}), summing to reduce for plot. Pass selDims to avoid.
Sph plots: Pol geom: z
Plotting with mpl
Data dims: (\PYGZsq{}Phi\PYGZsq{}, \PYGZsq{}Theta\PYGZsq{}, \PYGZsq{}Eke\PYGZsq{}), subplots on Eke
Sph plots: Pol geom: x
Plotting with mpl
Data dims: (\PYGZsq{}Phi\PYGZsq{}, \PYGZsq{}Theta\PYGZsq{}, \PYGZsq{}Eke\PYGZsq{}), subplots on Eke
Sph plots: Pol geom: y
Plotting with mpl
Data dims: (\PYGZsq{}Phi\PYGZsq{}, \PYGZsq{}Theta\PYGZsq{}, \PYGZsq{}Eke\PYGZsq{}), subplots on Eke
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_20_1}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_20_2}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_20_3}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_20_4}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_20_5}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_20_6}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
To view multiple results in a more concise fashion, a Cartesian gridded output is also available.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{data}\PYG{o}{.}\PYG{n}{padPlot}\PYG{p}{(}\PYG{n}{keys} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{orb5}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{Erange} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{]}\PYG{p}{,} \PYG{n}{pStyle}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{grid}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Found dims (\PYGZsq{}Labels\PYGZsq{}, \PYGZsq{}Phi\PYGZsq{}, \PYGZsq{}Theta\PYGZsq{}, \PYGZsq{}Eke\PYGZsq{}, \PYGZsq{}Sym\PYGZsq{}), summing to reduce for plot. Pass selDims to avoid.
Grid plot: 3sg\PYGZhy{}1
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_22_1}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Various other args can be passed...}

\PYG{c+c1}{\PYGZsh{} Set a plotting backend, currently \PYGZsq{}mpl\PYGZsq{} (Matplotlib \PYGZhy{} default) or \PYGZsq{}pl\PYGZsq{} (Plotly \PYGZhy{} interactive, but may give issues in some environments)}
\PYG{n}{backend} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{pl}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Subselect on dimensions, this is set as a dictionary for Xarray selection (see http://xarray.pydata.org/en/stable/indexing.html\PYGZsh{}indexing\PYGZhy{}with\PYGZhy{}dimension\PYGZhy{}names)}
\PYG{n}{selDims} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Labels}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{z}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}  \PYG{c+c1}{\PYGZsh{} Plot z\PYGZhy{}pol case only.}

\PYG{n}{data}\PYG{o}{.}\PYG{n}{padPlot}\PYG{p}{(}\PYG{n}{Erange} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{]}\PYG{p}{,} \PYG{n}{selDims}\PYG{o}{=}\PYG{n}{selDims}\PYG{p}{,} \PYG{n}{backend} \PYG{o}{=} \PYG{n}{backend}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Found dims (\PYGZsq{}Phi\PYGZsq{}, \PYGZsq{}Theta\PYGZsq{}, \PYGZsq{}Eke\PYGZsq{}, \PYGZsq{}Sym\PYGZsq{}), summing to reduce for plot. Pass selDims to avoid.
Sph plots: 1piu\PYGZhy{}1
Plotting with pl
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_23_2}.png}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
Found dims (\PYGZsq{}Phi\PYGZsq{}, \PYGZsq{}Theta\PYGZsq{}, \PYGZsq{}Eke\PYGZsq{}, \PYGZsq{}Sym\PYGZsq{}), summing to reduce for plot. Pass selDims to avoid.
Sph plots: 3sg\PYGZhy{}1
Plotting with pl
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_23_4}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\subsection{Compute \protect\(\beta_{LM}\protect\) parameters}
\label{\detokenize{testChpt/ePSproc_class_demo_161020:compute-beta-lm-parameters}}
\sphinxAtStartPar
For computation of \(\beta_{LM}\) parameters the class wraps functions from \sphinxcode{\sphinxupquote{epsproc.geom}}, which implement a tensor method. This is quite fast, although memory heavy, so may not be suitable for very large problems. (See the \sphinxhref{https://epsproc.readthedocs.io/en/latest/methods/geometric\_method\_dev\_260220\_090420\_tidy.html}{method development pages for more info}, more concise notes to follow).
\begin{itemize}
\item {} 
\sphinxAtStartPar
Functions are provided for MF and AF problems (which is the general case, and will equate to the LF case for an unaligned ensemble).

\item {} 
\sphinxAtStartPar
For the MF the class wraps \sphinxcode{\sphinxupquote{ep.geom.mfblmXprod}}, see the \sphinxhref{https://epsproc.readthedocs.io/en/latest/methods/geometric\_method\_dev\_pt2\_170320\_v140420.html}{method development page for more info}, more concise notes to follow.

\item {} 
\sphinxAtStartPar
For the AF the class wraps \sphinxcode{\sphinxupquote{ep.geom.afblmXprod}}, see the \sphinxhref{https://epsproc.readthedocs.io/en/latest/methods/geometric\_method\_dev\_pt3\_AFBLM\_090620\_010920\_dev\_bk100920.html}{method development page for more info}, more concise notes to follow.

\end{itemize}


\subsubsection{Compute MF \protect\(\beta_{LM}\protect\) and PADs}
\label{\detokenize{testChpt/ePSproc_class_demo_161020:compute-mf-beta-lm-and-pads}}
\sphinxAtStartPar
Here’s a quick demo for the default MF cases, which will give parameters corresponding to the \((z,x,y)\) polarization geometries computed by the numerical routine above.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{data}\PYG{o}{.}\PYG{n}{MFBLM}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Calculating MF\PYGZhy{}BLMs for job key: orb6
Return type BLM.

Calculating MF\PYGZhy{}BLMs for job key: orb5
Return type BLM.
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
Plotting still needs to improve… but ep.lmPlot() is a robust way to plot everything.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} data.BLMplot(dataType = \PYGZsq{}MFBLM\PYGZsq{})  \PYGZsh{} HORRIBLE OUTPUT at the moment!!!}
\PYG{n}{data}\PYG{o}{.}\PYG{n}{lmPlot}\PYG{p}{(}\PYG{n}{dataType} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MFBLM}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Plotting data n2\PYGZus{}1pu\PYGZus{}0.1\PYGZhy{}50.1eV\PYGZus{}A2.inp.out, pType=a, thres=0.01, with Seaborn
Plotting data n2\PYGZus{}3sg\PYGZus{}0.1\PYGZhy{}50.1eV\PYGZus{}A2.inp.out, pType=a, thres=0.01, with Seaborn
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_28_1}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_28_2}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
Line\sphinxhyphen{}plots are available with the \sphinxcode{\sphinxupquote{BLMplot}} method, although this currently only supports the Matplotlib backend, and may have problems with dims in some cases (work in progress!).

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{data}\PYG{o}{.}\PYG{n}{BLMplot}\PYG{p}{(}\PYG{n}{dataType}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MFBLM}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{thres} \PYG{o}{=} \PYG{l+m+mf}{1e\PYGZhy{}2}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} Passing a threshold value here will remove any spurious BLM parameters.}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Dataset: orb6, 1piu\PYGZhy{}1, MFBLM
Dataset: orb5, 3sg\PYGZhy{}1, MFBLM
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_30_1}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_30_2}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
Polar plots are available for these distributions using the \sphinxcode{\sphinxupquote{padPlot()}} method if the \sphinxcode{\sphinxupquote{dataType}} is passed.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{data}\PYG{o}{.}\PYG{n}{padPlot}\PYG{p}{(}\PYG{n}{keys} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{orb5}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{Erange} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{]}\PYG{p}{,} \PYG{n}{dataType}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MFBLM}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Using default sph betas.
Sph plots: Pol geom: z
Plotting with mpl
Data dims: (\PYGZsq{}Eke\PYGZsq{}, \PYGZsq{}Phi\PYGZsq{}, \PYGZsq{}Theta\PYGZsq{}), subplots on Eke
Sph plots: Pol geom: x
Plotting with mpl
Data dims: (\PYGZsq{}Eke\PYGZsq{}, \PYGZsq{}Phi\PYGZsq{}, \PYGZsq{}Theta\PYGZsq{}), subplots on Eke
Sph plots: Pol geom: y
Plotting with mpl
Data dims: (\PYGZsq{}Eke\PYGZsq{}, \PYGZsq{}Phi\PYGZsq{}, \PYGZsq{}Theta\PYGZsq{}), subplots on Eke
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_32_1}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_32_2}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_32_3}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_32_4}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_32_5}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_32_6}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\subsubsection{Compute LF/AF \protect\(\beta_{LM}\protect\) and PADs}
\label{\detokenize{testChpt/ePSproc_class_demo_161020:compute-lf-af-beta-lm-and-pads}}
\sphinxAtStartPar
Here’s a quick demo for the default AF case (isotropic distribution, hence == LF case).

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{data}\PYG{o}{.}\PYG{n}{AFBLM}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Calculating AF\PYGZhy{}BLMs for job key: orb6

Calculating AF\PYGZhy{}BLMs for job key: orb5
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
Plotting still needs to improve… but ep.lmPlot() is a robust way to plot everything.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} data.BLMplot(dataType = \PYGZsq{}MFBLM\PYGZsq{})  \PYGZsh{} HORRIBLE OUTPUT at the moment!!!}
\PYG{n}{data}\PYG{o}{.}\PYG{n}{lmPlot}\PYG{p}{(}\PYG{n}{dataType} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{AFBLM}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Plotting data n2\PYGZus{}1pu\PYGZus{}0.1\PYGZhy{}50.1eV\PYGZus{}A2.inp.out, pType=a, thres=0.01, with Seaborn
Plotting data n2\PYGZus{}3sg\PYGZus{}0.1\PYGZhy{}50.1eV\PYGZus{}A2.inp.out, pType=a, thres=0.01, with Seaborn
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_36_1}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_36_2}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
Line\sphinxhyphen{}plots are available with the \sphinxcode{\sphinxupquote{BLMplot}} method, although this currently only supports the Matplotlib backend, and may have problems with dims in some cases (work in progress!).

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{data}\PYG{o}{.}\PYG{n}{BLMplot}\PYG{p}{(}\PYG{n}{dataType}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{AFBLM}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{thres} \PYG{o}{=} \PYG{l+m+mf}{1e\PYGZhy{}2}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} Passing a threshold value here will remove any spurious BLM parameters.}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Dataset: orb6, 1piu\PYGZhy{}1, XS
Dataset: orb6, 1piu\PYGZhy{}1, AFBLM
Dataset: orb5, 3sg\PYGZhy{}1, XS
Dataset: orb5, 3sg\PYGZhy{}1, AFBLM
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_38_1}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_38_2}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_38_3}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_38_4}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
Polar plots are available for these distributions using the \sphinxcode{\sphinxupquote{padPlot()}} method.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{data}\PYG{o}{.}\PYG{n}{padPlot}\PYG{p}{(}\PYG{n}{keys} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{orb5}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{Erange} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{]}\PYG{p}{,} \PYG{n}{dataType}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{AFBLM}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} NOTE \PYGZhy{} seem to have an inconsistency with (x,y) pol geometries here \PYGZhy{} should check source code \PYGZam{} fix. Likely due to mix\PYGZhy{}up in frame defns., i.e. probably mixing LF and MF pol geom defn. \PYGZhy{} TBC.}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Found dims (\PYGZsq{}Labels\PYGZsq{}, \PYGZsq{}t\PYGZsq{}, \PYGZsq{}Eke\PYGZsq{}, \PYGZsq{}BLM\PYGZsq{}), summing to reduce for plot. Pass selDims to avoid.
Using default sph betas.
Sph plots: Pol geom: z
Plotting with mpl
Data dims: (\PYGZsq{}t\PYGZsq{}, \PYGZsq{}Eke\PYGZsq{}, \PYGZsq{}Phi\PYGZsq{}, \PYGZsq{}Theta\PYGZsq{}), subplots on Eke
Sph plots: Pol geom: x
Plotting with mpl
Data dims: (\PYGZsq{}t\PYGZsq{}, \PYGZsq{}Eke\PYGZsq{}, \PYGZsq{}Phi\PYGZsq{}, \PYGZsq{}Theta\PYGZsq{}), subplots on Eke
Sph plots: Pol geom: y
Plotting with mpl
Data dims: (\PYGZsq{}t\PYGZsq{}, \PYGZsq{}Eke\PYGZsq{}, \PYGZsq{}Phi\PYGZsq{}, \PYGZsq{}Theta\PYGZsq{}), subplots on Eke
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_40_1}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_40_2}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_40_3}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_40_4}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_40_5}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_40_6}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Additions}
\label{\detokenize{testChpt/ePSproc_class_demo_161020:additions}}

\subsection{Plot styles for line\sphinxhyphen{}plots}
\label{\detokenize{testChpt/ePSproc_class_demo_161020:plot-styles-for-line-plots}}
\sphinxAtStartPar
To set to Seaborn plotting style, use \sphinxcode{\sphinxupquote{ep.hvPlotters.setPlotters()}} (note this will be set for all plots after loading, unless overriden). Seaborn must be installed for this to function.

\sphinxAtStartPar
For more on Seaborn styles, see \sphinxhref{https://seaborn.pydata.org/tutorial/aesthetics.html}{the Seaborn docs}.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{epsproc}\PYG{n+nn}{.}\PYG{n+nn}{plot} \PYG{k+kn}{import} \PYG{n}{hvPlotters}
\PYG{n}{hvPlotters}\PYG{o}{.}\PYG{n}{setPlotters}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{data}\PYG{o}{.}\PYG{n}{plotGetCro}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_43_3}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_43_4}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\subsection{Matrix element plotting}
\label{\detokenize{testChpt/ePSproc_class_demo_161020:matrix-element-plotting}}
\sphinxAtStartPar
For a full view of the computational results, use the \sphinxcode{\sphinxupquote{lmPlot()}} method with the default, which correspond to \sphinxcode{\sphinxupquote{dataType=matE}}.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{data}\PYG{o}{.}\PYG{n}{lmPlot}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Plotting data n2\PYGZus{}1pu\PYGZus{}0.1\PYGZhy{}50.1eV\PYGZus{}A2.inp.out, pType=a, thres=0.01, with Seaborn
Plotting data n2\PYGZus{}3sg\PYGZus{}0.1\PYGZhy{}50.1eV\PYGZus{}A2.inp.out, pType=a, thres=0.01, with Seaborn
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_45_1}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_45_2}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
The default here plots abs values, but the same routine can be set for phase plotting.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{data}\PYG{o}{.}\PYG{n}{lmPlot}\PYG{p}{(}\PYG{n}{pType}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{phase}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Plotting data n2\PYGZus{}1pu\PYGZus{}0.1\PYGZhy{}50.1eV\PYGZus{}A2.inp.out, pType=phase, thres=0.01, with Seaborn
Plotting data n2\PYGZus{}3sg\PYGZus{}0.1\PYGZhy{}50.1eV\PYGZus{}A2.inp.out, pType=phase, thres=0.01, with Seaborn
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_47_1}.png}

\noindent\sphinxincludegraphics{{ePSproc_class_demo_161020_47_2}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Versions}
\label{\detokenize{testChpt/ePSproc_class_demo_161020:versions}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{scooby}
\PYG{n}{scooby}\PYG{o}{.}\PYG{n}{Report}\PYG{p}{(}\PYG{n}{additional}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{epsproc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{xarray}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{jupyter}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
  Date: Tue Oct 20 15:57:33 2020 Eastern Daylight Time

                OS : Windows
            CPU(s) : 32
           Machine : AMD64
      Architecture : 64bit
               RAM : 63.9 GB
       Environment : Jupyter

  Python 3.7.3 (default, Apr 24 2019, 15:29:51) [MSC v.1915 64 bit (AMD64)]

           epsproc : 1.3.0\PYGZhy{}dev
            xarray : 0.15.0
           jupyter : Version unknown
             numpy : 1.19.2
             scipy : 1.3.0
           IPython : 7.12.0
        matplotlib : 3.3.1
            scooby : 0.5.6

  Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for
  Intel(R) 64 architecture applications
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{ePSproc Matlab demo}
\label{\detokenize{testChpt/ePSproc_Matlab_demo_notebook_090821:epsproc-matlab-demo}}\label{\detokenize{testChpt/ePSproc_Matlab_demo_notebook_090821::doc}}
\sphinxAtStartPar
As noted in the \DUrole{xref,myst}{main readme/intro doc}, ePSproc originally started as a set of Matlab routines, before migration to Python in 2019. Although no longer maintained/updated since \textasciitilde{}2018, the Matlab routines are still available as part of the ePSproc distribution. This notebook demos the routines, following the demo script \sphinxcode{\sphinxupquote{ePSproc\_NO2\_MFPADs\_demo.m}} (to run this code in a Jupyter environment, a Matlab kernel is required, e.g. \sphinxhref{https://github.com/Calysto/matlab\_kernel}{Calysto’s Matlab kernel}).

\sphinxAtStartPar
Functionality:
\begin{itemize}
\item {} 
\sphinxAtStartPar
Read raw photoionization matrix elements from ePS output files with “dumpIdy” segments

\item {} 
\sphinxAtStartPar
Calculate MF\sphinxhyphen{}PADs from the matrix elements (ePSproc\_MFPAD.m, see also ePSproc\_NO2\_MFPADs\_demo.m)

\item {} 
\sphinxAtStartPar
Plot MF\sphinxhyphen{}PADs

\item {} 
\sphinxAtStartPar
Plot X\sphinxhyphen{}sects

\item {} 
\sphinxAtStartPar
(Beta testing): Calculate MF\sphinxhyphen{}BLMs from matrix elements, see ePSproc\_MFBLM.m

\item {} 
\sphinxAtStartPar
(Under development): Calculate AF\sphinxhyphen{}BLMs from matrix elements.

\end{itemize}

\sphinxAtStartPar
Source:
\begin{itemize}
\item {} 
\sphinxAtStartPar
/matlab: stable matlab code (as per \sphinxcode{\sphinxupquote{release v1.0.1 <https://github.com/phockett/ePSproc/releases>}}\_\_).
\begin{itemize}
\item {} 
\sphinxAtStartPar
a set of functions for processing (ePSproc*.m files)

\item {} 
\sphinxAtStartPar
a script showing demo calculations, \sphinxcode{\sphinxupquote{ePSproc\_NO2\_MFPADs\_demo.m}}

\end{itemize}

\item {} 
\sphinxAtStartPar
/docs/additional contains:
\begin{itemize}
\item {} 
\sphinxAtStartPar
the benchmark results from these calculations, \sphinxcode{\sphinxupquote{ePSproc\_NO2\_testing\_summary\_250915.pdf}}

\item {} 
\sphinxAtStartPar
additional notes on ePS photoionization matrix elements, \sphinxcode{\sphinxupquote{ePSproc\_scattering\_theory\_ePS\_notes\_011015.pdf}}.

\end{itemize}

\end{itemize}

\sphinxAtStartPar
See \sphinxcode{\sphinxupquote{ePSproc: Post\sphinxhyphen{}processing suite for ePolyScat electron\sphinxhyphen{}molecule scattering calculations <https://www.authorea.com/users/71114/articles/122402/\_show\_article>}}\_ for more details.


\section{Setup}
\label{\detokenize{testChpt/ePSproc_Matlab_demo_notebook_090821:setup}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nb}{cd}\PYG{p}{(}\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{\PYGZti{}/github/ePSproc\PYGZsq{}}\PYG{p}{)}\PYG{+w}{  }\PYG{c}{\PYGZpc{} Change to ePSproc root dir.}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
ans =

    \PYGZsq{}9.4.0.813654 (R2018a)\PYGZsq{}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c}{\PYGZpc{}\PYGZpc{} *** SETTINGS}
\PYG{c}{\PYGZpc{}  Set up basic environment}

\PYG{c}{\PYGZpc{} Name \PYGZam{} path to ePS output file. In this version set full file name here, and working directory below.}
\PYG{c}{\PYGZpc{} fileName=\PYGZsq{}no2\PYGZus{}demo\PYGZus{}ePS.out\PYGZsq{}  \PYGZpc{} OK for MFPAD testing, but only single E point}
\PYG{n+nb}{fileName}\PYG{p}{=}\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{n2\PYGZus{}3sg\PYGZus{}0.1\PYGZhy{}50.1eV\PYGZus{}A2.inp.out\PYGZsq{}}

\PYG{c}{\PYGZpc{} Set paths for Linux or Win boxes (optional!)}
\PYG{k}{if}\PYG{+w}{ }\PYG{n+nb}{isunix}
\PYG{+w}{    }\PYG{n}{dirSlash}\PYG{p}{=}\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{/\PYGZsq{}}\PYG{p}{;}
\PYG{k}{else}
\PYG{+w}{    }\PYG{n}{dirSlash}\PYG{p}{=}\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{\PYGZbs{}\PYGZsq{}}\PYG{p}{;}
\PYG{k}{end}

\PYG{n}{filePath}\PYG{p}{=}\PYG{p}{[}\PYG{n+nb}{pwd}\PYG{+w}{ }\PYG{n}{dirSlash}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{data\PYGZsq{}}\PYG{+w}{ }\PYG{n}{dirSlash}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{photoionization\PYGZsq{}}\PYG{p}{]}\PYG{p}{;}\PYG{+w}{                       }\PYG{c}{\PYGZpc{} Root to working directory, here set as current dir/data/photoionization}
\PYG{n}{fileBase}\PYG{p}{=}\PYG{p}{[}\PYG{n}{filePath}\PYG{+w}{ }\PYG{n}{dirSlash}\PYG{+w}{ }\PYG{n+nb}{fileName}\PYG{p}{]}\PYG{p}{;}\PYG{+w}{   }\PYG{c}{\PYGZpc{} Full path to ePS results file, here set as current working direcory}

\PYG{n}{scriptPath}\PYG{p}{=}\PYG{p}{[}\PYG{n+nb}{pwd}\PYG{+w}{ }\PYG{n}{dirSlash}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{matlab\PYGZsq{}}\PYG{+w}{ }\PYG{n}{dirSlash}\PYG{p}{]}\PYG{p}{;}\PYG{+w}{  }\PYG{c}{\PYGZpc{} Add path to ePSproc scrips to Matlab path list, here set as current dir/matlab}
\PYG{n+nb}{path}\PYG{p}{(}\PYG{n+nb}{path}\PYG{p}{,}\PYG{p}{[}\PYG{n}{scriptPath}\PYG{p}{]}\PYG{p}{)}\PYG{p}{;}\PYG{+w}{   }
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
fileName =

    \PYGZsq{}n2\PYGZus{}3sg\PYGZus{}0.1\PYGZhy{}50.1eV\PYGZus{}A2.inp.out\PYGZsq{}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c}{\PYGZpc{}\PYGZpc{} *** Read data}
\PYG{c}{\PYGZpc{}  Variables:}
\PYG{c}{\PYGZpc{}       rlAll contains matrix elements (from DumpIdy segments)}
\PYG{c}{\PYGZpc{}       params contains various calculation parameters}
\PYG{c}{\PYGZpc{}       getCro contains cross\PYGZhy{}section (from GetCro segments), if present}

\PYG{p}{[}\PYG{n}{rlAll}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{params}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{getCro}\PYG{p}{]}\PYG{p}{=}\PYG{n}{ePSproc\PYGZus{}read}\PYG{p}{(}\PYG{n}{fileBase}\PYG{p}{)}\PYG{p}{;}

\PYG{n}{params}\PYG{p}{.}\PYG{n}{fileBase}\PYG{p}{=}\PYG{n}{fileBase}\PYG{p}{;}
\PYG{n}{params}\PYG{p}{.}\PYG{n}{fileName}\PYG{p}{=}\PYG{n+nb}{fileName}\PYG{p}{;}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
*** Reading ePS output file
/home/paul/github/ePSproc/data/photoionization/n2\PYGZus{}3sg\PYGZus{}0.1\PYGZhy{}50.1eV\PYGZus{}A2.inp.out
Found 102 sets of matrix elements
Read 102 sets of matrix elements (0 blank records)
Found 2 symmetries
    \PYGZsq{}SU\PYGZsq{}    \PYGZsq{}PU\PYGZsq{}

Found 51 energies
Found 2 atoms
Found 18 data records
Found 3 sets of cross sections
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c}{\PYGZpc{} Matrix elements are stored in a structure}
\PYG{n}{rlAll}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
rlAll = 

  2x51 struct array with fields:

    eKE
    PE
    symm
    symmSet
    MbNorm
    rawIdyHead
    rawIdy1
    rlnlHead
    rlnl1
    rawIdy2
    rlnl2
    pWaveAll
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c}{\PYGZpc{} GetCro outputs (total cross\PYGZhy{}secions, LF betas)}
\PYG{n}{getCro}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
getCro = 

  1x3 struct array with fields:

    GetCro
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c}{\PYGZpc{} General calculation params}
\PYG{n}{params}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
params = 

  struct with fields:

        symmList: \PYGZob{}\PYGZsq{}SU\PYGZsq{}  \PYGZsq{}PU\PYGZsq{}  \PYGZsq{}All\PYGZsq{}\PYGZcb{}
             eKE: [1x51 double]
         symmAll: \PYGZob{}1x102 cell\PYGZcb{}
            eAll: [1x102 double]
        nRecords: 102
       nEnergies: 51
          nSymms: 2
           gLmax: 11
        blankRec: 0
        missingE: [1x0 double]
        pWaveAll: [144x51x3 double]
      pWaveAllMb: [144x51x3 double]
        LMallInd: [144x2 double]
          coords: \PYGZob{}1x5 cell\PYGZcb{}
     dataRecords: \PYGZob{}18x2 cell\PYGZcb{}
              IP: 15.5800
    GetCroHeader: \PYGZob{}\PYGZob{}1x1 cell\PYGZcb{}\PYGZcb{}
        fileBase: \PYGZsq{}/home/paul/github/ePSproc/data/photoionization/n2\PYGZus{}3sg\PYGZus{}0.1\PYGZhy{}50.1eV\PYGZus{}A2.inp.out\PYGZsq{}
        fileName: \PYGZsq{}n2\PYGZus{}3sg\PYGZus{}0.1\PYGZhy{}50.1eV\PYGZus{}A2.inp.out\PYGZsq{}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Plot cross\sphinxhyphen{}sections and betas}
\label{\detokenize{testChpt/ePSproc_Matlab_demo_notebook_090821:plot-cross-sections-and-betas}}
\sphinxAtStartPar
These are taken from the \sphinxcode{\sphinxupquote{GetCro}} segments in the ePS output files, and correspond to results for an isotropic ensemble of molecules, i.e. observables in the lab frame (LF) for 1\sphinxhyphen{}photon ionization (see \sphinxhref{https://epsproc.readthedocs.io/en/latest/ePS\_ePSproc\_tutorial/ePS\_tutorial\_080520.html\#Theoretical-background}{the ePS tutorial for more details}).

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c}{\PYGZpc{}\PYGZpc{} Plot GetCro results for each symm \PYGZam{} total}

\PYG{n}{col}\PYG{p}{=}\PYG{l+m+mi}{2}\PYG{p}{;}\PYG{+w}{  }\PYG{c}{\PYGZpc{} Select column from getCro output (see params.GetCroHeader)}

\PYG{n+nb}{figure}\PYG{p}{(}\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{color\PYGZsq{}}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,}\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{name\PYGZsq{}}\PYG{p}{,}\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{GetCro outputs\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}

\PYG{k}{for}\PYG{+w}{ }\PYG{n}{n}\PYG{p}{=}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{n+nb}{length}\PYG{p}{(}\PYG{n}{getCro}\PYG{p}{)}
\PYG{+w}{    }\PYG{n+nb}{plot}\PYG{p}{(}\PYG{n}{getCro}\PYG{p}{(}\PYG{n}{n}\PYG{p}{)}\PYG{p}{.}\PYG{n}{GetCro}\PYG{p}{(}\PYG{p}{:}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{o}{\PYGZhy{}}\PYG{n}{params}\PYG{p}{.}\PYG{n}{IP}\PYG{p}{,}\PYG{n}{getCro}\PYG{p}{(}\PYG{n}{n}\PYG{p}{)}\PYG{p}{.}\PYG{n}{GetCro}\PYG{p}{(}\PYG{p}{:}\PYG{p}{,}\PYG{n}{col}\PYG{p}{)}\PYG{p}{)}\PYG{p}{;}
\PYG{+w}{    }\PYG{n}{hold}\PYG{+w}{ }\PYG{l+s}{on}\PYG{p}{;}
\PYG{k}{end}

\PYG{n+nb}{title}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{p}{[}\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{NO\PYGZus{}2 ePS resutls, files \PYGZsq{}}\PYG{+w}{ }\PYG{n+nb}{strrep}\PYG{p}{(}\PYG{n+nb}{fileName}\PYG{p}{,}\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{\PYGZus{}\PYGZsq{}}\PYG{p}{,}\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{\PYGZbs{}\PYGZus{}\PYGZsq{}}\PYG{p}{)}\PYG{p}{]}\PYG{p}{;}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{X\PYGZhy{}sects from ePS(GetCro) results\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\PYG{n+nb}{xlabel}\PYG{p}{(}\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{eKE/eV\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{n+nb}{ylabel}\PYG{p}{(}\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{X\PYGZhy{}sect/Mb\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}

\PYG{n+nb}{legend}\PYG{p}{(}\PYG{p}{[}\PYG{n}{params}\PYG{p}{.}\PYG{n}{symmList}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{Sum\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Warning: MATLAB has disabled some advanced graphics rendering features by switching to software OpenGL. For more information, click \PYGZlt{}a href=\PYGZdq{}matlab:opengl(\PYGZsq{}problems\PYGZsq{})\PYGZdq{}\PYGZgt{}here\PYGZlt{}/a\PYGZgt{}.
Warning: Ignoring extra legend entries.
\PYGZgt{} In legend\PYGZgt{}set\PYGZus{}children\PYGZus{}and\PYGZus{}strings (line 646)
  In legend\PYGZgt{}make\PYGZus{}legend (line 316)
  In legend (line 259)
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{ePSproc_Matlab_demo_notebook_090821_10_1}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{MFPADs}
\label{\detokenize{testChpt/ePSproc_Matlab_demo_notebook_090821:mfpads}}
\sphinxAtStartPar
These are calculated numerically from the matrix elements, for a given polarization geometry and symmetry (the \sphinxhref{https://epsproc.readthedocs.io/en/dev/demos/ePSproc\_demo\_Aug2019.html\#Calculate-MFPADs}{method is the same as the python version of the routine}).

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c}{\PYGZpc{}\PYGZpc{} *** Calculate MFPADs \PYGZhy{} single polarization geometry, all energies and symmetries}
\PYG{c}{\PYGZpc{}  Calculate for specified Euler angles (polarization geometry) \PYGZam{} energies}

\PYG{c}{\PYGZpc{} Set resolution for calculated I(theta,phi) surfaces}
\PYG{n}{res}\PYG{p}{=}\PYG{l+m+mi}{100}\PYG{p}{;}

\PYG{c}{\PYGZpc{} ip components to use from ePS output (1=length gauge, 2=velocity gauge)}
\PYG{n}{ipComponents}\PYG{p}{=}\PYG{l+m+mi}{1}\PYG{p}{;}

\PYG{c}{\PYGZpc{} it components to use from ePS output (for degenerate cases), set an array here for as many components as required, e.g. it=1, it=[1 2] etc.}
\PYG{n}{it}\PYG{p}{=}\PYG{l+m+mi}{1}\PYG{p}{;}

\PYG{c}{\PYGZpc{} Set light polarization and axis rotations LF \PYGZhy{}\PYGZgt{} MF}
\PYG{n}{p}\PYG{p}{=}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{+w}{                }\PYG{c}{\PYGZpc{} p=0 for linearly pol. light, +/\PYGZhy{}1 for L/R circ. pol.}
\PYG{n}{eAngs}\PYG{p}{=}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{;}\PYG{+w}{      }\PYG{c}{\PYGZpc{} Eugler angles for rotation of LF\PYGZhy{}\PYGZgt{}MF, set as [0 0 0] for z\PYGZhy{}pol, [0 pi/2 0] for x\PYGZhy{}pol, [pi/2 pi/2 0] for y\PYGZhy{}pol}
\PYG{n}{polLabel}\PYG{p}{=}\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{z\PYGZsq{}}\PYG{p}{;}

\PYG{c}{\PYGZpc{} Run calculation \PYGZhy{} outputs are D, full set of MFPADs (summed over symmetries); Xsect, calculated X\PYGZhy{}sects; calcsAll, structure with results for all symmetries.}
\PYG{p}{[}\PYG{n}{Xsect}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{calcsAll}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{pWaves}\PYG{p}{]}\PYG{p}{=}\PYG{n}{ePSproc\PYGZus{}MFPAD}\PYG{p}{(}\PYG{n}{rlAll}\PYG{p}{,}\PYG{n}{p}\PYG{p}{,}\PYG{n}{eAngs}\PYG{p}{,}\PYG{n}{it}\PYG{p}{,}\PYG{n}{ipComponents}\PYG{p}{,}\PYG{n}{res}\PYG{p}{)}\PYG{p}{;}

\PYG{c}{\PYGZpc{} Add pol labels \PYGZhy{} currently expected in plotting routine, but not set in MFPAD routine}
\PYG{k}{for}\PYG{+w}{ }\PYG{n}{n}\PYG{p}{=}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{n+nb}{size}\PYG{p}{(}\PYG{n}{calcsAll}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{+w}{    }\PYG{k}{for}\PYG{+w}{ }\PYG{n}{symmIn}\PYG{p}{=}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{n+nb}{size}\PYG{p}{(}\PYG{n}{calcsAll}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{+w}{        }\PYG{n}{calcsAll}\PYG{p}{(}\PYG{n}{symmInd}\PYG{p}{,}\PYG{n}{n}\PYG{p}{)}\PYG{p}{.}\PYG{n}{polLabel}\PYG{p}{=}\PYG{n}{polLabel}\PYG{p}{;}
\PYG{+w}{    }\PYG{k}{end}
\PYG{k}{end}
\PYG{+w}{        }
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c}{\PYGZpc{} Results are output as a structure, dims (symmetries, energies).}
\PYG{n}{calcsAll}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
calcsAll = 

  3x51 struct array with fields:

    D
    C
    Cthres
    eKE
    symm
    euler
    Xsect
    XsectD
    Rlf
    p
    Cind
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c}{\PYGZpc{}plot \PYGZhy{}s 800,400}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
(Above is a line\sphinxhyphen{}magic for setting displayed plot size with the Calysto kernel \sphinxhyphen{} see \sphinxhref{https://nbviewer.jupyter.org/github/Calysto/matlab\_kernel/blob/master/matlab\_kernel.ipynb}{the demo notebook} for more.)

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c}{\PYGZpc{}\PYGZpc{} Plotting \PYGZhy{} MFPAD panel plots}

\PYG{c}{\PYGZpc{} Set plot ranges}
\PYG{n}{symmInd}\PYG{p}{=}\PYG{l+m+mi}{1}\PYG{p}{;}\PYG{+w}{     }\PYG{c}{\PYGZpc{} Select symmetry (by index into calcsAll rows). Final symmetry state is set as sum over all symmetries}
\PYG{c}{\PYGZpc{} eRange=1;      \PYGZpc{} Select energies (by index into calcsAll cols)}
\PYG{n}{eRange}\PYG{p}{=}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{l+m+mi}{3}\PYG{p}{:}\PYG{l+m+mi}{20}\PYG{p}{;}

\PYG{c}{\PYGZpc{} Additional options (optional)}
\PYG{n}{sPlotSet}\PYG{p}{=}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{+w}{ }\PYG{l+m+mi}{4}\PYG{p}{]}\PYG{p}{;}\PYG{+w}{             }\PYG{c}{\PYGZpc{} Set [rows cols] for subplot panels. The final panel will be replaced with a diagram of the geometry}
\PYG{c}{\PYGZpc{} titlePrefix=\PYGZsq{}NO2 testing\PYGZsq{};  \PYGZpc{} Set a title prefix for the figure}
\PYG{n}{titlePrefix}\PYG{p}{=}\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{\PYGZsq{}}\PYG{p}{;}

\PYG{n}{ePSproc\PYGZus{}MFPAD\PYGZus{}plot}\PYG{p}{(}\PYG{n}{calcsAll}\PYG{p}{,}\PYG{n}{eRange}\PYG{p}{,}\PYG{n}{symmInd}\PYG{p}{,}\PYG{n}{params}\PYG{p}{,}\PYG{n}{sPlotSet}\PYG{p}{,}\PYG{n}{titlePrefix}\PYG{p}{)}\PYG{p}{;}
\PYG{c}{\PYGZpc{} ePSproc\PYGZus{}MFPAD\PYGZus{}plot(calcsAll,eRange,symmInd,params,sPlotSet,\PYGZsq{}\PYGZsq{},\PYGZsq{}n\PYGZsq{},\PYGZsq{}off\PYGZsq{});}
\PYG{c}{\PYGZpc{} ePSproc\PYGZus{}MFPAD\PYGZus{}plot(calcsAll,eRange,symmInd,params,[2 4],\PYGZsq{}\PYGZsq{},\PYGZsq{}n\PYGZsq{},\PYGZsq{}off\PYGZsq{});}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{ePSproc_Matlab_demo_notebook_090821_16_0}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c}{\PYGZpc{} Calculate \PYGZam{} plot for a different polarization state}
\PYG{n}{eAngs}\PYG{+w}{ }\PYG{p}{=}\PYG{+w}{ }\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{+w}{ }\PYG{n+nb}{pi}\PYG{o}{/}\PYG{l+m+mi}{2}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{;}\PYG{+w}{  }\PYG{c}{\PYGZpc{} x\PYGZhy{}pol case}
\PYG{n}{polLabel}\PYG{+w}{ }\PYG{p}{=}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{x\PYGZsq{}}\PYG{p}{;}

\PYG{p}{[}\PYG{n}{Xsect}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{calcsAll}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{pWaves}\PYG{p}{]}\PYG{p}{=}\PYG{n}{ePSproc\PYGZus{}MFPAD}\PYG{p}{(}\PYG{n}{rlAll}\PYG{p}{,}\PYG{n}{p}\PYG{p}{,}\PYG{n}{eAngs}\PYG{p}{,}\PYG{n}{it}\PYG{p}{,}\PYG{n}{ipComponents}\PYG{p}{,}\PYG{n}{res}\PYG{p}{)}\PYG{p}{;}

\PYG{c}{\PYGZpc{} Add pol labels \PYGZhy{} currently expected in plotting routine, but not set in MFPAD routine}
\PYG{k}{for}\PYG{+w}{ }\PYG{n}{n}\PYG{p}{=}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{n+nb}{size}\PYG{p}{(}\PYG{n}{calcsAll}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{+w}{    }\PYG{k}{for}\PYG{+w}{ }\PYG{n}{symmIn}\PYG{p}{=}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{n+nb}{size}\PYG{p}{(}\PYG{n}{calcsAll}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{+w}{        }\PYG{n}{calcsAll}\PYG{p}{(}\PYG{n}{symmInd}\PYG{p}{,}\PYG{n}{n}\PYG{p}{)}\PYG{p}{.}\PYG{n}{polLabel}\PYG{p}{=}\PYG{n}{polLabel}\PYG{p}{;}
\PYG{+w}{    }\PYG{k}{end}
\PYG{k}{end}

\PYG{n}{symmInd}\PYG{p}{=}\PYG{l+m+mi}{3}\PYG{p}{;}
\PYG{n}{ePSproc\PYGZus{}MFPAD\PYGZus{}plot}\PYG{p}{(}\PYG{n}{calcsAll}\PYG{p}{,}\PYG{n}{eRange}\PYG{p}{,}\PYG{n}{symmInd}\PYG{p}{,}\PYG{n}{params}\PYG{p}{,}\PYG{n}{sPlotSet}\PYG{p}{,}\PYG{n}{titlePrefix}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
symmInd =

     3
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{ePSproc_Matlab_demo_notebook_090821_17_1}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c}{\PYGZpc{} Calculate \PYGZam{} plot for a different polarization state}
\PYG{n}{eAngs}\PYG{+w}{ }\PYG{p}{=}\PYG{+w}{ }\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{+w}{ }\PYG{n+nb}{pi}\PYG{o}{/}\PYG{l+m+mi}{4}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{;}\PYG{+w}{  }\PYG{c}{\PYGZpc{} Diagonal pol case}
\PYG{n}{polLabel}\PYG{+w}{ }\PYG{p}{=}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{x\PYGZsq{}}\PYG{p}{;}

\PYG{p}{[}\PYG{n}{Xsect}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{calcsAll}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{pWaves}\PYG{p}{]}\PYG{p}{=}\PYG{n}{ePSproc\PYGZus{}MFPAD}\PYG{p}{(}\PYG{n}{rlAll}\PYG{p}{,}\PYG{n}{p}\PYG{p}{,}\PYG{n}{eAngs}\PYG{p}{,}\PYG{n}{it}\PYG{p}{,}\PYG{n}{ipComponents}\PYG{p}{,}\PYG{n}{res}\PYG{p}{)}\PYG{p}{;}

\PYG{c}{\PYGZpc{} Add pol labels \PYGZhy{} currently expected in plotting routine, but not set in MFPAD routine}
\PYG{k}{for}\PYG{+w}{ }\PYG{n}{n}\PYG{p}{=}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{n+nb}{size}\PYG{p}{(}\PYG{n}{calcsAll}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{+w}{    }\PYG{k}{for}\PYG{+w}{ }\PYG{n}{symmIn}\PYG{p}{=}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{n+nb}{size}\PYG{p}{(}\PYG{n}{calcsAll}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{+w}{        }\PYG{n}{calcsAll}\PYG{p}{(}\PYG{n}{symmInd}\PYG{p}{,}\PYG{n}{n}\PYG{p}{)}\PYG{p}{.}\PYG{n}{polLabel}\PYG{p}{=}\PYG{n}{polLabel}\PYG{p}{;}
\PYG{+w}{    }\PYG{k}{end}
\PYG{k}{end}

\PYG{c}{\PYGZpc{} Plot all symmetries}
\PYG{k}{for}\PYG{+w}{ }\PYG{n}{symmInd}\PYG{+w}{ }\PYG{p}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{l+m+mi}{3}
\PYG{+w}{    }\PYG{n}{ePSproc\PYGZus{}MFPAD\PYGZus{}plot}\PYG{p}{(}\PYG{n}{calcsAll}\PYG{p}{,}\PYG{n}{eRange}\PYG{p}{,}\PYG{n}{symmInd}\PYG{p}{,}\PYG{n}{params}\PYG{p}{,}\PYG{n}{sPlotSet}\PYG{p}{,}\PYG{n}{titlePrefix}\PYG{p}{)}\PYG{p}{;}
\PYG{+w}{    }
\PYG{k}{end}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{ePSproc_Matlab_demo_notebook_090821_18_0}.png}

\noindent\sphinxincludegraphics{{ePSproc_Matlab_demo_notebook_090821_18_1}.png}

\noindent\sphinxincludegraphics{{ePSproc_Matlab_demo_notebook_090821_18_2}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{MF \protect\(\beta_{LM}\protect\)}
\label{\detokenize{testChpt/ePSproc_Matlab_demo_notebook_090821:mf-beta-lm}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c}{\PYGZpc{}\PYGZpc{} *** Calculate MFPADs \PYGZhy{} single polarization geometry, all energies and symmetries}
\PYG{c}{\PYGZpc{}  Calculate for specified Euler angles (polarization geometry) \PYGZam{} energies}

\PYG{c}{\PYGZpc{} Set resolution for calculated I(theta,phi) surfaces}
\PYG{n}{res}\PYG{p}{=}\PYG{l+m+mi}{100}\PYG{p}{;}

\PYG{c}{\PYGZpc{} ip components to use from ePS output (1=length gauge, 2=velocity gauge)}
\PYG{n}{ipComponents}\PYG{p}{=}\PYG{l+m+mi}{1}\PYG{p}{;}

\PYG{c}{\PYGZpc{} it components to use from ePS output (for degenerate cases), set an array here for as many components as required, e.g. it=1, it=[1 2] etc.}
\PYG{n}{it}\PYG{p}{=}\PYG{l+m+mi}{1}\PYG{p}{;}

\PYG{c}{\PYGZpc{} Set light polarization and axis rotations LF \PYGZhy{}\PYGZgt{} MF}
\PYG{n}{p}\PYG{p}{=}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{+w}{                }\PYG{c}{\PYGZpc{} p=0 for linearly pol. light, +/\PYGZhy{}1 for L/R circ. pol.}
\PYG{n}{eAngs}\PYG{p}{=}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{;}\PYG{+w}{      }\PYG{c}{\PYGZpc{} Eugler angles for rotation of LF\PYGZhy{}\PYGZgt{}MF, set as [0 0 0] for z\PYGZhy{}pol, [0 pi/2 0] for x\PYGZhy{}pol, [pi/2 pi/2 0] for y\PYGZhy{}pol}
\PYG{n}{polLabel}\PYG{p}{=}\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{z\PYGZsq{}}\PYG{p}{;}

\PYG{c}{\PYGZpc{} Run calculation \PYGZhy{} outputs are D, full set of MFPADs (summed over symmetries); Xsect, calculated X\PYGZhy{}sects; calcsAll, structure with results for all symmetries.}
\PYG{n}{calcsAll}\PYG{p}{=}\PYG{n}{ePSproc\PYGZus{}MFPAD}\PYG{p}{(}\PYG{n}{rlAll}\PYG{p}{,}\PYG{n}{p}\PYG{p}{,}\PYG{n}{eAngs}\PYG{p}{,}\PYG{n}{it}\PYG{p}{,}\PYG{n}{ipComponents}\PYG{p}{,}\PYG{n}{res}\PYG{p}{)}\PYG{p}{;}

\PYG{c}{\PYGZpc{} Add pol labels \PYGZhy{} currently expected in plotting routine, but not set in MFPAD routine}
\PYG{c}{\PYGZpc{} for n=1:size(calcsAll,2)}
\PYG{c}{\PYGZpc{}     for symmIn=1:size(calcsAll,1)}
\PYG{c}{\PYGZpc{}         calcsAll(symmInd,n).polLabel=polLabel;}
\PYG{c}{\PYGZpc{}     end}
\PYG{c}{\PYGZpc{} end}
\PYG{+w}{        }
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nb}{plot}\PYG{p}{(}\PYG{n}{calcsAll}\PYG{p}{.}\PYG{o}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{ePSproc_Matlab_demo_notebook_090821_21_0}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}






\renewcommand{\indexname}{Index}
\printindex
\end{document}