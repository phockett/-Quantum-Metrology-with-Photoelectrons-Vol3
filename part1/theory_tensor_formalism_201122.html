

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>3.3. Tensor formulation of photoionization &#8212; Quantum Metrology with Photoelectrons Vol. 3 *Analysis methodologies*</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"bm": ["\\boldsymbol{#1}", 1]}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'part1/theory_tensor_formalism_201122';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.4. Density matrix representation" href="theory_density_matrices_310123.html" />
    <link rel="prev" title="3.2. Photoionization dynamics" href="theory_photoionization_dynamics_191122.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/ePSproc_logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/ePSproc_logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    About the book
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Frontmatter</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../frontmatter/overview_270122.html">Overview</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Theory &amp; software</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="main_intro_051122.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="platform_intro_071122.html">2. Quantum metrology software platform/ecosystem overview</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="theory_101122.html">3. Theory</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="theory_observables_intro_211122.html">3.1. Observables: photoelectron flux in the LF and MF</a></li>
<li class="toctree-l2"><a class="reference internal" href="theory_photoionization_dynamics_191122.html">3.2. Photoionization dynamics</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">3.3. Tensor formulation of photoionization</a></li>
<li class="toctree-l2"><a class="reference internal" href="theory_density_matrices_310123.html">3.4. Density matrix representation</a></li>
<li class="toctree-l2"><a class="reference internal" href="theory_info_content_221122.html">3.5. Information content &amp; sensitivity</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="numerics_231122.html">4. Numerical methodologies for extracting matrix elements</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Extracting matrix elements - numerical methods &amp; case studies</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../part2/extracting_matrix_elements_overview_270423.html">5. Extracting matrix elements overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../part2/sym-fitting-intro_220423.html">6. Basis sets for fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../part2/basic_fitting_numerics_intro_260423.html">7. Basic fit setup and numerics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../part2/case-study-N2_270423.html">8. Case study: Generalised bootstrapping for a homonuclear diatomic scattering system, <span class="math notranslate nohighlight">\(N_2~(D_{\infty h})\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="../part2/case-study-OCS_270423.html">9. Case study: Generalised bootstrapping for a linear heteronuclear scattering system, <span class="math notranslate nohighlight">\(OCS~(C_{\infty v})\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="../part2/case-study-C2H4_270423.html">10. Case study: Generalised bootstrapping for a general asymmetric top scattering system, <span class="math notranslate nohighlight">\(C_2H_4~(C_{2h})\)</span></a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Backmatter</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../backmatter/bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backmatter/glossary.html">Glossary</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Test pages</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../tests/build_versions_checks.html">Build versions and config tests</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/phockett/Quantum-Metrology-with-Photoelectrons-Vol3" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/phockett/Quantum-Metrology-with-Photoelectrons-Vol3/issues/new?title=Issue%20on%20page%20%2Fpart1/theory_tensor_formalism_201122.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/part1/theory_tensor_formalism_201122.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Tensor formulation of photoionization</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#channel-functions">3.3.1. Channel functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#full-tensor-expansion">3.3.2. Full tensor expansion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#numerical-aside-symmetry-defined-channel-functions">3.3.3. Numerical aside: symmetry-defined channel functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#matrix-element-geometric-coupling-term-b-l-m">3.3.4. Matrix element geometric coupling term <span class="math notranslate nohighlight">\(B_{L,M}\)</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#electric-field-geometric-coupling-term-e-p-r-hat-e-mu-0">3.3.5. Electric field geometric coupling term <span class="math notranslate nohighlight">\({E_{P,R}(\hat{e};\mu_{0})}\)</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#molecular-frame-projection-term-lambda">3.3.6. Molecular frame projection term <span class="math notranslate nohighlight">\(\Lambda\)</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alignment-tensor-delta-l-m-k-q-s">3.3.7. Alignment tensor <span class="math notranslate nohighlight">\(\Delta_{L,M}(K,Q,S)\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-cases">3.3.7.1. Basic cases</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#d-alignments-and-symmetry-breaking">3.3.7.2. 3D alignments and symmetry breaking</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tensor-product-terms">3.3.8. Tensor product terms</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="tensor-formulation-of-photoionization">
<span id="sec-tensor-formulation"></span><h1><span class="section-number">3.3. </span>Tensor formulation of photoionization<a class="headerlink" href="#tensor-formulation-of-photoionization" title="Permalink to this heading">#</a></h1>
<p>A number of authors have treated MFPADs and related problems [REFS]; herein, a geometric tensor based formalism is developed, which is close in spirit to the treatments given by Underwood and co-workers <span id="id1">[<a class="reference internal" href="../backmatter/bibliography.html#id812" title="Albert Stolow and Jonathan G. Underwood. Time-Resolved Photoelectron Spectroscopy of Non-Adiabatic Dynamics in Polyatomic Molecules. In Stuart A. Rice, editor, Advances in Chemical Physics, volume 139, pages 497–584. John Wiley &amp; Sons, Inc., Hoboken, NJ, USA, March 2008. URL: http://doi.wiley.com/10.1002/9780470259498 (visited on 2012-07-18), doi:10.1002/9780470259498.ch6.">49</a>, <a class="reference internal" href="../backmatter/bibliography.html#id754" title="Katharine L. Reid and Jonathan G. Underwood. Extracting molecular axis alignment from photoelectron angular distributions. The Journal of Chemical Physics, 112(8):3643, 2000. URL: http://link.aip.org/link/JCPSA6/v112/i8/p3643/s1&amp;Agg=doi, doi:10.1063/1.480517.">52</a>, <a class="reference internal" href="../backmatter/bibliography.html#id842" title="Jonathan G. Underwood and Katharine L. Reid. Time-resolved photoelectron angular distributions as a probe of intramolecular dynamics: Connecting the molecular frame and the laboratory frame. The Journal of Chemical Physics, 113(3):1067, 2000. URL: http://link.aip.org/link/JCPSA6/v113/i3/p1067/s1&amp;Agg=doi (visited on 2012-07-17), doi:10.1063/1.481918.">53</a>]</span>, but further separates various sets of physical parameters into dedicated tensors; this allows for a unified theoretical and numerical treatment, where the latter computes properties as tensor variables which can be further manipulated and investigated. Furthermore, the tensors can readily be converted to a density matrix representation <span id="id2">[<a class="reference internal" href="../backmatter/bibliography.html#id882" title="Richard N Zare. Angular Momentum: Understanding Spatial Aspects in Chemistry and Physics. John Wiley &amp; Sons, 1988.">44</a>, <a class="reference internal" href="../backmatter/bibliography.html#id479" title="Karl Blum. Density Matrix Theory and Applications. Volume 64. Springer Berlin Heidelberg, Berlin, Heidelberg, 3rd editio edition, 2012. ISBN 978-3-642-20560-6. URL: http://link.springer.com/10.1007/978-3-642-20561-3, doi:10.1007/978-3-642-20561-3.">54</a>]</span>, which is more natural for some quantities, and also emphasizes the link to quantum state tomography and other quantum information techniques. Much of the theoretical background, as well as application to aspects of the current problem, can be found in the textbooks of Blum <span id="id3">[<a class="reference internal" href="../backmatter/bibliography.html#id479" title="Karl Blum. Density Matrix Theory and Applications. Volume 64. Springer Berlin Heidelberg, Berlin, Heidelberg, 3rd editio edition, 2012. ISBN 978-3-642-20560-6. URL: http://link.springer.com/10.1007/978-3-642-20561-3, doi:10.1007/978-3-642-20561-3.">54</a>]</span>
and Zare <span id="id4">[<a class="reference internal" href="../backmatter/bibliography.html#id882" title="Richard N Zare. Angular Momentum: Understanding Spatial Aspects in Chemistry and Physics. John Wiley &amp; Sons, 1988.">44</a>]</span>.</p>
<p>Within this treatment, the observables can be defined in a series of simplified forms, emphasizing the quantities of interest for a given problem. Some details are defined in the following subsections,</p>
<section id="channel-functions">
<span id="sec-channel-funcs"></span><h2><span class="section-number">3.3.1. </span>Channel functions<a class="headerlink" href="#channel-functions" title="Permalink to this heading">#</a></h2>
<p>A simple form of the equations (cf. the general form of Eq. <a class="reference internal" href="theory_photoionization_dynamics_191122.html#equation-eq-i-reduced-lf-2-45-vol1">(3.14)</a>, see also <em>Quantum Metrology</em> Vol. 2 <span id="id5">[<a class="reference internal" href="../backmatter/bibliography.html#id614" title="Paul Hockett. Quantum Metrology with Photoelectrons, Volume 2: Applications and Advances. IOP Publishing, 2018. ISBN 978-1-68174-688-3. URL: http://iopscience.iop.org/book/978-1-6817-4688-3, doi:10.1088/978-1-6817-4688-3.">2</a>]</span> Chpt. 12), amenable to fitting and numerical implementation, is to write the observables in terms of “channel functions”, which define the ionization continuum for a given case and set of parameters <span class="math notranslate nohighlight">\(u\)</span> (e.g. defined for the MF, or defined for a specific experimental configuration),</p>
<div class="math notranslate nohighlight" id="equation-eqn-channel-fns">
<span class="eqno">(3.18)<a class="headerlink" href="#equation-eqn-channel-fns" title="Permalink to this equation">#</a></span>\[\beta_{L,M}^{u}=\sum_{\zeta,\zeta'}\varUpsilon_{L,M}^{u,\zeta\zeta'}\mathbb{I}^{\zeta\zeta'}\]</div>
<p>Where <span class="math notranslate nohighlight">\(\zeta,\zeta'\)</span> collect all the required quantum numbers, and
define all (coherent) pairs of components. The term
<span class="math notranslate nohighlight">\(\mathbb{I}^{\zeta\zeta'}\)</span> denotes the coherent square of the ionization
matrix elements:</p>
<div class="math notranslate nohighlight" id="equation-eqn-i-zeta">
<span class="eqno">(3.19)<a class="headerlink" href="#equation-eqn-i-zeta" title="Permalink to this equation">#</a></span>\[\mathbb{I}^{\zeta,\zeta}=I^{\zeta}(\epsilon)I^{\zeta'*}(\epsilon)
\]</div>
<p>This is effectively a convolution equation (cf. refs. <span id="id6">[<a class="reference internal" href="../backmatter/bibliography.html#id754" title="Katharine L. Reid and Jonathan G. Underwood. Extracting molecular axis alignment from photoelectron angular distributions. The Journal of Chemical Physics, 112(8):3643, 2000. URL: http://link.aip.org/link/JCPSA6/v112/i8/p3643/s1&amp;Agg=doi, doi:10.1063/1.480517.">52</a>, <a class="reference internal" href="../backmatter/bibliography.html#id575" title="Margaret Gregory, Paul Hockett, Albert Stolow, and Varun Makhija. Towards molecular frame photoelectron angular distributions in polyatomic molecules from lab frame coherent rotational wavepacket evolution. Journal of Physics B: Atomic, Molecular and Optical Physics, 54(14):145601, July 2021. URL: https://doi.org/10.1088/1361-6455/ac135f (visited on 2021-08-17), arXiv:2012.04561, doi:10.1088/1361-6455/ac135f.">55</a>]</span>) with channel functions <span class="math notranslate nohighlight">\(\varUpsilon_{L,M}^{u,\zeta\zeta'}\)</span>, for a given “experiment” <span class="math notranslate nohighlight">\(u\)</span>, summed over all terms <span class="math notranslate nohighlight">\(\zeta,\zeta'\)</span>. Aside from the change in notation (which is here chosen to match the formalism of Refs. <span id="id7">[<a class="reference internal" href="../backmatter/bibliography.html#id693" title="Robert R. Lucchese, Kazuo Takatsuka, and Vincent McKoy. Applications of the Schwinger variational principle to electron-molecule collisions and molecular photoionization. Physics Reports, 131(3):147–221, January 1986. URL: http://www.sciencedirect.com/science/article/pii/037015738690147X (visited on 2012-07-18), doi:10.1016/0370-1573(86)90147-X.">15</a>, <a class="reference internal" href="../backmatter/bibliography.html#id567" title="F. A. Gianturco, R. R. Lucchese, and N. Sanna. Calculation of low-energy elastic cross sections for electron-CF4 scattering. The Journal of Chemical Physics, 100(9):6464, May 1994. URL: http://scitation.aip.org/content/aip/journal/jcp/100/9/10.1063/1.467237 (visited on 2015-08-13), doi:10.1063/1.467237.">16</a>, <a class="reference internal" href="../backmatter/bibliography.html#id725" title="Alexandra P P Natalense and Robert R Lucchese. Cross section and asymmetry parameter calculation for sulfur 1s photoionization of SF[sub 6]. The Journal of Chemical Physics, 111(12):5344, 1999. URL: http://link.aip.org/link/JCPSA6/v111/i12/p5344/s1&amp;Agg=doi (visited on 2012-07-18), doi:10.1063/1.479794.">17</a>]</span>),</p>
<p>these matrix elements are essentially identical to the simplified (radial) forms
<span class="math notranslate nohighlight">\(\mathbf{r}_{k,l,m}\)</span> defined in Eqn. <a class="reference internal" href="theory_photoionization_dynamics_191122.html#equation-eq-r-kllam">(3.11)</a>, in the case where <span class="math notranslate nohighlight">\(\zeta=k,l,m\)</span>. Note, also, that the matrix elements used herein are usually assumed to be symmetrized (unless explicitly stated), i.e. expanded in spherical harmonics per Eq. <a class="reference internal" href="theory_observables_intro_211122.html#equation-eq-symharm-defn">(3.2)</a> with any additional terms <span class="math notranslate nohighlight">\(b_{hl\lambda}^{\Gamma\mu}\)</span> incorporated into the value of the matrix elements.</p>
<p>These complex matrix elements can also be equivalently defined in a magnitude, phase
form:</p>
<div class="math notranslate nohighlight" id="equation-eqn-i-zeta-mag-phase">
<span class="eqno">(3.20)<a class="headerlink" href="#equation-eqn-i-zeta-mag-phase" title="Permalink to this equation">#</a></span>\[I^{\zeta}(\epsilon)\equiv\mathbf{r}_{\zeta}\equiv r_{\zeta}e^{i\phi_{\zeta}}\]</div>
<p>This tensorial form is numerically implemented in the <a class="reference external" href="https://github.com/phockett/ePSproc">ePSproc</a> <span id="id8">[<a class="reference internal" href="../backmatter/bibliography.html#id547" title="Paul Hockett. ePSproc: Post-processing for ePolyScat (Github repository). Github, 2016. URL: https://github.com/phockett/ePSproc, doi:10.6084/m9.figshare.3545639.">13</a>]</span> codebase, and is in contradistinction to standard numerical routines in which the requisite terms are usually computed from vectorial and/or nested summations, which can be somewhat opaque to
detailed interpretation, and typically implement the full computation of the observables in one monolithic computational routine. The <a class="reference external" href="https://github.com/phockett/PEMtk">Photoelectron Metrology Toolkit</a> <span id="id9">[<a class="reference internal" href="../backmatter/bibliography.html#id618" title="Paul Hockett. Photoelectron Metrology Toolkit (PEMtk) Github repository. 2021. URL: https://github.com/phockett/PEMtk (visited on 2022-02-18).">4</a>]</span> codebase implements matrix element retrieval based on the tensor formalism, with pre-computation of all the geometric tensor components (channel functions) prior to a fitting protocol for matrix element analysis, essentially a fit to Eqn. <a class="reference internal" href="#equation-eqn-channel-fns">(3.18)</a>, with terms <span class="math notranslate nohighlight">\(I^{\zeta}(\epsilon)\)</span> as the unknowns (in magnitude, phase form per <a class="reference internal" href="#equation-eqn-i-zeta-mag-phase">(3.20)</a>). The main computational cost of a tensor-based approach is that more RAM is required to store the full set of tensor variables; however, the method is computationally efficient since it is inherently parallel (as compared to a traditional, serial loop-based solution), hence may lead to significantly faster evaluation of observables. Furthermore, the method allows for the computational routines to match the formalism quite closely, and investigation of the properties of the channel functions for a given problem in general terms, as well as for specific experimental cases.</p>
</section>
<section id="full-tensor-expansion">
<span id="sec-full-tensor-expansion"></span><h2><span class="section-number">3.3.2. </span>Full tensor expansion<a class="headerlink" href="#full-tensor-expansion" title="Permalink to this heading">#</a></h2>
<p>In more detail, the channel functions <span class="math notranslate nohighlight">\(\varUpsilon_{L,M}^{u,\zeta\zeta'}\)</span> can be given as a set of tensors, defining each aspect of the problem. The following equations illustrate this for the <a class="reference internal" href="../backmatter/glossary.html#term-MF"><span class="xref std std-term">MF</span></a> and <a class="reference internal" href="../backmatter/glossary.html#term-LF"><span class="xref std std-term">LF</span></a>/<a class="reference internal" href="../backmatter/glossary.html#term-AF"><span class="xref std std-term">AF</span></a> cases, fully expanding the general form of Eq. <a class="reference internal" href="#equation-eqn-channel-fns">(3.18)</a> in terms of the relevant tensors. Further details and numerical examples are given in the following sub-sections.</p>
<p>For the MF:</p>
<div class="math notranslate nohighlight" id="equation-eq-blm-tensor-mf">
<span class="eqno">(3.21)<a class="headerlink" href="#equation-eq-blm-tensor-mf" title="Permalink to this equation">#</a></span>\[\begin{split}\begin{aligned}
\beta_{L,-M}^{\mu_{i},\mu_{f}}(\epsilon) &amp; = &amp; (-1)^{M}\sum_{P,R',R}{[P]^{\frac{1}{2}}}{E_{P-R}(\hat{e};\mu_{0})}\\
 &amp; \times &amp;\sum_{l,m,\mu}\sum_{l',m',\mu'}(-1)^{(\mu'-\mu_{0})}{\Lambda_{R',R}(R_{\hat{n}};\mu,P,R,R')B_{L,-M}(l,l',m,m')}\\
 &amp; \times &amp; I_{l,m,\mu}^{p_{i}\mu_{i},p_{f}\mu_{f}}(\epsilon)I_{l',m',\mu'}^{p_{i}\mu_{i},p_{f}\mu_{f}*}(\epsilon)\end{aligned}\end{split}\]</div>
<p>And the LF/AF as:</p>
<div class="math notranslate nohighlight" id="equation-eq-blm-tensor-af">
<span class="eqno">(3.22)<a class="headerlink" href="#equation-eq-blm-tensor-af" title="Permalink to this equation">#</a></span>\[\begin{split}\begin{aligned}
\bar{\beta}_{L,-M}^{\mu_{i},\mu_{f}}(\epsilon,t) &amp; = &amp; (-1)^{M}\sum_{P,R',R}{[P]^{\frac{1}{2}}}{E_{P-R}(\hat{e};\mu_{0})}\\
 &amp; \times &amp;\sum_{l,m,\mu}\sum_{l',m',\mu'}(-1)^{(\mu'-\mu_{0})}{\bar{\Lambda}_{R'}(\mu,P,R')B_{L,S-R'}(l,l',m,m')}\\
 &amp; \times &amp;I_{l,m,\mu}^{p_{i}\mu_{i},p_{f}\mu_{f}}(\epsilon)I_{l',m',\mu'}^{p_{i}\mu_{i},p_{f}\mu_{f}*}(\epsilon)\sum_{K,Q,S}\Delta_{L,M}(K,Q,S)A_{Q,S}^{K}(t)\end{aligned}\end{split}\]</div>
<p>In both cases a set of geometric tensor terms are required,</p>
<p>these terms provide details of:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\({E_{P-R}(\hat{e};\mu_{0})}\)</span>: polarization geometry &amp; coupling with
the electric field.</p></li>
<li><p><span class="math notranslate nohighlight">\(B_{L,M}(l,l',m,m')\)</span>: geometric coupling of the partial waves into the <span class="math notranslate nohighlight">\(\beta_{L,M}\)</span> terms (spherical tensors). Note for the <a class="reference internal" href="../backmatter/glossary.html#term-AF"><span class="xref std std-term">AF</span></a> case the terms may be reindexed by <span class="math notranslate nohighlight">\(M=S-R'\)</span>, which allows for the projection dependence on the <a class="reference internal" href="../backmatter/glossary.html#term-ADMs"><span class="xref std std-term">ADMs</span></a> (see below).</p></li>
<li><p><span class="math notranslate nohighlight">\(\Lambda_{R',R}(R_{\hat{n}};\mu,P,R,R')\)</span>, <span class="math notranslate nohighlight">\(\bar{\Lambda}_{R'}(\mu,P,R')\)</span>: frame couplings and rotations (note slightly different terms for <a class="reference internal" href="../backmatter/glossary.html#term-MF"><span class="xref std std-term">MF</span></a> and <a class="reference internal" href="../backmatter/glossary.html#term-AF"><span class="xref std std-term">AF</span></a>).</p></li>
<li><p><span class="math notranslate nohighlight">\(\Delta_{L,M}(K,Q,S)\)</span>: alignment frame coupling (<a class="reference internal" href="../backmatter/glossary.html#term-AF"><span class="xref std std-term">AF</span></a> only).</p></li>
<li><p><span class="math notranslate nohighlight">\(A_{Q,S}^{K}(t)\)</span>: ensemble alignment described as a set of <a class="reference internal" href="../backmatter/glossary.html#term-Axis-distribution-moments"><span class="xref std std-term">axis distribution moments</span></a> (<a class="reference internal" href="../backmatter/glossary.html#term-ADMs"><span class="xref std std-term">ADMs</span></a>, <a class="reference internal" href="../backmatter/glossary.html#term-AF"><span class="xref std std-term">AF</span></a> only).</p></li>
<li><p>Square-brackets indicate degeneracy terms, e.g. <span class="math notranslate nohighlight">\([P]^{\frac{1}{2}} = (2P+1)^{\frac{1}{2}}\)</span>.</p></li>
</ul>
<p>And <span class="math notranslate nohighlight">\(I_{l,m,\mu}^{p_{i}\mu_{i},p_{f}\mu_{f}}(\epsilon)\)</span> are the (radial)
dipole ionization matrix elements, as a function of energy <span class="math notranslate nohighlight">\(\epsilon\)</span>.
These matrix elements are essentially identical to the simplified forms
<span class="math notranslate nohighlight">\(r_{k,l,m}\)</span> defined in Eqn. <a class="reference internal" href="theory_photoionization_dynamics_191122.html#equation-eq-r-kllam">(3.11)</a>, except with additional indices to label
symmetry and polarization components defined by a set of partial-waves
<span class="math notranslate nohighlight">\(\{l,m\}\)</span>, for polarization component <span class="math notranslate nohighlight">\(\mu\)</span> (denoting the photon angular
momentum components) and channels (symmetries) labelled by initial and
final state indexes <span class="math notranslate nohighlight">\((p_{i}\mu_{i},p_{f}\mu_{f})\)</span>. The notation here
follows that used by <a class="reference external" href="https://epolyscat.droppages.com/">ePolyScat (ePS)</a> <span id="id10">[<a class="reference internal" href="../backmatter/bibliography.html#id693" title="Robert R. Lucchese, Kazuo Takatsuka, and Vincent McKoy. Applications of the Schwinger variational principle to electron-molecule collisions and molecular photoionization. Physics Reports, 131(3):147–221, January 1986. URL: http://www.sciencedirect.com/science/article/pii/037015738690147X (visited on 2012-07-18), doi:10.1016/0370-1573(86)90147-X.">15</a>, <a class="reference internal" href="../backmatter/bibliography.html#id567" title="F. A. Gianturco, R. R. Lucchese, and N. Sanna. Calculation of low-energy elastic cross sections for electron-CF4 scattering. The Journal of Chemical Physics, 100(9):6464, May 1994. URL: http://scitation.aip.org/content/aip/journal/jcp/100/9/10.1063/1.467237 (visited on 2015-08-13), doi:10.1063/1.467237.">16</a>, <a class="reference internal" href="../backmatter/bibliography.html#id725" title="Alexandra P P Natalense and Robert R Lucchese. Cross section and asymmetry parameter calculation for sulfur 1s photoionization of SF[sub 6]. The Journal of Chemical Physics, 111(12):5344, 1999. URL: http://link.aip.org/link/JCPSA6/v111/i12/p5344/s1&amp;Agg=doi (visited on 2012-07-18), doi:10.1063/1.479794.">17</a>, <a class="reference internal" href="../backmatter/bibliography.html#id696" title="R R Lucchese. ePolyScat User's Manual. URL: https://epolyscat.droppages.com/ (visited on 2022-04-26).">18</a>]</span>, and these matrix elements again represent the quantities to be obtained numerically from data analysis, or from an <a class="reference external" href="https://epsproc.readthedocs.io/en/latest/ePS_ePSproc_tutorial/ePS_tutorial_080520.html#Theoretical-background">ePolyScat (or similar) calculation</a>.</p>
<p>Following the tensor components detailed above, the full form of the channel functions of Eq. <a class="reference internal" href="#equation-eqn-channel-fns">(3.18)</a> for the <a class="reference internal" href="../backmatter/glossary.html#term-AF"><span class="xref std std-term">AF</span></a> and <a class="reference internal" href="../backmatter/glossary.html#term-MF"><span class="xref std std-term">MF</span></a> can be written as:</p>
<div class="math notranslate nohighlight" id="equation-eq-channelfunc-mf-defn">
<span class="eqno">(3.23)<a class="headerlink" href="#equation-eq-channelfunc-mf-defn" title="Permalink to this equation">#</a></span>\[\begin{split}
\begin{aligned}
\varUpsilon_{L,M}^{u,\zeta\zeta'} &amp; = &amp; (-1)^{M}{[P]^{\frac{1}{2}}}E_{P-R}(\hat{e};\mu_{0})(-1)^{(\mu'-\mu_{0})}\Lambda_{R',R}(R_{\hat{n}};\mu,P,R,R')\\
 &amp; \times &amp; B_{L,-M}(l,l',m,m')\end{aligned}
\end{split}\]</div>
<div class="math notranslate nohighlight" id="equation-eq-channelfunc-af-defn">
<span class="eqno">(3.24)<a class="headerlink" href="#equation-eq-channelfunc-af-defn" title="Permalink to this equation">#</a></span>\[\begin{split}
\begin{aligned}
\bar{\varUpsilon_{}}_{L,M}^{u,\zeta\zeta'} &amp; = &amp; (-1)^{M}[P]^{\frac{1}{2}}E_{P-R}(\hat{e};\mu_{0})(-1)^{(\mu'-\mu_{0})}\bar{\Lambda}_{R'}(\mu,P,R')\\
 &amp; \times &amp; B_{L,S-R'}(l,l',m,m')\Delta_{L,M}(K,Q,S)A_{Q,S}^{K}(t)\end{aligned}
\end{split}\]</div>
<p>Note that, in this case as given, time-dependence arises purely from the
<span class="math notranslate nohighlight">\(A_{Q,S}^{K}(t)\)</span> terms in the AF case, and the electric field term
currently describes only the photon angular momentum coupling, although
can in principle also describe time-dependent/shaped fields. Similarly,
a time-dependent initial state (e.g. a vibrational wavepacket) could
also describe a time-dependent MF case.</p>
<p>It should be emphasized, however, that the underlying physical
quantities are essentially identical in all the theoretical approaches,
with a set of coupled angular-momenta defining the geometrical part of
the photoionization problem, despite these differences in the details of
the theory and notation.</p>
<p>The various tensors defined above are implemented as functions in the <a class="reference external" href="https://epsproc.readthedocs.io">ePSproc codebase</a> <span id="id11">[<a class="reference internal" href="../backmatter/bibliography.html#id605" title="Paul Hockett. ePSproc: Post-processing suite for ePolyScat electron-molecule scattering calculations. Authorea, 2016. URL: https://www.authorea.com/users/71114/articles/122402/_show_article, doi:10.6084/m9.figshare.3545639.">12</a>, <a class="reference internal" href="../backmatter/bibliography.html#id547" title="Paul Hockett. ePSproc: Post-processing for ePolyScat (Github repository). Github, 2016. URL: https://github.com/phockett/ePSproc, doi:10.6084/m9.figshare.3545639.">13</a>, <a class="reference internal" href="../backmatter/bibliography.html#id545" title="Paul Hockett. ePSproc: Post-processing for ePolyScat documentation. 2020. URL: https://epsproc.readthedocs.io (visited on 2022-02-18).">14</a>]</span>, and further wrapped for fitting cases in the <a class="reference external" href="https://github.com/phockett/PEMtk">Photoelectron Metrology Toolkit</a> <span id="id12">[<a class="reference internal" href="../backmatter/bibliography.html#id618" title="Paul Hockett. Photoelectron Metrology Toolkit (PEMtk) Github repository. 2021. URL: https://github.com/phockett/PEMtk (visited on 2022-02-18).">4</a>]</span>. In the remainder of this section, numerical examples using these codes are illustrated and explored. Full computational details can be found in the <a class="reference external" href="https://epsproc.readthedocs.io">ePSproc documentation</a> <span id="id13">[<a class="reference internal" href="../backmatter/bibliography.html#id545" title="Paul Hockett. ePSproc: Post-processing for ePolyScat documentation. 2020. URL: https://epsproc.readthedocs.io (visited on 2022-02-18).">14</a>]</span>, including <a class="reference external" href="https://epsproc.readthedocs.io/en/latest/methods/geometric_method_dev_260220_090420_tidy.html">extended discussion of each tensor</a> and complete function references in the <a class="reference external" href="https://epsproc.readthedocs.io/en/latest/modules/epsproc.geomFunc.geomCalc.html">geomCalc submodule documentation</a>.</p>
</section>
<section id="numerical-aside-symmetry-defined-channel-functions">
<h2><span class="section-number">3.3.3. </span>Numerical aside: symmetry-defined channel functions<a class="headerlink" href="#numerical-aside-symmetry-defined-channel-functions" title="Permalink to this heading">#</a></h2>
<p>In the following sub-sections, each component is defined in detail, including numerical examples. For illustration purposes, the numerical example uses a minimal set of assumptions, and is defined initially purely by symmetry, although further terms may be required for some of the geometric terms and are discussed where required.</p>
<p>For this example, the <span class="math notranslate nohighlight">\(D_{2h}\)</span> point group is used, representing a fairly general case of a planar asymmetric top system, e.g. ethylene (<span class="math notranslate nohighlight">\(C_2H_4\)</span>). Note that, in this case, the symmetrization coefficients (<span class="math notranslate nohighlight">\(b_{hl\lambda}^{\Gamma\mu}\)</span>, see <a class="reference internal" href="theory_observables_intro_211122.html#equation-eq-symharm-defn">(3.2)</a>) have the property that <span class="math notranslate nohighlight">\(\mu=0\)</span> only, and the <span class="math notranslate nohighlight">\(h\)</span> index is redundant, since it maps uniquely to <span class="math notranslate nohighlight">\(l\)</span> - see <a class="reference internal" href="#tab-d2hxlm"><span class="std std-numref">Fig. 3.2</span></a> - so these indexes can be dropped. Note, also, the unfortunate convention that the label <span class="math notranslate nohighlight">\(\mu\)</span> is used for multiple indexes; to avoid ambiguity this term is remapped to <span class="math notranslate nohighlight">\(\mu_X\)</span> in the numerics below. However, in this case, since <span class="math notranslate nohighlight">\(\mu\)</span> can be dropped from the symmetrization coefficients, there is actually no ambiguity in later usage.</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Full tabulations of the parameters available in HTML or notebook formats only.</p>
</div>
</aside>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run default config - may need to set full path here</span>
<span class="o">%</span><span class="k">run</span> &#39;../scripts/setup_notebook.py&#39;

<span class="c1"># Override plotters backend?</span>
<span class="c1"># plotBackend = &#39;pl&#39;</span>

<span class="c1"># Set Matplotlib inline for lmPlot() with Seaborn display</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>*** Setting up notebook with standard Quantum Metrology Vol. 3 imports...
For more details see https://pemtk.readthedocs.io/en/latest/fitting/PEMtk_fitting_basic_demo_030621-full.html
To use local source code, pass the parent path to this script at run time, e.g. &quot;setup_fit_demo ~/github&quot;

*** Running: 2023-04-28 09:37:10
Working dir: /home/jovyan/jake-home/buildTmp/_latest_build/html/doc-source/part1
Build env: html

* Loading packages...
* sparse not found, sparse matrix forms not available. 
* natsort not found, some sorting functions not available. 
* Setting plotter defaults with epsproc.basicPlotters.setPlotters(). Run directly to modify, or change options in local env.
* Set Holoviews with bokeh.
* pyevtk not found, VTK export not available. 
* Set Holoviews with bokeh.
Jupyter Book      : 0.15.1
External ToC      : 0.3.1
MyST-Parser       : 0.18.1
MyST-NB           : 0.17.2
Sphinx Book Theme : 1.0.1
Jupyter-Cache     : 0.6.1
NbClient          : 0.5.4
</pre></div>
</div>
<script type="application/javascript">(function(root) {
  function now() {
    return new Date();
  }

  var force = true;

  if (typeof root._bokeh_onload_callbacks === "undefined" || force === true) {
    root._bokeh_onload_callbacks = [];
    root._bokeh_is_loading = undefined;
  }

  if (typeof (root._bokeh_timeout) === "undefined" || force === true) {
    root._bokeh_timeout = Date.now() + 5000;
    root._bokeh_failed_load = false;
  }

  function run_callbacks() {
    try {
      root._bokeh_onload_callbacks.forEach(function(callback) {
        if (callback != null)
          callback();
      });
    } finally {
      delete root._bokeh_onload_callbacks
    }
    console.debug("Bokeh: all callbacks have finished");
  }

  function load_libs(css_urls, js_urls, js_modules, callback) {
    if (css_urls == null) css_urls = [];
    if (js_urls == null) js_urls = [];
    if (js_modules == null) js_modules = [];

    root._bokeh_onload_callbacks.push(callback);
    if (root._bokeh_is_loading > 0) {
      console.debug("Bokeh: BokehJS is being loaded, scheduling callback at", now());
      return null;
    }
    if (js_urls.length === 0 && js_modules.length === 0) {
      run_callbacks();
      return null;
    }
    console.debug("Bokeh: BokehJS not loaded, scheduling load and callback at", now());

    function on_load() {
      root._bokeh_is_loading--;
      if (root._bokeh_is_loading === 0) {
        console.debug("Bokeh: all BokehJS libraries/stylesheets loaded");
        run_callbacks()
      }
    }

    function on_error() {
      console.error("failed to load " + url);
    }

    for (var i = 0; i < css_urls.length; i++) {
      var url = css_urls[i];
      const element = document.createElement("link");
      element.onload = on_load;
      element.onerror = on_error;
      element.rel = "stylesheet";
      element.type = "text/css";
      element.href = url;
      console.debug("Bokeh: injecting link tag for BokehJS stylesheet: ", url);
      document.body.appendChild(element);
    }

    var skip = [];
    if (window.requirejs) {
      window.requirejs.config({'packages': {}, 'paths': {'plotly': 'https://cdn.plot.ly/plotly-2.18.0.min', 'gridstack': 'https://cdn.jsdelivr.net/npm/gridstack@4.2.5/dist/gridstack-h5', 'notyf': 'https://cdn.jsdelivr.net/npm/notyf@3/notyf.min'}, 'shim': {'gridstack': {'exports': 'GridStack'}}});
      require(["plotly"], function(Plotly) {
	window.Plotly = Plotly
	on_load()
      })
      require(["gridstack"], function(GridStack) {
	window.GridStack = GridStack
	on_load()
      })
      require(["notyf"], function() {
	on_load()
      })
      root._bokeh_is_loading = css_urls.length + 3;
    } else {
      root._bokeh_is_loading = css_urls.length + js_urls.length + js_modules.length;
    }    if (((window['Plotly'] !== undefined) && (!(window['Plotly'] instanceof HTMLElement))) || window.requirejs) {
      var urls = ['https://cdn.holoviz.org/panel/0.14.4/dist/bundled/plotlyplot/plotly-2.18.0.min.js'];
      for (var i = 0; i < urls.length; i++) {
        skip.push(urls[i])
      }
    }    if (((window['GridStack'] !== undefined) && (!(window['GridStack'] instanceof HTMLElement))) || window.requirejs) {
      var urls = ['https://cdn.holoviz.org/panel/0.14.4/dist/bundled/gridstack/gridstack@4.2.5/dist/gridstack-h5.js'];
      for (var i = 0; i < urls.length; i++) {
        skip.push(urls[i])
      }
    }    if (((window['Notyf'] !== undefined) && (!(window['Notyf'] instanceof HTMLElement))) || window.requirejs) {
      var urls = ['https://cdn.holoviz.org/panel/0.14.4/dist/bundled/notificationarea/notyf@3/notyf.min.js'];
      for (var i = 0; i < urls.length; i++) {
        skip.push(urls[i])
      }
    }    for (var i = 0; i < js_urls.length; i++) {
      var url = js_urls[i];
      if (skip.indexOf(url) >= 0) {
	if (!window.requirejs) {
	  on_load();
	}
	continue;
      }
      var element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error;
      element.async = false;
      element.src = url;
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
    for (var i = 0; i < js_modules.length; i++) {
      var url = js_modules[i];
      if (skip.indexOf(url) >= 0) {
	if (!window.requirejs) {
	  on_load();
	}
	continue;
      }
      var element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error;
      element.async = false;
      element.src = url;
      element.type = "module";
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
    if (!js_urls.length && !js_modules.length) {
      on_load()
    }
  };

  function inject_raw_css(css) {
    const element = document.createElement("style");
    element.appendChild(document.createTextNode(css));
    document.body.appendChild(element);
  }

  var js_urls = ["https://cdn.holoviz.org/panel/0.14.4/dist/bundled/jquery/jquery.slim.min.js", "https://cdn.holoviz.org/panel/0.14.4/dist/bundled/plotlyplot/plotly-2.18.0.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-2.4.1.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-gl-2.4.1.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.4.1.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.4.1.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-mathjax-2.4.1.min.js", "https://unpkg.com/@holoviz/panel@0.14.4/dist/panel.min.js"];
  var js_modules = [];
  var css_urls = ["https://cdn.holoviz.org/panel/0.14.4/dist/css/alerts.css", "https://cdn.holoviz.org/panel/0.14.4/dist/css/card.css", "https://cdn.holoviz.org/panel/0.14.4/dist/css/dataframe.css", "https://cdn.holoviz.org/panel/0.14.4/dist/css/debugger.css", "https://cdn.holoviz.org/panel/0.14.4/dist/css/json.css", "https://cdn.holoviz.org/panel/0.14.4/dist/css/loading.css", "https://cdn.holoviz.org/panel/0.14.4/dist/css/markdown.css", "https://cdn.holoviz.org/panel/0.14.4/dist/css/widgets.css"];
  var inline_js = [    function(Bokeh) {
      inject_raw_css("\n    .bk.pn-loading.arc:before {\n      background-image: url(\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHN0eWxlPSJtYXJnaW46IGF1dG87IGJhY2tncm91bmQ6IG5vbmU7IGRpc3BsYXk6IGJsb2NrOyBzaGFwZS1yZW5kZXJpbmc6IGF1dG87IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQiPiAgPGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjYzNjM2MzIiBzdHJva2Utd2lkdGg9IjEwIiByPSIzNSIgc3Ryb2tlLWRhc2hhcnJheT0iMTY0LjkzMzYxNDMxMzQ2NDE1IDU2Ljk3Nzg3MTQzNzgyMTM4Ij4gICAgPGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJyb3RhdGUiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiBkdXI9IjFzIiB2YWx1ZXM9IjAgNTAgNTA7MzYwIDUwIDUwIiBrZXlUaW1lcz0iMDsxIj48L2FuaW1hdGVUcmFuc2Zvcm0+ICA8L2NpcmNsZT48L3N2Zz4=\");\n      background-size: auto calc(min(50%, 400px));\n    }\n    ");
    },    function(Bokeh) {
      Bokeh.set_log_level("info");
    },
function(Bokeh) {} // ensure no trailing comma for IE
  ];

  function run_inline_js() {
    if ((root.Bokeh !== undefined) || (force === true)) {
      for (var i = 0; i < inline_js.length; i++) {
        inline_js[i].call(root, root.Bokeh);
      }} else if (Date.now() < root._bokeh_timeout) {
      setTimeout(run_inline_js, 100);
    } else if (!root._bokeh_failed_load) {
      console.log("Bokeh: BokehJS failed to load within specified timeout.");
      root._bokeh_failed_load = true;
    }
  }

  if (root._bokeh_is_loading === 0) {
    console.debug("Bokeh: BokehJS loaded, going straight to plotting");
    run_inline_js();
  } else {
    load_libs(css_urls, js_urls, js_modules, function() {
      console.debug("Bokeh: BokehJS plotting callback run at", now());
      run_inline_js();
    });
  }
}(window));</script><script type="application/javascript">
if ((window.PyViz === undefined) || (window.PyViz instanceof HTMLElement)) {
  window.PyViz = {comms: {}, comm_status:{}, kernels:{}, receivers: {}, plot_index: []}
}


    function JupyterCommManager() {
    }

    JupyterCommManager.prototype.register_target = function(plot_id, comm_id, msg_handler) {
      if (window.comm_manager || ((window.Jupyter !== undefined) && (Jupyter.notebook.kernel != null))) {
        var comm_manager = window.comm_manager || Jupyter.notebook.kernel.comm_manager;
        comm_manager.register_target(comm_id, function(comm) {
          comm.on_msg(msg_handler);
        });
      } else if ((plot_id in window.PyViz.kernels) && (window.PyViz.kernels[plot_id])) {
        window.PyViz.kernels[plot_id].registerCommTarget(comm_id, function(comm) {
          comm.onMsg = msg_handler;
        });
      } else if (typeof google != 'undefined' && google.colab.kernel != null) {
        google.colab.kernel.comms.registerTarget(comm_id, (comm) => {
          var messages = comm.messages[Symbol.asyncIterator]();
          function processIteratorResult(result) {
            var message = result.value;
            console.log(message)
            var content = {data: message.data, comm_id};
            var buffers = []
            for (var buffer of message.buffers || []) {
              buffers.push(new DataView(buffer))
            }
            var metadata = message.metadata || {};
            var msg = {content, buffers, metadata}
            msg_handler(msg);
            return messages.next().then(processIteratorResult);
          }
          return messages.next().then(processIteratorResult);
        })
      }
    }

    JupyterCommManager.prototype.get_client_comm = function(plot_id, comm_id, msg_handler) {
      if (comm_id in window.PyViz.comms) {
        return window.PyViz.comms[comm_id];
      } else if (window.comm_manager || ((window.Jupyter !== undefined) && (Jupyter.notebook.kernel != null))) {
        var comm_manager = window.comm_manager || Jupyter.notebook.kernel.comm_manager;
        var comm = comm_manager.new_comm(comm_id, {}, {}, {}, comm_id);
        if (msg_handler) {
          comm.on_msg(msg_handler);
        }
      } else if ((plot_id in window.PyViz.kernels) && (window.PyViz.kernels[plot_id])) {
        var comm = window.PyViz.kernels[plot_id].connectToComm(comm_id);
        comm.open();
        if (msg_handler) {
          comm.onMsg = msg_handler;
        }
      } else if (typeof google != 'undefined' && google.colab.kernel != null) {
        var comm_promise = google.colab.kernel.comms.open(comm_id)
        comm_promise.then((comm) => {
          window.PyViz.comms[comm_id] = comm;
          if (msg_handler) {
            var messages = comm.messages[Symbol.asyncIterator]();
            function processIteratorResult(result) {
              var message = result.value;
              var content = {data: message.data};
              var metadata = message.metadata || {comm_id};
              var msg = {content, metadata}
              msg_handler(msg);
              return messages.next().then(processIteratorResult);
            }
            return messages.next().then(processIteratorResult);
          }
        }) 
        var sendClosure = (data, metadata, buffers, disposeOnDone) => {
          return comm_promise.then((comm) => {
            comm.send(data, metadata, buffers, disposeOnDone);
          });
        };
        var comm = {
          send: sendClosure
        };
      }
      window.PyViz.comms[comm_id] = comm;
      return comm;
    }
    window.PyViz.comm_manager = new JupyterCommManager();
    


var JS_MIME_TYPE = 'application/javascript';
var HTML_MIME_TYPE = 'text/html';
var EXEC_MIME_TYPE = 'application/vnd.holoviews_exec.v0+json';
var CLASS_NAME = 'output';

/**
 * Render data to the DOM node
 */
function render(props, node) {
  var div = document.createElement("div");
  var script = document.createElement("script");
  node.appendChild(div);
  node.appendChild(script);
}

/**
 * Handle when a new output is added
 */
function handle_add_output(event, handle) {
  var output_area = handle.output_area;
  var output = handle.output;
  if ((output.data == undefined) || (!output.data.hasOwnProperty(EXEC_MIME_TYPE))) {
    return
  }
  var id = output.metadata[EXEC_MIME_TYPE]["id"];
  var toinsert = output_area.element.find("." + CLASS_NAME.split(' ')[0]);
  if (id !== undefined) {
    var nchildren = toinsert.length;
    var html_node = toinsert[nchildren-1].children[0];
    html_node.innerHTML = output.data[HTML_MIME_TYPE];
    var scripts = [];
    var nodelist = html_node.querySelectorAll("script");
    for (var i in nodelist) {
      if (nodelist.hasOwnProperty(i)) {
        scripts.push(nodelist[i])
      }
    }

    scripts.forEach( function (oldScript) {
      var newScript = document.createElement("script");
      var attrs = [];
      var nodemap = oldScript.attributes;
      for (var j in nodemap) {
        if (nodemap.hasOwnProperty(j)) {
          attrs.push(nodemap[j])
        }
      }
      attrs.forEach(function(attr) { newScript.setAttribute(attr.name, attr.value) });
      newScript.appendChild(document.createTextNode(oldScript.innerHTML));
      oldScript.parentNode.replaceChild(newScript, oldScript);
    });
    if (JS_MIME_TYPE in output.data) {
      toinsert[nchildren-1].children[1].textContent = output.data[JS_MIME_TYPE];
    }
    output_area._hv_plot_id = id;
    if ((window.Bokeh !== undefined) && (id in Bokeh.index)) {
      window.PyViz.plot_index[id] = Bokeh.index[id];
    } else {
      window.PyViz.plot_index[id] = null;
    }
  } else if (output.metadata[EXEC_MIME_TYPE]["server_id"] !== undefined) {
    var bk_div = document.createElement("div");
    bk_div.innerHTML = output.data[HTML_MIME_TYPE];
    var script_attrs = bk_div.children[0].attributes;
    for (var i = 0; i < script_attrs.length; i++) {
      toinsert[toinsert.length - 1].childNodes[1].setAttribute(script_attrs[i].name, script_attrs[i].value);
    }
    // store reference to server id on output_area
    output_area._bokeh_server_id = output.metadata[EXEC_MIME_TYPE]["server_id"];
  }
}

/**
 * Handle when an output is cleared or removed
 */
function handle_clear_output(event, handle) {
  var id = handle.cell.output_area._hv_plot_id;
  var server_id = handle.cell.output_area._bokeh_server_id;
  if (((id === undefined) || !(id in PyViz.plot_index)) && (server_id !== undefined)) { return; }
  var comm = window.PyViz.comm_manager.get_client_comm("hv-extension-comm", "hv-extension-comm", function () {});
  if (server_id !== null) {
    comm.send({event_type: 'server_delete', 'id': server_id});
    return;
  } else if (comm !== null) {
    comm.send({event_type: 'delete', 'id': id});
  }
  delete PyViz.plot_index[id];
  if ((window.Bokeh !== undefined) & (id in window.Bokeh.index)) {
    var doc = window.Bokeh.index[id].model.document
    doc.clear();
    const i = window.Bokeh.documents.indexOf(doc);
    if (i > -1) {
      window.Bokeh.documents.splice(i, 1);
    }
  }
}

/**
 * Handle kernel restart event
 */
function handle_kernel_cleanup(event, handle) {
  delete PyViz.comms["hv-extension-comm"];
  window.PyViz.plot_index = {}
}

/**
 * Handle update_display_data messages
 */
function handle_update_output(event, handle) {
  handle_clear_output(event, {cell: {output_area: handle.output_area}})
  handle_add_output(event, handle)
}

function register_renderer(events, OutputArea) {
  function append_mime(data, metadata, element) {
    // create a DOM node to render to
    var toinsert = this.create_output_subarea(
    metadata,
    CLASS_NAME,
    EXEC_MIME_TYPE
    );
    this.keyboard_manager.register_events(toinsert);
    // Render to node
    var props = {data: data, metadata: metadata[EXEC_MIME_TYPE]};
    render(props, toinsert[0]);
    element.append(toinsert);
    return toinsert
  }

  events.on('output_added.OutputArea', handle_add_output);
  events.on('output_updated.OutputArea', handle_update_output);
  events.on('clear_output.CodeCell', handle_clear_output);
  events.on('delete.Cell', handle_clear_output);
  events.on('kernel_ready.Kernel', handle_kernel_cleanup);

  OutputArea.prototype.register_mime_type(EXEC_MIME_TYPE, append_mime, {
    safe: true,
    index: 0
  });
}

if (window.Jupyter !== undefined) {
  try {
    var events = require('base/js/events');
    var OutputArea = require('notebook/js/outputarea').OutputArea;
    if (OutputArea.prototype.mime_types().indexOf(EXEC_MIME_TYPE) == -1) {
      register_renderer(events, OutputArea);
    }
  } catch(err) {
  }
}
</script><div class="output text_html"><style>.bk-root, .bk-root .bk:before, .bk-root .bk:after {
  font-family: var(--jp-ui-font-size1);
  font-size: var(--jp-ui-font-size1);
  color: var(--jp-ui-font-color1);
}
</style></div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OMP: Info #271: omp_set_nested routine deprecated, please use omp_set_max_active_levels instead.
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup symmetry-defined matrix elements using PEMtk</span>

<span class="c1"># Import class</span>
<span class="kn">from</span> <span class="nn">pemtk.sym.symHarm</span> <span class="kn">import</span> <span class="n">symHarm</span>

<span class="c1"># Compute hamronics for Td, lmax=4</span>
<span class="n">sym</span> <span class="o">=</span> <span class="s1">&#39;D2h&#39;</span>
<span class="n">lmax</span><span class="o">=</span><span class="mi">4</span>

<span class="n">lmaxPlot</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Set lmaxPlot for subselection on plots later.</span>

<span class="c1"># Glue items for later</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;symHarmPGmatE&quot;</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;symHarmLmaxmatE&quot;</span><span class="p">,</span> <span class="n">lmax</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;symHarmBasislmaxPlot&quot;</span><span class="p">,</span> <span class="n">lmaxPlot</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># TODO: consider different labelling here, can set at init e.g. dims = [&#39;C&#39;, &#39;h&#39;, &#39;muX&#39;, &#39;l&#39;, &#39;m&#39;] - 25/11/22 code currently fails for mu mapping, remap below instead</span>
<span class="n">symObj</span> <span class="o">=</span> <span class="n">symHarm</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span><span class="n">lmax</span><span class="p">)</span>
<span class="c1"># symObj = symHarm(sym,lmax,dims = [&#39;Cont&#39;, &#39;h&#39;, &#39;muX&#39;, &#39;l&#39;, &#39;m&#39;])</span>

<span class="c1"># To plot using ePSproc/PEMtk class, these values can be converted to ePSproc BLM data type...</span>

<span class="c1"># Run conversion - the default is to set the coeffs to the &#39;BLM&#39; data type</span>
<span class="n">dimMap</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span><span class="s1">&#39;Cont&#39;</span><span class="p">,</span><span class="s1">&#39;mu&#39;</span><span class="p">:</span><span class="s1">&#39;muX&#39;</span><span class="p">}</span>
<span class="n">symObj</span><span class="o">.</span><span class="n">toePSproc</span><span class="p">(</span><span class="n">dimMap</span><span class="o">=</span><span class="n">dimMap</span><span class="p">)</span>

<span class="c1"># Run conversion with a different dimMap &amp; dataType</span>
<span class="n">dataType</span> <span class="o">=</span> <span class="s1">&#39;matE&#39;</span>
<span class="c1"># symObj.toePSproc(dimMap = {&#39;C&#39;:&#39;Cont&#39;,&#39;h&#39;:&#39;it&#39;, &#39;mu&#39;:&#39;muX&#39;}, dataType=dataType)</span>
<span class="n">symObj</span><span class="o">.</span><span class="n">toePSproc</span><span class="p">(</span><span class="n">dimMap</span> <span class="o">=</span> <span class="n">dimMap</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="n">dataType</span><span class="p">)</span>
<span class="c1"># symObj.toePSproc(dimMap = {&#39;C&#39;:&#39;Cont&#39;,&#39;h&#39;:&#39;it&#39;}, dataType=dataType)   # Drop mu &gt; muX mapping for now</span>
<span class="c1"># symObj.coeffs[dataType]</span>

<span class="c1"># Example using data class (setup in init script)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pemtkFit</span><span class="p">()</span>

<span class="c1"># Set to new key in data class</span>
<span class="n">dataKey</span> <span class="o">=</span> <span class="n">sym</span>
<span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">dataKey</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">dataType</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;matE&#39;</span><span class="p">,</span><span class="s1">&#39;BLM&#39;</span><span class="p">]:</span>
    <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">dataKey</span><span class="p">][</span><span class="n">dataType</span><span class="p">]</span> <span class="o">=</span> <span class="n">symObj</span><span class="o">.</span><span class="n">coeffs</span><span class="p">[</span><span class="n">dataType</span><span class="p">][</span><span class="s1">&#39;b (comp)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="s1">&#39;muX&#39;</span><span class="p">])</span>  <span class="c1"># Select expansion in complex harmonics, and sum redundant dims</span>
    <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">dataKey</span><span class="p">][</span><span class="n">dataType</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">symObj</span><span class="o">.</span><span class="n">coeffs</span><span class="p">[</span><span class="n">dataType</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>*** Mapping coeffs to ePSproc dataType = matE
Remapped dims: {&#39;C&#39;: &#39;Cont&#39;, &#39;mu&#39;: &#39;it&#39;}
Added dim Eke
Added dim Targ
Added dim Total
Added dim mu
Added dim Type
Found dipole symmetries: 
{&#39;B1u&#39;: {&#39;m&#39;: [0], &#39;pol&#39;: [&#39;z&#39;]}, &#39;B2u&#39;: {&#39;m&#39;: [-1, 1], &#39;pol&#39;: [&#39;y&#39;]}, &#39;B3u&#39;: {&#39;m&#39;: [-1, 1], &#39;pol&#39;: [&#39;x&#39;]}}
*** Mapping coeffs to ePSproc dataType = BLM
Remapped dims: {&#39;C&#39;: &#39;Cont&#39;, &#39;mu&#39;: &#39;muX&#39;}
Added dim Eke
Added dim P
Added dim T
Added dim C
*** Mapping coeffs to ePSproc dataType = matE
Remapped dims: {&#39;C&#39;: &#39;Cont&#39;, &#39;mu&#39;: &#39;muX&#39;}
Added dim Eke
Added dim Targ
Added dim Total
Added dim mu
Added dim it
Added dim Type
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display results (real harmonics)</span>
<span class="n">symObj</span><span class="o">.</span><span class="n">displayXlm</span><span class="p">(</span><span class="n">setCols</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">)</span>  <span class="c1">#, dropLevels=&#39;mu&#39;)</span>

<span class="c1"># Glue version for JupyterBook output</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;D2hXlm&quot;</span><span class="p">,</span><span class="n">symObj</span><span class="o">.</span><span class="n">displayXlm</span><span class="p">(</span><span class="n">setCols</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">returnPD</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># As above, but with PD object return and glue.</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th colspan="6" halign="left">b</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th>h</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
    </tr>
    <tr>
      <th>Character ($\Gamma$)</th>
      <th>PFIX ($\mu$)</th>
      <th>l</th>
      <th>m</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="6" valign="top">A1g</th>
      <th rowspan="6" valign="top">0</th>
      <th>0</th>
      <th>0</th>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2</th>
      <th>0</th>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td></td>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">4</th>
      <th>0</th>
      <td></td>
      <td></td>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td>1.0</td>
      <td></td>
    </tr>
    <tr>
      <th>4</th>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>A1u</th>
      <th>0</th>
      <th>3</th>
      <th>-2</th>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">B1g</th>
      <th rowspan="3" valign="top">0</th>
      <th>2</th>
      <th>-2</th>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">4</th>
      <th>-4</th>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>-2</th>
      <td></td>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">B1u</th>
      <th rowspan="3" valign="top">0</th>
      <th>1</th>
      <th>0</th>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">3</th>
      <th>0</th>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td></td>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">B2g</th>
      <th rowspan="3" valign="top">0</th>
      <th>2</th>
      <th>1</th>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">4</th>
      <th>1</th>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>3</th>
      <td></td>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">B2u</th>
      <th rowspan="3" valign="top">0</th>
      <th>1</th>
      <th>-1</th>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">3</th>
      <th>-3</th>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>-1</th>
      <td></td>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">B3g</th>
      <th rowspan="3" valign="top">0</th>
      <th>2</th>
      <th>-1</th>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">4</th>
      <th>-3</th>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>-1</th>
      <td></td>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">B3u</th>
      <th rowspan="3" valign="top">0</th>
      <th>1</th>
      <th>1</th>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">3</th>
      <th>1</th>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>3</th>
      <td></td>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table>
</div></div></div>
</details>
</div>
<figure class="align-default" id="tab-d2hxlm">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th colspan="6" halign="left">b</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th>h</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
    </tr>
    <tr>
      <th>Character ($\Gamma$)</th>
      <th>PFIX ($\mu$)</th>
      <th>l</th>
      <th>m</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="6" valign="top">A1g</th>
      <th rowspan="6" valign="top">0</th>
      <th>0</th>
      <th>0</th>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2</th>
      <th>0</th>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td></td>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">4</th>
      <th>0</th>
      <td></td>
      <td></td>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td>1.0</td>
      <td></td>
    </tr>
    <tr>
      <th>4</th>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>A1u</th>
      <th>0</th>
      <th>3</th>
      <th>-2</th>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">B1g</th>
      <th rowspan="3" valign="top">0</th>
      <th>2</th>
      <th>-2</th>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">4</th>
      <th>-4</th>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>-2</th>
      <td></td>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">B1u</th>
      <th rowspan="3" valign="top">0</th>
      <th>1</th>
      <th>0</th>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">3</th>
      <th>0</th>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td></td>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">B2g</th>
      <th rowspan="3" valign="top">0</th>
      <th>2</th>
      <th>1</th>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">4</th>
      <th>1</th>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>3</th>
      <td></td>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">B2u</th>
      <th rowspan="3" valign="top">0</th>
      <th>1</th>
      <th>-1</th>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">3</th>
      <th>-3</th>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>-1</th>
      <td></td>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">B3g</th>
      <th rowspan="3" valign="top">0</th>
      <th>2</th>
      <th>-1</th>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">4</th>
      <th>-3</th>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>-1</th>
      <td></td>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">B3u</th>
      <th rowspan="3" valign="top">0</th>
      <th>1</th>
      <th>1</th>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">3</th>
      <th>1</th>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>3</th>
      <td></td>
      <td></td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table>
</div></div><figcaption>
<p><span class="caption-number">Fig. 3.2 </span><span class="caption-text">Symmetrized harmonics coefficients (<span class="math notranslate nohighlight">\(b_{hl\lambda}^{\Gamma\mu}\)</span>, see <a class="reference internal" href="theory_observables_intro_211122.html#equation-eq-symharm-defn">(3.2)</a>) for <span class="pasted-text">D2h</span> symmetry (<span class="math notranslate nohighlight">\(l_{max}=\)</span><span class="pasted-text">4</span>) generated with the <a class="reference external" href="https://github.com/phockett/PEMtk">Photoelectron Metrology Toolkit</a> <span id="id14">[<a class="reference internal" href="../backmatter/bibliography.html#id618" title="Paul Hockett. Photoelectron Metrology Toolkit (PEMtk) Github repository. 2021. URL: https://github.com/phockett/PEMtk (visited on 2022-02-18).">4</a>]</span> wrapper for <a class="reference external" href="https://github.com/mcodev31/libmsym">libmsym</a> <span id="id15">[<a class="reference internal" href="../backmatter/bibliography.html#id639" title="Marcus Johansson and Valera Veryazov. Automatic procedure for generating symmetry adapted wavefunctions. Journal of Cheminformatics, 9(1):8, February 2017. URL: https://doi.org/10.1186/s13321-017-0193-3 (visited on 2022-08-03), doi:10.1186/s13321-017-0193-3.">33</a>, <a class="reference internal" href="../backmatter/bibliography.html#id640" title="Marcus Johansson. Libmsym Github. July 2022. URL: https://github.com/mcodev31/libmsym (visited on 2022-08-03).">34</a>]</span>. Note that, in this case, the coeffcients have the property that <span class="math notranslate nohighlight">\(\mu=0\)</span> only, and the <span class="math notranslate nohighlight">\(h\)</span> index is redundant (maps uniquely to <span class="math notranslate nohighlight">\(l\)</span>).</span><a class="headerlink" href="#tab-d2hxlm" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ep.matEleSelector(data.data[dataKey][&#39;matE&#39;], thres = None, inds = {}, dims = &#39;Eke&#39;, sq = True, drop = True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute basis functions for given matrix elements</span>

<span class="c1"># Set data</span>
<span class="n">data</span><span class="o">.</span><span class="n">subKey</span> <span class="o">=</span> <span class="n">dataKey</span>

<span class="c1"># Using PEMtk - this only returns the product basis set as used for fitting</span>
<span class="n">BetaNormX</span><span class="p">,</span> <span class="n">basisProduct</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">afblmMatEfit</span><span class="p">(</span><span class="n">selDims</span><span class="o">=</span><span class="p">{},</span> <span class="n">sqThres</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Using ePSproc directly - this includes full basis return if specified</span>
<span class="n">BetaNormX2</span><span class="p">,</span> <span class="n">basisFull</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">geomFunc</span><span class="o">.</span><span class="n">afblmXprod</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">subKey</span><span class="p">][</span><span class="s1">&#39;matE&#39;</span><span class="p">],</span> <span class="n">basisReturn</span> <span class="o">=</span> <span class="s1">&#39;Full&#39;</span><span class="p">,</span> 
                                               <span class="n">thres</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">selDims</span><span class="o">=</span><span class="p">{},</span> <span class="n">sqThres</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1">#, BLMRenorm = BLMRenorm, **kwargs)</span>

<span class="c1"># The basis dictionary contains various numerical parameters, these are investigated below.</span>
<span class="c1"># See also the ePSproc docs at https://epsproc.readthedocs.io/en/latest/methods/geometric_method_dev_260220_090420_tidy.html</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Product basis elements: </span><span class="si">{</span><span class="n">basisProduct</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Full basis elements: </span><span class="si">{</span><span class="n">basisFull</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Use full basis for following sections</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">basisFull</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Product basis elements: dict_keys([&#39;BLMtableResort&#39;, &#39;polProd&#39;, &#39;phaseConvention&#39;, &#39;BLMRenorm&#39;])
Full basis elements: dict_keys([&#39;QNs&#39;, &#39;EPRX&#39;, &#39;lambdaTerm&#39;, &#39;BLMtable&#39;, &#39;BLMtableResort&#39;, &#39;AFterm&#39;, &#39;AKQS&#39;, &#39;polProd&#39;, &#39;phaseConvention&#39;, &#39;BLMRenorm&#39;])
</pre></div>
</div>
</div>
</div>
</section>
<section id="matrix-element-geometric-coupling-term-b-l-m">
<span id="sec-theory-blm-term"></span><h2><span class="section-number">3.3.4. </span>Matrix element geometric coupling term <span class="math notranslate nohighlight">\(B_{L,M}\)</span><a class="headerlink" href="#matrix-element-geometric-coupling-term-b-l-m" title="Permalink to this heading">#</a></h2>
<p>The coupling of the partial wave pairs, <span class="math notranslate nohighlight">\(|l,m\rangle\)</span> and <span class="math notranslate nohighlight">\(|l',m'\rangle\)</span>, into the observable set of <span class="math notranslate nohighlight">\(\{L,M\}\)</span> is defined by a tensor contraction with two 3j terms.</p>
<div class="math notranslate nohighlight" id="equation-eq-basis-blm-defn">
<span class="eqno">(3.25)<a class="headerlink" href="#equation-eq-basis-blm-defn" title="Permalink to this equation">#</a></span>\[\begin{split}
B_{L,M}=(-1)^{m}\left(\frac{(2l+1)(2l'+1)(2L+1)}{4\pi}\right)^{1/2}\left(\begin{array}{ccc}
l &amp; l' &amp; L\\
0 &amp; 0 &amp; 0
\end{array}\right)\left(\begin{array}{ccc}
l &amp; l' &amp; L\\
-m &amp; m' &amp; M
\end{array}\right)
\end{split}\]</div>
<p>Note that this term is equivalent, effectively, to a triple integral over spherical harmonics (e.g. Eq. 3.119 in Zare <span id="id16">[<a class="reference internal" href="../backmatter/bibliography.html#id882" title="Richard N Zare. Angular Momentum: Understanding Spatial Aspects in Chemistry and Physics. John Wiley &amp; Sons, 1988.">44</a>]</span>):</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\intop_{0}^{2\pi}\intop_{0}^{\pi}Y_{J_{3}M_{3}}(\theta,\phi)Y_{J_{2}M_{2}}(\theta,\phi)Y_{J_{1}M_{1}}(\theta,\phi)\sin\theta d\theta d\phi &amp; = &amp; \left(\frac{(2J_{1}+1)(2J_{2}+1)(2J_{3}+1)}{4\pi}\right)^{1/2}\\
 &amp; \times &amp; \left(\begin{array}{ccc}
J_{1} &amp; J_{2} &amp; J_{3}\\
0 &amp; 0 &amp; 0
\end{array}\right)\left(\begin{array}{ccc}
J_{1} &amp; J_{2} &amp; J_{3}\\
M_{1} &amp; M_{2} &amp; M_{3}
\end{array}\right)
\end{aligned}
\end{split}\]</div>
<p>And a similar term appears in the contraction over a pair of harmonics into a resultant harmonic (e.g. Eqs. C.21, C.22 in Blum <span id="id17">[<a class="reference internal" href="../backmatter/bibliography.html#id479" title="Karl Blum. Density Matrix Theory and Applications. Volume 64. Springer Berlin Heidelberg, Berlin, Heidelberg, 3rd editio edition, 2012. ISBN 978-3-642-20560-6. URL: http://link.springer.com/10.1007/978-3-642-20561-3, doi:10.1007/978-3-642-20561-3.">54</a>]</span>) - this is how the term arises in the derivation of the observables.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
Y_{J_{1}M_{1}}(\theta,\phi)Y_{J_{2}M_{2}}(\theta,\phi) &amp; = &amp; \sum_{J_{3}M_{3}}\left(\frac{(2J_{1}+1)(2J_{2}+1)(2J_{3}+1)}{4\pi}\right)^{1/2}\\
 &amp; \times &amp; \left(\begin{array}{ccc}
J_{1} &amp; J_{2} &amp; J_{3}\\
0 &amp; 0 &amp; 0
\end{array}\right)\left(\begin{array}{ccc}
J_{1} &amp; J_{2} &amp; J_{3}\\
M_{1} &amp; M_{2} &amp; M_{3}
\end{array}\right)Y_{J_{3}M_{3}}^{*}(\theta,\phi)
\end{aligned}
\end{split}\]</div>
<p>Note also some definitions use conjugate spherical harmonics, which can be converted as, e.g., Eq. C.21 in Blum <span id="id18">[<a class="reference internal" href="../backmatter/bibliography.html#id479" title="Karl Blum. Density Matrix Theory and Applications. Volume 64. Springer Berlin Heidelberg, Berlin, Heidelberg, 3rd editio edition, 2012. ISBN 978-3-642-20560-6. URL: http://link.springer.com/10.1007/978-3-642-20561-3, doi:10.1007/978-3-642-20561-3.">54</a>]</span>:</p>
<div class="amsmath math notranslate nohighlight" id="equation-7a3a7474-e649-4210-99b5-b3702baa9c54">
<span class="eqno">(3.26)<a class="headerlink" href="#equation-7a3a7474-e649-4210-99b5-b3702baa9c54" title="Permalink to this equation">#</a></span>\[\begin{equation}
\beta_{L,M}^{\mu_{i},\mu_{f}}Y_{LM}^{*}(\theta_{\hat{k}},\phi_{\hat{k}})=\beta_{L,-M}^{\mu_{i},\mu_{f}}(-1)^{M}Y_{L,-M}(\theta_{\hat{k}},\phi_{\hat{k}})\label{eq:sph-conj-conv}
\end{equation}\]</div>
<p>In the current <a class="reference external" href="https://github.com/phockett/PEMtk">Photoelectron Metrology Toolkit</a> <span id="id19">[<a class="reference internal" href="../backmatter/bibliography.html#id618" title="Paul Hockett. Photoelectron Metrology Toolkit (PEMtk) Github repository. 2021. URL: https://github.com/phockett/PEMtk (visited on 2022-02-18).">4</a>]</span> codebase, the relevant basis item can be inspected as below, in order to illustrate the sensitivity of different <span class="math notranslate nohighlight">\((L,M)\)</span> terms to the matrix element products. Note for the <a class="reference internal" href="../backmatter/glossary.html#term-AF"><span class="xref std std-term">AF</span></a> case the terms may be reindexed by <span class="math notranslate nohighlight">\(M=S-R'\)</span> - this allows for all <a class="reference internal" href="../backmatter/glossary.html#term-MF"><span class="xref std std-term">MF</span></a> projections to contribute, rather than just a single specified polarization geometry. However, in many typical cases, this term is nonetheless restricted to only <span class="math notranslate nohighlight">\(M=0\)</span> components overall by other geometric factors (see below).</p>
<p>The code cells below illustrate this for the current example case, and <a class="reference internal" href="#fig-blm-basis-d2h"><span class="std std-numref">Fig. 3.3</span></a> offers a general summary. In general, this is a convenient way to visualize the selection rules into the observable: for instance, only terms <span class="math notranslate nohighlight">\(l=l'\)</span> and <span class="math notranslate nohighlight">\(m=-m'\)</span> contribute to the overall photoionization cross-section term (<span class="math notranslate nohighlight">\(L=0, M=0\)</span>), and the maximum observable <span class="math notranslate nohighlight">\(L_{max}=2l_{max}\)</span>. However, since these terms are fairly simply followed algebraically in this case, via the rules inherent in the <span class="math notranslate nohighlight">\(3j\)</span> product (Eq. <a class="reference internal" href="#equation-eq-basis-blm-defn">(3.25)</a>), this is not particularly insightful (although useful pedagogically). These visualizations will become more useful when dealing with real sets of matrix elements, and specific polarization geometries, which will further modulate or restrict the <span class="math notranslate nohighlight">\(B_{L,M}\)</span> terms.</p>
<p>Numerically, various standard functions may be used to quickly gain deeper insight, for example min/max, averages etc. Such considerations may provide a quick sanity-check for a given case, and may prove useful when planning experiments to investigate particular aspects or channels of a given system. Other properties of the basis functions may also be interrogated numerically; for instance, correlation maps provide an alternative way to check which terms are strongly correlated or coupled, or will dominate a given aspect of the observable.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tabulate basis (use ep.multiDimXrToPD, or other? Should have wrappers...?)</span>

<span class="n">basisKey</span> <span class="o">=</span> <span class="s1">&#39;BLMtableResort&#39;</span>  <span class="c1"># Key for BLM basis set</span>

<span class="c1"># Reformat basis for display (optional)</span>
<span class="n">stackDims</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;LM&#39;</span><span class="p">:[</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">]}</span>
<span class="n">basisPlot</span> <span class="o">=</span> <span class="n">basis</span><span class="p">[</span><span class="n">basisKey</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;S-Rp&#39;</span><span class="p">:</span><span class="s1">&#39;M&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">stackDims</span><span class="p">)</span>

<span class="c1"># Convert to Pandas</span>
<span class="n">pd</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">multiDimXrToPD</span><span class="p">(</span><span class="n">basisPlot</span><span class="p">,</span> <span class="n">colDims</span><span class="o">=</span><span class="n">stackDims</span><span class="p">)</span>

<span class="c1"># Summarise properties and tabulate via Pandas Describe</span>
<span class="n">pd</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>L</th>
      <th>M</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <th>0</th>
      <td>25.0</td>
      <td>2.821e-01</td>
      <td>1.378e-16</td>
      <td>0.282</td>
      <td>2.821e-01</td>
      <td>2.821e-01</td>
      <td>0.282</td>
      <td>0.282</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">1</th>
      <th>-1</th>
      <td>32.0</td>
      <td>-1.735e-18</td>
      <td>2.266e-01</td>
      <td>-0.326</td>
      <td>-2.064e-01</td>
      <td>0.000e+00</td>
      <td>0.206</td>
      <td>0.326</td>
    </tr>
    <tr>
      <th>0</th>
      <td>32.0</td>
      <td>2.207e-01</td>
      <td>3.265e-02</td>
      <td>0.163</td>
      <td>2.061e-01</td>
      <td>2.261e-01</td>
      <td>0.240</td>
      <td>0.282</td>
    </tr>
    <tr>
      <th>1</th>
      <td>32.0</td>
      <td>-4.120e-18</td>
      <td>2.266e-01</td>
      <td>-0.326</td>
      <td>-2.064e-01</td>
      <td>0.000e+00</td>
      <td>0.206</td>
      <td>0.326</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">2</th>
      <th>-2</th>
      <td>34.0</td>
      <td>1.800e-02</td>
      <td>2.051e-01</td>
      <td>-0.309</td>
      <td>-1.802e-01</td>
      <td>4.030e-02</td>
      <td>0.185</td>
      <td>0.337</td>
    </tr>
    <tr>
      <th>-1</th>
      <td>38.0</td>
      <td>-1.242e-17</td>
      <td>1.944e-01</td>
      <td>-0.282</td>
      <td>-1.959e-01</td>
      <td>0.000e+00</td>
      <td>0.196</td>
      <td>0.282</td>
    </tr>
    <tr>
      <th>0</th>
      <td>42.0</td>
      <td>9.190e-02</td>
      <td>1.596e-01</td>
      <td>-0.229</td>
      <td>2.697e-17</td>
      <td>1.561e-01</td>
      <td>0.216</td>
      <td>0.282</td>
    </tr>
    <tr>
      <th>1</th>
      <td>38.0</td>
      <td>-1.242e-17</td>
      <td>1.944e-01</td>
      <td>-0.282</td>
      <td>-1.959e-01</td>
      <td>0.000e+00</td>
      <td>0.196</td>
      <td>0.282</td>
    </tr>
    <tr>
      <th>2</th>
      <td>34.0</td>
      <td>1.800e-02</td>
      <td>2.051e-01</td>
      <td>-0.309</td>
      <td>-1.802e-01</td>
      <td>4.030e-02</td>
      <td>0.185</td>
      <td>0.337</td>
    </tr>
    <tr>
      <th rowspan="7" valign="top">3</th>
      <th>-3</th>
      <td>26.0</td>
      <td>2.135e-18</td>
      <td>2.106e-01</td>
      <td>-0.326</td>
      <td>-1.829e-01</td>
      <td>0.000e+00</td>
      <td>0.183</td>
      <td>0.326</td>
    </tr>
    <tr>
      <th>-2</th>
      <td>32.0</td>
      <td>2.925e-02</td>
      <td>1.868e-01</td>
      <td>-0.261</td>
      <td>-1.495e-01</td>
      <td>4.798e-02</td>
      <td>0.211</td>
      <td>0.282</td>
    </tr>
    <tr>
      <th>-1</th>
      <td>38.0</td>
      <td>1.461e-18</td>
      <td>1.731e-01</td>
      <td>-0.282</td>
      <td>-1.593e-01</td>
      <td>0.000e+00</td>
      <td>0.159</td>
      <td>0.282</td>
    </tr>
    <tr>
      <th>0</th>
      <td>38.0</td>
      <td>3.405e-02</td>
      <td>1.697e-01</td>
      <td>-0.204</td>
      <td>-1.430e-01</td>
      <td>5.947e-02</td>
      <td>0.188</td>
      <td>0.282</td>
    </tr>
    <tr>
      <th>1</th>
      <td>38.0</td>
      <td>3.652e-18</td>
      <td>1.731e-01</td>
      <td>-0.282</td>
      <td>-1.593e-01</td>
      <td>0.000e+00</td>
      <td>0.159</td>
      <td>0.282</td>
    </tr>
    <tr>
      <th>2</th>
      <td>32.0</td>
      <td>2.925e-02</td>
      <td>1.868e-01</td>
      <td>-0.261</td>
      <td>-1.495e-01</td>
      <td>4.798e-02</td>
      <td>0.211</td>
      <td>0.282</td>
    </tr>
    <tr>
      <th>3</th>
      <td>26.0</td>
      <td>-3.736e-18</td>
      <td>2.106e-01</td>
      <td>-0.326</td>
      <td>-1.829e-01</td>
      <td>0.000e+00</td>
      <td>0.183</td>
      <td>0.326</td>
    </tr>
    <tr>
      <th rowspan="9" valign="top">4</th>
      <th>-4</th>
      <td>19.0</td>
      <td>2.470e-02</td>
      <td>2.233e-01</td>
      <td>-0.326</td>
      <td>-1.986e-01</td>
      <td>1.065e-01</td>
      <td>0.180</td>
      <td>0.337</td>
    </tr>
    <tr>
      <th>-3</th>
      <td>26.0</td>
      <td>1.068e-18</td>
      <td>1.907e-01</td>
      <td>-0.282</td>
      <td>-1.670e-01</td>
      <td>0.000e+00</td>
      <td>0.167</td>
      <td>0.282</td>
    </tr>
    <tr>
      <th>-2</th>
      <td>33.0</td>
      <td>1.301e-02</td>
      <td>1.680e-01</td>
      <td>-0.255</td>
      <td>-1.277e-01</td>
      <td>-4.442e-02</td>
      <td>0.188</td>
      <td>0.282</td>
    </tr>
    <tr>
      <th>-1</th>
      <td>36.0</td>
      <td>2.313e-18</td>
      <td>1.612e-01</td>
      <td>-0.282</td>
      <td>-1.414e-01</td>
      <td>0.000e+00</td>
      <td>0.141</td>
      <td>0.282</td>
    </tr>
    <tr>
      <th>0</th>
      <td>39.0</td>
      <td>5.108e-03</td>
      <td>1.546e-01</td>
      <td>-0.190</td>
      <td>-1.553e-01</td>
      <td>4.030e-02</td>
      <td>0.107</td>
      <td>0.282</td>
    </tr>
    <tr>
      <th>1</th>
      <td>36.0</td>
      <td>2.313e-18</td>
      <td>1.612e-01</td>
      <td>-0.282</td>
      <td>-1.414e-01</td>
      <td>0.000e+00</td>
      <td>0.141</td>
      <td>0.282</td>
    </tr>
    <tr>
      <th>2</th>
      <td>33.0</td>
      <td>1.301e-02</td>
      <td>1.680e-01</td>
      <td>-0.255</td>
      <td>-1.277e-01</td>
      <td>-4.442e-02</td>
      <td>0.188</td>
      <td>0.282</td>
    </tr>
    <tr>
      <th>3</th>
      <td>26.0</td>
      <td>-3.203e-18</td>
      <td>1.907e-01</td>
      <td>-0.282</td>
      <td>-1.670e-01</td>
      <td>0.000e+00</td>
      <td>0.167</td>
      <td>0.282</td>
    </tr>
    <tr>
      <th>4</th>
      <td>19.0</td>
      <td>2.470e-02</td>
      <td>2.233e-01</td>
      <td>-0.326</td>
      <td>-1.986e-01</td>
      <td>1.065e-01</td>
      <td>0.180</td>
      <td>0.337</td>
    </tr>
    <tr>
      <th rowspan="11" valign="top">5</th>
      <th>-5</th>
      <td>10.0</td>
      <td>-5.551e-18</td>
      <td>2.705e-01</td>
      <td>-0.347</td>
      <td>-2.064e-01</td>
      <td>0.000e+00</td>
      <td>0.206</td>
      <td>0.347</td>
    </tr>
    <tr>
      <th>-4</th>
      <td>16.0</td>
      <td>-2.317e-03</td>
      <td>2.095e-01</td>
      <td>-0.295</td>
      <td>-2.107e-01</td>
      <td>5.047e-02</td>
      <td>0.157</td>
      <td>0.269</td>
    </tr>
    <tr>
      <th>-3</th>
      <td>22.0</td>
      <td>2.523e-18</td>
      <td>1.771e-01</td>
      <td>-0.260</td>
      <td>-1.633e-01</td>
      <td>0.000e+00</td>
      <td>0.163</td>
      <td>0.260</td>
    </tr>
    <tr>
      <th>-2</th>
      <td>26.0</td>
      <td>-9.062e-04</td>
      <td>1.623e-01</td>
      <td>-0.246</td>
      <td>-1.095e-01</td>
      <td>-6.340e-02</td>
      <td>0.171</td>
      <td>0.225</td>
    </tr>
    <tr>
      <th>-1</th>
      <td>30.0</td>
      <td>2.313e-18</td>
      <td>1.507e-01</td>
      <td>-0.241</td>
      <td>-1.196e-01</td>
      <td>-3.469e-18</td>
      <td>0.120</td>
      <td>0.241</td>
    </tr>
    <tr>
      <th>0</th>
      <td>30.0</td>
      <td>-2.399e-03</td>
      <td>1.507e-01</td>
      <td>-0.171</td>
      <td>-1.659e-01</td>
      <td>9.577e-03</td>
      <td>0.098</td>
      <td>0.246</td>
    </tr>
    <tr>
      <th>1</th>
      <td>30.0</td>
      <td>-1.850e-18</td>
      <td>1.507e-01</td>
      <td>-0.241</td>
      <td>-1.196e-01</td>
      <td>0.000e+00</td>
      <td>0.120</td>
      <td>0.241</td>
    </tr>
    <tr>
      <th>2</th>
      <td>26.0</td>
      <td>-9.062e-04</td>
      <td>1.623e-01</td>
      <td>-0.246</td>
      <td>-1.095e-01</td>
      <td>-6.340e-02</td>
      <td>0.171</td>
      <td>0.225</td>
    </tr>
    <tr>
      <th>3</th>
      <td>22.0</td>
      <td>-2.523e-18</td>
      <td>1.771e-01</td>
      <td>-0.260</td>
      <td>-1.633e-01</td>
      <td>0.000e+00</td>
      <td>0.163</td>
      <td>0.260</td>
    </tr>
    <tr>
      <th>4</th>
      <td>16.0</td>
      <td>-2.317e-03</td>
      <td>2.095e-01</td>
      <td>-0.295</td>
      <td>-2.107e-01</td>
      <td>5.047e-02</td>
      <td>0.157</td>
      <td>0.269</td>
    </tr>
    <tr>
      <th>5</th>
      <td>10.0</td>
      <td>-5.551e-18</td>
      <td>2.705e-01</td>
      <td>-0.347</td>
      <td>-2.064e-01</td>
      <td>0.000e+00</td>
      <td>0.206</td>
      <td>0.347</td>
    </tr>
    <tr>
      <th rowspan="13" valign="top">6</th>
      <th>-6</th>
      <td>6.0</td>
      <td>-3.262e-02</td>
      <td>3.079e-01</td>
      <td>-0.360</td>
      <td>-2.030e-01</td>
      <td>-1.634e-01</td>
      <td>0.225</td>
      <td>0.354</td>
    </tr>
    <tr>
      <th>-5</th>
      <td>10.0</td>
      <td>5.551e-18</td>
      <td>2.310e-01</td>
      <td>-0.289</td>
      <td>-2.033e-01</td>
      <td>0.000e+00</td>
      <td>0.203</td>
      <td>0.289</td>
    </tr>
    <tr>
      <th>-4</th>
      <td>14.0</td>
      <td>-4.112e-03</td>
      <td>1.922e-01</td>
      <td>-0.246</td>
      <td>-1.861e-01</td>
      <td>3.018e-02</td>
      <td>0.146</td>
      <td>0.266</td>
    </tr>
    <tr>
      <th>-3</th>
      <td>18.0</td>
      <td>3.084e-18</td>
      <td>1.681e-01</td>
      <td>-0.252</td>
      <td>-1.477e-01</td>
      <td>0.000e+00</td>
      <td>0.148</td>
      <td>0.252</td>
    </tr>
    <tr>
      <th>-2</th>
      <td>22.0</td>
      <td>2.312e-04</td>
      <td>1.513e-01</td>
      <td>-0.243</td>
      <td>-1.051e-01</td>
      <td>-1.465e-17</td>
      <td>0.157</td>
      <td>0.206</td>
    </tr>
    <tr>
      <th>-1</th>
      <td>24.0</td>
      <td>-5.204e-18</td>
      <td>1.445e-01</td>
      <td>-0.230</td>
      <td>-1.077e-01</td>
      <td>0.000e+00</td>
      <td>0.108</td>
      <td>0.230</td>
    </tr>
    <tr>
      <th>0</th>
      <td>26.0</td>
      <td>1.024e-03</td>
      <td>1.386e-01</td>
      <td>-0.178</td>
      <td>-1.565e-01</td>
      <td>-7.113e-03</td>
      <td>0.071</td>
      <td>0.239</td>
    </tr>
    <tr>
      <th>1</th>
      <td>24.0</td>
      <td>6.361e-18</td>
      <td>1.445e-01</td>
      <td>-0.230</td>
      <td>-1.077e-01</td>
      <td>6.939e-18</td>
      <td>0.108</td>
      <td>0.230</td>
    </tr>
    <tr>
      <th>2</th>
      <td>22.0</td>
      <td>2.312e-04</td>
      <td>1.513e-01</td>
      <td>-0.243</td>
      <td>-1.051e-01</td>
      <td>-1.465e-17</td>
      <td>0.157</td>
      <td>0.206</td>
    </tr>
    <tr>
      <th>3</th>
      <td>18.0</td>
      <td>-1.542e-18</td>
      <td>1.681e-01</td>
      <td>-0.252</td>
      <td>-1.477e-01</td>
      <td>6.939e-18</td>
      <td>0.148</td>
      <td>0.252</td>
    </tr>
    <tr>
      <th>4</th>
      <td>14.0</td>
      <td>-4.112e-03</td>
      <td>1.922e-01</td>
      <td>-0.246</td>
      <td>-1.861e-01</td>
      <td>3.018e-02</td>
      <td>0.146</td>
      <td>0.266</td>
    </tr>
    <tr>
      <th>5</th>
      <td>10.0</td>
      <td>-5.551e-18</td>
      <td>2.310e-01</td>
      <td>-0.289</td>
      <td>-2.033e-01</td>
      <td>0.000e+00</td>
      <td>0.203</td>
      <td>0.289</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6.0</td>
      <td>-3.262e-02</td>
      <td>3.079e-01</td>
      <td>-0.360</td>
      <td>-2.030e-01</td>
      <td>-1.634e-01</td>
      <td>0.225</td>
      <td>0.354</td>
    </tr>
    <tr>
      <th rowspan="15" valign="top">7</th>
      <th>-7</th>
      <td>2.0</td>
      <td>0.000e+00</td>
      <td>5.222e-01</td>
      <td>-0.369</td>
      <td>-1.846e-01</td>
      <td>0.000e+00</td>
      <td>0.185</td>
      <td>0.369</td>
    </tr>
    <tr>
      <th>-6</th>
      <td>4.0</td>
      <td>-1.870e-02</td>
      <td>3.007e-01</td>
      <td>-0.279</td>
      <td>-2.791e-01</td>
      <td>-1.870e-02</td>
      <td>0.242</td>
      <td>0.242</td>
    </tr>
    <tr>
      <th>-5</th>
      <td>6.0</td>
      <td>0.000e+00</td>
      <td>2.335e-01</td>
      <td>-0.268</td>
      <td>-1.911e-01</td>
      <td>0.000e+00</td>
      <td>0.191</td>
      <td>0.268</td>
    </tr>
    <tr>
      <th>-4</th>
      <td>8.0</td>
      <td>-4.858e-03</td>
      <td>1.973e-01</td>
      <td>-0.212</td>
      <td>-1.616e-01</td>
      <td>-2.914e-02</td>
      <td>0.128</td>
      <td>0.251</td>
    </tr>
    <tr>
      <th>-3</th>
      <td>10.0</td>
      <td>-1.388e-18</td>
      <td>1.741e-01</td>
      <td>-0.239</td>
      <td>-1.351e-01</td>
      <td>0.000e+00</td>
      <td>0.135</td>
      <td>0.239</td>
    </tr>
    <tr>
      <th>-2</th>
      <td>12.0</td>
      <td>-1.118e-03</td>
      <td>1.574e-01</td>
      <td>-0.239</td>
      <td>-9.040e-02</td>
      <td>-2.077e-02</td>
      <td>0.169</td>
      <td>0.195</td>
    </tr>
    <tr>
      <th>-1</th>
      <td>14.0</td>
      <td>-1.301e-18</td>
      <td>1.448e-01</td>
      <td>-0.225</td>
      <td>-1.043e-01</td>
      <td>1.735e-18</td>
      <td>0.104</td>
      <td>0.225</td>
    </tr>
    <tr>
      <th>0</th>
      <td>14.0</td>
      <td>-2.547e-04</td>
      <td>1.448e-01</td>
      <td>-0.183</td>
      <td>-1.415e-01</td>
      <td>-1.783e-02</td>
      <td>0.082</td>
      <td>0.236</td>
    </tr>
    <tr>
      <th>1</th>
      <td>14.0</td>
      <td>1.983e-18</td>
      <td>1.448e-01</td>
      <td>-0.225</td>
      <td>-1.043e-01</td>
      <td>-8.674e-19</td>
      <td>0.104</td>
      <td>0.225</td>
    </tr>
    <tr>
      <th>2</th>
      <td>12.0</td>
      <td>-1.118e-03</td>
      <td>1.574e-01</td>
      <td>-0.239</td>
      <td>-9.040e-02</td>
      <td>-2.077e-02</td>
      <td>0.169</td>
      <td>0.195</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10.0</td>
      <td>0.000e+00</td>
      <td>1.741e-01</td>
      <td>-0.239</td>
      <td>-1.351e-01</td>
      <td>0.000e+00</td>
      <td>0.135</td>
      <td>0.239</td>
    </tr>
    <tr>
      <th>4</th>
      <td>8.0</td>
      <td>-4.858e-03</td>
      <td>1.973e-01</td>
      <td>-0.212</td>
      <td>-1.616e-01</td>
      <td>-2.914e-02</td>
      <td>0.128</td>
      <td>0.251</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6.0</td>
      <td>0.000e+00</td>
      <td>2.335e-01</td>
      <td>-0.268</td>
      <td>-1.911e-01</td>
      <td>0.000e+00</td>
      <td>0.191</td>
      <td>0.268</td>
    </tr>
    <tr>
      <th>6</th>
      <td>4.0</td>
      <td>-1.870e-02</td>
      <td>3.007e-01</td>
      <td>-0.279</td>
      <td>-2.791e-01</td>
      <td>-1.870e-02</td>
      <td>0.242</td>
      <td>0.242</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2.0</td>
      <td>0.000e+00</td>
      <td>5.222e-01</td>
      <td>-0.369</td>
      <td>-1.846e-01</td>
      <td>0.000e+00</td>
      <td>0.185</td>
      <td>0.369</td>
    </tr>
    <tr>
      <th rowspan="17" valign="top">8</th>
      <th>-8</th>
      <td>1.0</td>
      <td>3.799e-01</td>
      <td>NaN</td>
      <td>0.380</td>
      <td>3.799e-01</td>
      <td>3.799e-01</td>
      <td>0.380</td>
      <td>0.380</td>
    </tr>
    <tr>
      <th>-7</th>
      <td>2.0</td>
      <td>2.776e-17</td>
      <td>3.799e-01</td>
      <td>-0.269</td>
      <td>-1.343e-01</td>
      <td>5.551e-17</td>
      <td>0.134</td>
      <td>0.269</td>
    </tr>
    <tr>
      <th>-6</th>
      <td>3.0</td>
      <td>2.986e-02</td>
      <td>2.662e-01</td>
      <td>-0.277</td>
      <td>-4.697e-02</td>
      <td>1.835e-01</td>
      <td>0.184</td>
      <td>0.184</td>
    </tr>
    <tr>
      <th>-5</th>
      <td>4.0</td>
      <td>0.000e+00</td>
      <td>2.194e-01</td>
      <td>-0.240</td>
      <td>-1.502e-01</td>
      <td>0.000e+00</td>
      <td>0.150</td>
      <td>0.240</td>
    </tr>
    <tr>
      <th>-4</th>
      <td>5.0</td>
      <td>4.277e-03</td>
      <td>1.899e-01</td>
      <td>-0.189</td>
      <td>-1.885e-01</td>
      <td>7.451e-02</td>
      <td>0.075</td>
      <td>0.249</td>
    </tr>
    <tr>
      <th>-3</th>
      <td>6.0</td>
      <td>-1.156e-18</td>
      <td>1.699e-01</td>
      <td>-0.228</td>
      <td>-1.128e-01</td>
      <td>-6.939e-18</td>
      <td>0.113</td>
      <td>0.228</td>
    </tr>
    <tr>
      <th>-2</th>
      <td>7.0</td>
      <td>4.821e-04</td>
      <td>1.551e-01</td>
      <td>-0.238</td>
      <td>-8.987e-02</td>
      <td>2.247e-02</td>
      <td>0.105</td>
      <td>0.188</td>
    </tr>
    <tr>
      <th>-1</th>
      <td>8.0</td>
      <td>1.952e-18</td>
      <td>1.436e-01</td>
      <td>-0.222</td>
      <td>-7.504e-02</td>
      <td>5.204e-18</td>
      <td>0.075</td>
      <td>0.222</td>
    </tr>
    <tr>
      <th>0</th>
      <td>9.0</td>
      <td>1.253e-18</td>
      <td>1.343e-01</td>
      <td>-0.188</td>
      <td>-2.679e-02</td>
      <td>3.349e-03</td>
      <td>0.094</td>
      <td>0.234</td>
    </tr>
    <tr>
      <th>1</th>
      <td>8.0</td>
      <td>-1.952e-18</td>
      <td>1.436e-01</td>
      <td>-0.222</td>
      <td>-7.504e-02</td>
      <td>-5.204e-18</td>
      <td>0.075</td>
      <td>0.222</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7.0</td>
      <td>4.821e-04</td>
      <td>1.551e-01</td>
      <td>-0.238</td>
      <td>-8.987e-02</td>
      <td>2.247e-02</td>
      <td>0.105</td>
      <td>0.188</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6.0</td>
      <td>1.156e-18</td>
      <td>1.699e-01</td>
      <td>-0.228</td>
      <td>-1.128e-01</td>
      <td>6.939e-18</td>
      <td>0.113</td>
      <td>0.228</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>4.277e-03</td>
      <td>1.899e-01</td>
      <td>-0.189</td>
      <td>-1.885e-01</td>
      <td>7.451e-02</td>
      <td>0.075</td>
      <td>0.249</td>
    </tr>
    <tr>
      <th>5</th>
      <td>4.0</td>
      <td>0.000e+00</td>
      <td>2.194e-01</td>
      <td>-0.240</td>
      <td>-1.502e-01</td>
      <td>0.000e+00</td>
      <td>0.150</td>
      <td>0.240</td>
    </tr>
    <tr>
      <th>6</th>
      <td>3.0</td>
      <td>2.986e-02</td>
      <td>2.662e-01</td>
      <td>-0.277</td>
      <td>-4.697e-02</td>
      <td>1.835e-01</td>
      <td>0.184</td>
      <td>0.184</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2.0</td>
      <td>-2.776e-17</td>
      <td>3.799e-01</td>
      <td>-0.269</td>
      <td>-1.343e-01</td>
      <td>0.000e+00</td>
      <td>0.134</td>
      <td>0.269</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1.0</td>
      <td>3.799e-01</td>
      <td>NaN</td>
      <td>0.380</td>
      <td>3.799e-01</td>
      <td>3.799e-01</td>
      <td>0.380</td>
      <td>0.380</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</details>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#*** Plot BLM terms for basis set - basic</span>
<span class="n">basisKey</span> <span class="o">=</span> <span class="s1">&#39;BLMtableResort&#39;</span>

<span class="c1"># Basic plot</span>
<span class="n">ep</span><span class="o">.</span><span class="n">lmPlot</span><span class="p">(</span><span class="n">basisPlot</span><span class="p">,</span> <span class="n">xDim</span><span class="o">=</span><span class="n">stackDims</span><span class="p">);</span>  <span class="c1"># Basic plot with all terms</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plotting data (No filename), pType=a, thres=0.01, with Seaborn
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No handles with labels found to put in legend.
</pre></div>
</div>
<img alt="../_images/5f16836308d4d737327ccfa9ed6e65a369f1b5e12414b49dd00e5f06f8d2c2f6.png" src="../_images/5f16836308d4d737327ccfa9ed6e65a369f1b5e12414b49dd00e5f06f8d2c2f6.png" />
</div>
</details>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#*** Plot BLM terms for basis set - Plot with some additional figure formatting options</span>

<span class="c1"># cmap=None   # cmap = None for default. &#39;vlag&#39; good?</span>
<span class="c1"># cmap = &#39;vlag&#39;</span>

<span class="n">labelRound</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">catLegend</span><span class="o">=</span><span class="kc">False</span>
<span class="n">titleString</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="n">titleDetails</span><span class="o">=</span><span class="kc">False</span>
<span class="n">labelCols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># With global formatting args</span>
<span class="c1"># ep.lmPlot(basis[basisKey].where((basis[basisKey].l&lt;=lmaxPlot) &amp; (basis[basisKey].lp&lt;=lmaxPlot)).rename({&#39;S-Rp&#39;:&#39;M&#39;}).stack({&#39;LM&#39;:[&#39;L&#39;,&#39;M&#39;]}), xDim={&#39;LM&#39;:[&#39;L&#39;,&#39;M&#39;]},</span>
<span class="c1">#           cmap=cmap, labelRound = labelRound, catLegend=catLegend, titleString=titleString, titleDetails=titleDetails, labelCols = labelCols);</span>

<span class="c1"># With fig return - NEEDS WORK, displays but doesn&#39;t return fig object?</span>
<span class="c1"># UPDATE 28/11/22: still displays, but now have glue() working correctly.</span>
<span class="c1"># daPlot, daPlotpd, legendList, gFig = ep.lmPlot(basis[basisKey].where((basis[basisKey].l&lt;=lmaxPlot) &amp; (basis[basisKey].lp&lt;=lmaxPlot)).rename({&#39;S-Rp&#39;:&#39;M&#39;}).stack({&#39;LM&#39;:[&#39;L&#39;,&#39;M&#39;]}), xDim={&#39;LM&#39;:[&#39;L&#39;,&#39;M&#39;]},</span>
<span class="c1">#           pType = &#39;r&#39;, cmap=cmap, labelRound = labelRound, catLegend=catLegend, titleString=titleString, titleDetails=titleDetails, labelCols = labelCols);</span>

<span class="c1"># 30/11/22 simplified version</span>
<span class="n">daPlot</span><span class="p">,</span> <span class="n">daPlotpd</span><span class="p">,</span> <span class="n">legendList</span><span class="p">,</span> <span class="n">gFig</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">lmPlot</span><span class="p">(</span><span class="n">basisPlot</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">basisPlot</span><span class="o">.</span><span class="n">l</span><span class="o">&lt;=</span><span class="n">lmaxPlot</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">basisPlot</span><span class="o">.</span><span class="n">lp</span><span class="o">&lt;=</span><span class="n">lmaxPlot</span><span class="p">)),</span> 
                                               <span class="n">xDim</span><span class="o">=</span><span class="n">stackDims</span><span class="p">,</span> <span class="n">pType</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">labelRound</span> <span class="o">=</span> <span class="n">labelRound</span><span class="p">,</span> 
                                               <span class="n">catLegend</span><span class="o">=</span><span class="n">catLegend</span><span class="p">,</span> <span class="n">titleString</span><span class="o">=</span><span class="n">titleString</span><span class="p">,</span> <span class="n">titleDetails</span><span class="o">=</span><span class="n">titleDetails</span><span class="p">,</span> 
                                               <span class="n">labelCols</span> <span class="o">=</span> <span class="n">labelCols</span><span class="p">);</span>

<span class="c1"># For glue</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;lmPlot_BLM_basis_D2h&quot;</span><span class="p">,</span> <span class="n">gFig</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plotting data (No filename), pType=r, thres=0.01, with Seaborn
</pre></div>
</div>
<img alt="../_images/fc4c2a4c5a465295210c34432a0ec4a08f4018ce3f2e3488a442ae551a2e1443.png" src="../_images/fc4c2a4c5a465295210c34432a0ec4a08f4018ce3f2e3488a442ae551a2e1443.png" />
</div>
</details>
</div>
<figure class="align-default" id="fig-blm-basis-d2h">
<img alt="../_images/fc4c2a4c5a465295210c34432a0ec4a08f4018ce3f2e3488a442ae551a2e1443.png" src="../_images/fc4c2a4c5a465295210c34432a0ec4a08f4018ce3f2e3488a442ae551a2e1443.png" />
<figcaption>
<p><span class="caption-number">Fig. 3.3 </span><span class="caption-text">Example <span class="math notranslate nohighlight">\(B_{L,M}\)</span> basis functions for <span class="pasted-text">D2h</span> symmetry. Note figure is truncated to <span class="math notranslate nohighlight">\(l_{max}=l'_{max}=\)</span><span class="pasted-text">2</span> for clarity.</span><a class="headerlink" href="#fig-blm-basis-d2h" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="electric-field-geometric-coupling-term-e-p-r-hat-e-mu-0">
<span id="sec-theory-epr-term"></span><h2><span class="section-number">3.3.5. </span>Electric field geometric coupling term <span class="math notranslate nohighlight">\({E_{P,R}(\hat{e};\mu_{0})}\)</span><a class="headerlink" href="#electric-field-geometric-coupling-term-e-p-r-hat-e-mu-0" title="Permalink to this heading">#</a></h2>
<p>The coupling of two 1-photon terms (which arises in the square of the ionization matrix element as per Eq. <a class="reference internal" href="theory_photoionization_dynamics_191122.html#equation-eq-i-reduced-lf-2-45-vol1">(3.14)</a>) can be written as a tensor contraction:</p>
<div class="amsmath math notranslate nohighlight" id="equation-9b864f18-e326-4643-b707-1b8f10c94d4e">
<span class="eqno">(3.27)<a class="headerlink" href="#equation-9b864f18-e326-4643-b707-1b8f10c94d4e" title="Permalink to this equation">#</a></span>\[\begin{equation}
E_{PR}(\hat{e})=[e\otimes e^{*}]_{R}^{P}=[P]^{\frac{1}{2}}\sum_{p}(-1)^{R}\left(\begin{array}{ccc}
1 &amp; 1 &amp; P\\
p &amp; R-p &amp; -R
\end{array}\right)e_{p}e_{R-p}^{*}\label{eq:EPR-defn-1}
\end{equation}\]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(e_{p}\)</span> and <span class="math notranslate nohighlight">\(e_{R-p}\)</span> define the field strengths for the polarizations <span class="math notranslate nohighlight">\(p\)</span> and <span class="math notranslate nohighlight">\(R-p\)</span>, which are coupled into the spherical tensor <span class="math notranslate nohighlight">\(E_{PR}\)</span>;</p></li>
<li><p>square-brackets indicate degeneracy terms, e.g. <span class="math notranslate nohighlight">\([P]^{\frac{1}{2}} = (2P+1)^{\frac{1}{2}}\)</span>;</p></li>
<li><p>the symbol <span class="math notranslate nohighlight">\(\mu_{0}\)</span> is conventionally used to denote the <a class="reference internal" href="../backmatter/glossary.html#term-LF"><span class="xref std std-term">LF</span></a> field projection definition, given in full as <span class="math notranslate nohighlight">\((1,\mu_0)\)</span> for the 1-photon case, <strong>in general for the LF/AF case <span class="math notranslate nohighlight">\(\mu_0=p\)</span>, while for the MF case all projection terms are allowed, and are usually labelled by <span class="math notranslate nohighlight">\(\mu\)</span> or <span class="math notranslate nohighlight">\(q\)</span>.</strong> TO FIX</p></li>
</ul>
<p>(To derive this result, one can start from, e.g., Eq. 5.40 in Zare</p>
<div class="amsmath math notranslate nohighlight" id="equation-e3f141a2-60de-4306-bd21-7aed36ae7d1d">
<span class="eqno">(3.28)<a class="headerlink" href="#equation-e3f141a2-60de-4306-bd21-7aed36ae7d1d" title="Permalink to this equation">#</a></span>\[\begin{equation}
[A^{(1)}\otimes B^{(1)}]_{q}^{k}=\sum_{m}\langle1m,1q-m|kq\rangle A(1,m)B(1,q-m)
\end{equation}\]</div>
<p>Convert to <span class="math notranslate nohighlight">\(3j\)</span> form:</p>
<div class="amsmath math notranslate nohighlight" id="equation-b6380575-3879-4896-9e73-51175e176f02">
<span class="eqno">(3.29)<a class="headerlink" href="#equation-b6380575-3879-4896-9e73-51175e176f02" title="Permalink to this equation">#</a></span>\[\begin{equation}
[A^{(1)}\otimes B^{(1)}]_{q}^{k}=\sum_{m}(-1)^{q}[k]^{1/2}\left(\begin{array}{ccc}
1 &amp; 1 &amp; k\\
m &amp; q-m &amp; -q
\end{array}\right)A(1,m)B(1,q-m)
\end{equation}\]</div>
<p>And substitute in appropriate terms.)</p>
<p>As before, we can visualise these values…</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For illustration, recompute EPR term for default case.</span>
<span class="n">EPRX</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">geomCalc</span><span class="o">.</span><span class="n">EPR</span><span class="p">(</span><span class="n">form</span> <span class="o">=</span> <span class="s1">&#39;xarray&#39;</span><span class="p">)</span>

<span class="c1"># Set parameters to restack the Xarray into (L,M) pairs</span>
<span class="c1"># plotDimsRed = [&#39;l&#39;, &#39;p&#39;, &#39;lp&#39;, &#39;R-p&#39;]</span>
<span class="n">plotDimsRed</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;R-p&#39;</span><span class="p">]</span>
<span class="n">xDim</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;PR&#39;</span><span class="p">:[</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="s1">&#39;R&#39;</span><span class="p">]}</span>

<span class="c1"># Plot with ep.lmPlot(), real values</span>
<span class="n">daPlot</span><span class="p">,</span> <span class="n">daPlotpd</span><span class="p">,</span> <span class="n">legendList</span><span class="p">,</span> <span class="n">gFig</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">lmPlot</span><span class="p">(</span><span class="n">EPRX</span><span class="p">,</span> <span class="n">plotDims</span><span class="o">=</span><span class="n">plotDimsRed</span><span class="p">,</span> <span class="n">xDim</span><span class="o">=</span><span class="n">xDim</span><span class="p">,</span> <span class="n">pType</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="c1"># Version summed over l,m</span>
<span class="c1"># daPlot, daPlotpd, legendList, gFig = ep.lmPlot(EPRX.unstack().sum([&#39;l&#39;,&#39;lp&#39;,&#39;R-p&#39;]), xDim=xDim, pType = &#39;r&#39;)</span>

<span class="c1"># For glue</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;lmPlot_EPR_basis&quot;</span><span class="p">,</span> <span class="n">gFig</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plotting data (No filename), pType=r, thres=0.01, with Seaborn
</pre></div>
</div>
<img alt="../_images/12c20e1faddfcdeb2fcf118a6201197aab8c94815198c641b92fbbc4186234ee.png" src="../_images/12c20e1faddfcdeb2fcf118a6201197aab8c94815198c641b92fbbc4186234ee.png" />
</div>
</details>
</div>
<figure class="align-default" id="fig-epr-basis">
<img alt="../_images/12c20e1faddfcdeb2fcf118a6201197aab8c94815198c641b92fbbc4186234ee.png" src="../_images/12c20e1faddfcdeb2fcf118a6201197aab8c94815198c641b92fbbc4186234ee.png" />
<figcaption>
<p><span class="caption-number">Fig. 3.4 </span><span class="caption-text">Example <span class="math notranslate nohighlight">\(E_{P,R}\)</span> basis functions. Note that for linearly polarised light <span class="math notranslate nohighlight">\(p=R-p=0\)</span> only, hence only the terms <span class="math notranslate nohighlight">\(E_{0,0}\)</span> and <span class="math notranslate nohighlight">\(E_{2,0}\)</span> are non-zero in this case. For non-linearly polarised cases many other terms are allowed.</span><a class="headerlink" href="#fig-epr-basis" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="molecular-frame-projection-term-lambda">
<span id="sec-theory-lambda-term"></span><h2><span class="section-number">3.3.6. </span>Molecular frame projection term <span class="math notranslate nohighlight">\(\Lambda\)</span><a class="headerlink" href="#molecular-frame-projection-term-lambda" title="Permalink to this heading">#</a></h2>
<p>For the molecular frame case, the coupling between the <a class="reference internal" href="../backmatter/glossary.html#term-LF"><span class="xref std std-term">LF</span></a> and <a class="reference internal" href="../backmatter/glossary.html#term-MF"><span class="xref std std-term">MF</span></a> can be defined by a projection term, <span class="math notranslate nohighlight">\(\Lambda_{R',R}(R_{\hat{n}})\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-eq-basis-lambda-mf-defn">
<span class="eqno">(3.30)<a class="headerlink" href="#equation-eq-basis-lambda-mf-defn" title="Permalink to this equation">#</a></span>\[\begin{split}
\Lambda_{R',R}(R_{\hat{n}})=(-1)^{(R')}\left(\begin{array}{ccc}
1 &amp; 1 &amp; P\\
\mu &amp; -\mu' &amp; R'
\end{array}\right)D_{-R',-R}^{P}(R_{\hat{n}})
\end{split}\]</div>
<p>This is similar to the <span class="math notranslate nohighlight">\(E_{PR}\)</span> term, and essentially rotates it into the <a class="reference internal" href="../backmatter/glossary.html#term-MF"><span class="xref std std-term">MF</span></a>, defining the projections of the polarization vector (photon angular momentum) <span class="math notranslate nohighlight">\(\mu\)</span> into the <a class="reference internal" href="../backmatter/glossary.html#term-MF"><span class="xref std std-term">MF</span></a> for a given molecular orientation (frame rotation) defined by <span class="math notranslate nohighlight">\(R_{\hat{n}}\)</span>.</p>
<p>For the <a class="reference internal" href="../backmatter/glossary.html#term-LF"><span class="xref std std-term">LF</span></a>/<a class="reference internal" href="../backmatter/glossary.html#term-AF"><span class="xref std std-term">AF</span></a> case, the same term appears but in a simplified form:</p>
<div class="math notranslate nohighlight" id="equation-eq-basis-lambda-lf-defn">
<span class="eqno">(3.31)<a class="headerlink" href="#equation-eq-basis-lambda-lf-defn" title="Permalink to this equation">#</a></span>\[\begin{split}
\bar{\Lambda}_{R'}=(-1)^{(R')}\left(\begin{array}{ccc}
1 &amp; 1 &amp; P\\
\mu &amp; -\mu' &amp; R'
\end{array}\right)\equiv\Lambda_{R',R'}(R_{\hat{n}}=0)
\end{split}\]</div>
<p>This form pertains since - in the <a class="reference internal" href="../backmatter/glossary.html#term-LF"><span class="xref std std-term">LF</span></a>/<a class="reference internal" href="../backmatter/glossary.html#term-AF"><span class="xref std std-term">AF</span></a> case - there is no specific frame transformation defined (i.e. there is no single molecular orientation defined in relation to the light polarization, rather a distribution as defined by the <a class="reference internal" href="../backmatter/glossary.html#term-ADMs"><span class="xref std std-term">ADMs</span></a>), but the total angular momentum coupling of the photon terms is still required in the equations.</p>
<p>Numerically, the function is calculated for a specified set of orientations, which default to the standard set of <span class="math notranslate nohighlight">\((x,y,z)\)</span> MF polarization cases. For the LF/AF case, this term is still used, but restricted to <span class="math notranslate nohighlight">\(R_{\hat{n}} = (0,0,0) = z\)</span>, i.e. no frame rotation relative to the <a class="reference internal" href="../backmatter/glossary.html#term-LF"><span class="xref std std-term">LF</span></a> <span class="math notranslate nohighlight">\(E_{PR}\)</span> definition.</p>
<p>TODO: frame rotation illustration as well as term plots? Cf. QM1?</p>
</section>
<section id="alignment-tensor-delta-l-m-k-q-s">
<span id="sec-theory-af-alignment-term"></span><h2><span class="section-number">3.3.7. </span>Alignment tensor <span class="math notranslate nohighlight">\(\Delta_{L,M}(K,Q,S)\)</span><a class="headerlink" href="#alignment-tensor-delta-l-m-k-q-s" title="Permalink to this heading">#</a></h2>
<p>Finally, for the <a class="reference internal" href="../backmatter/glossary.html#term-LF"><span class="xref std std-term">LF</span></a>/<a class="reference internal" href="../backmatter/glossary.html#term-AF"><span class="xref std std-term">AF</span></a> case, the alignment tensor couples the molecular axis ensemble (defined as a set of <a class="reference internal" href="../backmatter/glossary.html#term-ADMs"><span class="xref std std-term">ADMs</span></a>) and the photoionization multipole terms into the final observable.</p>
<div class="math notranslate nohighlight" id="equation-eq-basis-alignmenttensor-defn">
<span class="eqno">(3.32)<a class="headerlink" href="#equation-eq-basis-alignmenttensor-defn" title="Permalink to this equation">#</a></span>\[\begin{split}
\Delta_{L,M}(K,Q,S)=(2K+1)^{1/2}(-1)^{K+Q}\left(\begin{array}{ccc}
P &amp; K &amp; L\\
R &amp; -Q &amp; -M
\end{array}\right)\left(\begin{array}{ccc}
P &amp; K &amp; L\\
R' &amp; -S &amp; S-R'
\end{array}\right)
\end{split}\]</div>
<p>In the full equations for the observable, this term appears in a summation with the <a class="reference internal" href="../backmatter/glossary.html#term-ADMs"><span class="xref std std-term">ADMs</span></a>, as:</p>
<div class="math notranslate nohighlight" id="equation-eq-basis-aligmentterm-defn">
<span class="eqno">(3.33)<a class="headerlink" href="#equation-eq-basis-aligmentterm-defn" title="Permalink to this equation">#</a></span>\[
\tilde{\Delta}_{L,M}(t) = \sum_{K,Q,S}\Delta_{L,M}(K,Q,S)A_{Q,S}^{K}(t)
\]</div>
<p>This summed alignment term can be considered, essentially, as a (coherent) geometric averaging of the <a class="reference internal" href="../backmatter/glossary.html#term-MF"><span class="xref std std-term">MF</span></a> observable weighted by the axis distribution in the <a class="reference internal" href="../backmatter/glossary.html#term-AF"><span class="xref std std-term">AF</span></a> (for more on the axis averaging as a convolution, see Refs. <span id="id20">[<a class="reference internal" href="../backmatter/bibliography.html#id613" title="Paul Hockett. Quantum Metrology with Photoelectrons, Volume 1: Foundations. IOP Publishing, 2018. ISBN 978-1-68174-684-5. URL: http://iopscience.iop.org/book/978-1-6817-4684-5, doi:10.1088/978-1-6817-4684-5.">1</a>, <a class="reference internal" href="../backmatter/bibliography.html#id842" title="Jonathan G. Underwood and Katharine L. Reid. Time-resolved photoelectron angular distributions as a probe of intramolecular dynamics: Connecting the molecular frame and the laboratory frame. The Journal of Chemical Physics, 113(3):1067, 2000. URL: http://link.aip.org/link/JCPSA6/v113/i3/p1067/s1&amp;Agg=doi (visited on 2012-07-17), doi:10.1063/1.481918.">53</a>]</span>); equivalently, the averaging can be considered as a purely angular-momentum coupling effect, which accounts for all contributing moments of the various aspects of the system, and defines the allowed projections onto the final observables in the <a class="reference internal" href="../backmatter/glossary.html#term-LF"><span class="xref std std-term">LF</span></a>.</p>
<p>Mappings of these terms are investigated numerically below, for some examplar cases.</p>
<section id="basic-cases">
<span id="sec-theory-af-alignment-term-basic"></span><h3><span class="section-number">3.3.7.1. </span>Basic cases<a class="headerlink" href="#basic-cases" title="Permalink to this heading">#</a></h3>
<p><a class="reference internal" href="#fig-deltaterm000"><span class="std std-numref">Fig. 3.5</span></a> illustrates the alignment tensor <span class="math notranslate nohighlight">\(\Delta_{L,M}(K,Q,S)\)</span> for some basic cases, and values are also tabulated in <a class="reference internal" href="#tab-deltaterm000"><span class="std std-numref">Fig. 3.6</span></a>. Note that for illustration purposes the term is subselected with <span class="math notranslate nohighlight">\(K=0\)</span>, <span class="math notranslate nohighlight">\(Q=0\)</span>, <span class="math notranslate nohighlight">\(S=0\)</span> and <span class="math notranslate nohighlight">\(R'=0\)</span>; <span class="math notranslate nohighlight">\(R\neq0\)</span> terms are included to illustrate the elliptically-polarized case, which can give rise to non-zero <span class="math notranslate nohighlight">\(M\)</span> terms.</p>
<p>For the simplest case of an unaligned ensemble, this term is restricted to <span class="math notranslate nohighlight">\(K=Q=S=0\)</span>, i.e. <span class="math notranslate nohighlight">\(\Delta_{L,M}(0,0,0)\)</span>; for single-photon ionization with linearly-polarized light (<span class="math notranslate nohighlight">\(p=0\)</span>, hence <span class="math notranslate nohighlight">\(P=0,2\)</span> and <span class="math notranslate nohighlight">\(R=R'=0\)</span>), this has non-zero values for <span class="math notranslate nohighlight">\(L=0,2\)</span> and <span class="math notranslate nohighlight">\(M=0\)</span> only. Typically, this simplest case is synonymous with standard <a class="reference internal" href="../backmatter/glossary.html#term-LF"><span class="xref std std-term">LF</span></a> results, and maintains cylindrical and up-down symmetry in the observable.</p>
<p>For circularly polarized light (<span class="math notranslate nohighlight">\(p=\pm1\)</span>, hence <span class="math notranslate nohighlight">\(P=0,1,2\)</span> and <span class="math notranslate nohighlight">\(R=R'=0\)</span>), odd-<span class="math notranslate nohighlight">\(L\)</span> is allowed, signifying up/down symmetry breaking in the observable (where up/down pertains to the propagation direction of the light, conventionally the <span class="math notranslate nohighlight">\(z\)</span>-axis). For elliptically polarized light, mixing of terms with different <span class="math notranslate nohighlight">\(p\)</span> allows for non-zero <span class="math notranslate nohighlight">\(R\)</span> terms, hence non-zero <span class="math notranslate nohighlight">\(M\)</span> is allowed, signifying breaking of cylindrical symmetry in the observable.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#*** Set range of ADMs for test as time-dependent values - single call</span>
<span class="c1"># AKQS = ep.setADMs(ADMs = [[0,0,0,1,1,1,1],</span>
<span class="c1">#                           [2,0,0,0,0.5,1,1],</span>
<span class="c1">#                           [4,0,0,0,0,0,0.3]])  #, t=[0,1,2])    # Nested list or np.array OK.</span>
<span class="c1"># AKQS = ep.setADMs(ADMs = np.array([[0,0,0,1,1],[2,0,0,0,0.5]]), t=[0,1])</span>

<span class="c1">#*** Alternative form with ADM inds separate</span>
<span class="c1"># ADMinds = np.array([[0,0,0],[2,0,0],[4,0,0]])</span>
<span class="c1"># AKQS = ep.setADMs(ADMs = np.stack((np.ones(4),np.linspace(0,1,4),np.linspace(0,0.2,4))),</span>
<span class="c1">#                   KQSLabels=ADMinds)</span>


<span class="c1"># For computation set ADMs and EPR term first.</span>
<span class="c1"># Note that delta term is independent of the absolute values of the ADMs(t), but does use this term to define limits on some quantum numbers.</span>

<span class="c1">#*** Neater version</span>
<span class="c1"># Set ADMs for increasing alignment...</span>
<span class="n">tPoints</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">inputADMs</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">tPoints</span><span class="p">)],</span>     <span class="c1"># * np.sqrt(4*np.pi)],  # Optional multiplier for normalisation</span>
             <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">tPoints</span><span class="p">)],</span> 
             <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">tPoints</span><span class="p">)],</span>
             <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="n">tPoints</span><span class="p">)],</span>
             <span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="n">tPoints</span><span class="p">)]]</span>

<span class="n">AKQS</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">setADMs</span><span class="p">(</span><span class="n">ADMs</span> <span class="o">=</span> <span class="n">inputADMs</span><span class="p">)</span>  <span class="c1"># TODO WRAP TO CLASS (IF NOT ALREADY!)</span>


<span class="c1">#*** Plot ADMs</span>
<span class="c1"># daPlot, daPlotpd, legendList, gFig = ep.lmPlot(AKQS, xDim = &#39;t&#39;, pType = &#39;r&#39;, squeeze = False, thres=None, cmap=&#39;vlag&#39;)  # Note squeeze = False required for 1D case (should add this to code!)</span>
<span class="c1"># daPlotpd</span>

<span class="c1"># Example alignment term, assuming all other terms allow/unity valued.</span>

<span class="c1"># Use default EPR term - note this computes for all pol states, p=[-1,0,1]</span>
<span class="n">EPR</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">geomCalc</span><span class="o">.</span><span class="n">EPR</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="s1">&#39;xarray&#39;</span><span class="p">)</span>

<span class="c1"># Compute alignment terms</span>
<span class="n">AFterm</span><span class="p">,</span> <span class="n">DeltaTerm</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">geomCalc</span><span class="o">.</span><span class="n">deltaLMKQS</span><span class="p">(</span><span class="n">EPR</span><span class="p">,</span> <span class="n">AKQS</span><span class="p">)</span>

<span class="c1">#*** Plot Delta term with subselections</span>
<span class="c1"># xDim = {&#39;KQ&#39;:[&#39;K&#39;,&#39;Q&#39;]}</span>
<span class="n">xDim</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;LM&#39;</span><span class="p">:[</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">]}</span>
<span class="n">daPlot</span><span class="p">,</span> <span class="n">daPlotpd</span><span class="p">,</span> <span class="n">legendList</span><span class="p">,</span> <span class="n">gFig</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">lmPlot</span><span class="p">(</span><span class="n">DeltaTerm</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">S</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">Rp</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">({</span><span class="s1">&#39;S-Rp&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}),</span> <span class="n">xDim</span> <span class="o">=</span> <span class="n">xDim</span><span class="p">,</span> <span class="n">pType</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">squeeze</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">thres</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="c1">#, cmap=&#39;vlag&#39;) # , fillna=True)  # Note squeeze = False required for 1D case (should add this to code!)</span>
<span class="c1"># daPlotpd.fillna(&#39;&#39;)</span>

<span class="c1"># Glue versions for JupyterBook output</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;deltaTerm000-lmPlot&quot;</span><span class="p">,</span> <span class="n">gFig</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;deltaTerm000-tab&quot;</span><span class="p">,</span><span class="n">daPlotpd</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># As above, but with PD object return and glue.</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set dataType (No dataType)
Plotting data (No filename), pType=r, thres=None, with Seaborn
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No handles with labels found to put in legend.
</pre></div>
</div>
<img alt="../_images/8617def9b4801c655e45ad191160b6afbf59b43d1800775e3840c455d08a3727.png" src="../_images/8617def9b4801c655e45ad191160b6afbf59b43d1800775e3840c455d08a3727.png" />
</div>
</details>
</div>
<figure class="align-default" id="fig-deltaterm000">
<img alt="../_images/8617def9b4801c655e45ad191160b6afbf59b43d1800775e3840c455d08a3727.png" src="../_images/8617def9b4801c655e45ad191160b6afbf59b43d1800775e3840c455d08a3727.png" />
<figcaption>
<p><span class="caption-number">Fig. 3.5 </span><span class="caption-text">Example <span class="math notranslate nohighlight">\(\Delta_{L,M}(0,0,0)\)</span> basis functions (see also <a class="reference internal" href="#tab-deltaterm000"><span class="std std-numref">Fig. 3.6</span></a>). For illustration purposes, the plot only shows terms for <span class="math notranslate nohighlight">\(R'=0\)</span>. See main text for discussion.</span><a class="headerlink" href="#fig-deltaterm000" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-default" id="tab-deltaterm000">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>L</th>
      <th>0</th>
      <th colspan="3" halign="left">1</th>
      <th colspan="5" halign="left">2</th>
    </tr>
    <tr>
      <th></th>
      <th>M</th>
      <th>0</th>
      <th>-1</th>
      <th>0</th>
      <th>1</th>
      <th>-2</th>
      <th>-1</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
    </tr>
    <tr>
      <th>P</th>
      <th>R</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <th>0</th>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">1</th>
      <th>-1</th>
      <td></td>
      <td></td>
      <td></td>
      <td>-0.333</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>0</th>
      <td></td>
      <td></td>
      <td>0.333</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td></td>
      <td>-0.333</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">2</th>
      <th>-2</th>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>-1</th>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td>-0.2</td>
      <td></td>
    </tr>
    <tr>
      <th>0</th>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td>0.2</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td>-0.2</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td>0.2</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table>
</div></div><figcaption>
<p><span class="caption-number">Fig. 3.6 </span><span class="caption-text">Example <span class="math notranslate nohighlight">\(\Delta_{L,M}(0,0,0)\)</span> basis functions (see also <a class="reference internal" href="#fig-deltaterm000"><span class="std std-numref">Fig. 3.5</span></a>). For illustration purposes, the table only shows terms for <span class="math notranslate nohighlight">\(R'=0\)</span>. See main text for discussion.</span><a class="headerlink" href="#tab-deltaterm000" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#*** Plot ADMs</span>
<span class="n">daPlot</span><span class="p">,</span> <span class="n">daPlotpd</span><span class="p">,</span> <span class="n">legendList</span><span class="p">,</span> <span class="n">ADMFig</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">lmPlot</span><span class="p">(</span><span class="n">AKQS</span><span class="p">,</span> <span class="n">xDim</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">pType</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">squeeze</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;vlag&#39;</span><span class="p">)</span>  <span class="c1"># Note squeeze = False required for 1D case (should add this to code!)</span>
<span class="c1"># daPlotpd</span>

<span class="c1">#*** Plot subsection</span>
<span class="n">daPlot</span><span class="p">,</span> <span class="n">daPlotpd</span><span class="p">,</span> <span class="n">legendList</span><span class="p">,</span> <span class="n">AFFig</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">lmPlot</span><span class="p">(</span><span class="n">AFterm</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">Rp</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">({</span><span class="s1">&#39;S-Rp&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}),</span> 
                                               <span class="n">xDim</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">pType</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">squeeze</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;vlag&#39;</span><span class="p">)</span>  <span class="c1"># Note squeeze = False required for 1D case (should add this to code!)</span>

<span class="c1"># Glue versions for JupyterBook output</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;ADMs-linearRamp-lmPlot&quot;</span><span class="p">,</span> <span class="n">ADMFig</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;AFterm-linearRamp-lmPlot&quot;</span><span class="p">,</span> <span class="n">AFFig</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plotting data (No filename), pType=r, thres=0.01, with Seaborn
Set dataType (No dataType)
Plotting data (No filename), pType=r, thres=0.01, with Seaborn
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No handles with labels found to put in legend.
</pre></div>
</div>
<img alt="../_images/6faa50b16e6c32dde498027193ccd0837c9680ab0622719792c4b605de89a33f.png" src="../_images/6faa50b16e6c32dde498027193ccd0837c9680ab0622719792c4b605de89a33f.png" />
<img alt="../_images/30dc5e8238a6787facf4cafdeffa6288715d26263b400cc240eafc4559e23a3d.png" src="../_images/30dc5e8238a6787facf4cafdeffa6288715d26263b400cc240eafc4559e23a3d.png" />
</div>
</details>
</div>
<figure class="align-default" id="fig-adms-linearramp">
<img alt="../_images/6faa50b16e6c32dde498027193ccd0837c9680ab0622719792c4b605de89a33f.png" src="../_images/6faa50b16e6c32dde498027193ccd0837c9680ab0622719792c4b605de89a33f.png" />
<figcaption>
<p><span class="caption-number">Fig. 3.7 </span><span class="caption-text">Example ADMs used for <a class="reference internal" href="../backmatter/glossary.html#term-AF"><span class="xref std std-term">AF</span></a> basis function example (see <a class="reference internal" href="#fig-afterm-linearramp"><span class="std std-numref">Fig. 3.8</span></a>). These ADMs essentially show an increasing degree of alignment with the <span class="math notranslate nohighlight">\(t\)</span> parameter, with high-order terms increasing at later <span class="math notranslate nohighlight">\(t\)</span>.</span><a class="headerlink" href="#fig-adms-linearramp" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-default" id="fig-afterm-linearramp">
<img alt="../_images/30dc5e8238a6787facf4cafdeffa6288715d26263b400cc240eafc4559e23a3d.png" src="../_images/30dc5e8238a6787facf4cafdeffa6288715d26263b400cc240eafc4559e23a3d.png" />
<figcaption>
<p><span class="caption-number">Fig. 3.8 </span><span class="caption-text">Example of <span class="math notranslate nohighlight">\(\tilde{\Delta}_{L,M}(t)\)</span> basis values for various choices of alignment (as per <a class="reference internal" href="#fig-adms-linearramp"><span class="std std-numref">Fig. 3.7</span></a>). The ADMs essentially show an increasing degree of alignment with the <span class="math notranslate nohighlight">\(t\)</span> parameter, with high-order terms increasing at later <span class="math notranslate nohighlight">\(t\)</span>, and this is reflected in the <span class="math notranslate nohighlight">\(\tilde{\Delta}_{L,M}(t)\)</span> terms with higher-order <span class="math notranslate nohighlight">\(L\)</span> appearing at later <span class="math notranslate nohighlight">\(t\)</span>.</span><a class="headerlink" href="#fig-afterm-linearramp" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>For cases with aligned molecular ensembles, additional terms can similarly appear depending on the alignment as well as the properties of the ionizing radiation. Again, the types of terms follow some typical patterns dependent on the symmetry of the ensemble, as well as the order of the terms allowed. For instance, <span class="math notranslate nohighlight">\(L_{max}=P_{max}+K_{max}=2+K_{max}\)</span>, and <span class="math notranslate nohighlight">\(K_{max}\)</span> represents the overall degree of alignment of the ensemble; hence an aligned ensemble may be signified by higher-order terms in the observable (if allowed by other terms in the overall expansion) or, equivalently, aligning an ensemble prior to ionization can be used as a way to control which terms contribute to the alignment tensor.</p>
<p>Since this is a coherent averaging, additional interferences can also appear in the <a class="reference internal" href="../backmatter/glossary.html#term-AF"><span class="xref std std-term">AF</span></a> - or be restricted in the <a class="reference internal" href="../backmatter/glossary.html#term-AF"><span class="xref std std-term">AF</span></a> - depending on these geometric parameters and the contributing matrix elements. Additionally, any effects modulating these terms, for instance a time-dependent alignment (rotational wavepacket), vibronic dynamics (vibrational and/or electronic wavepacket), time-dependent laser field (control field) may be anticipted to lead to both changes in these terms and, potentially, interesting effects in the observable. Such effects have been discussed in more detail in <em>Quantum Metrology</em> Vol. 2 <span id="id21">[<a class="reference internal" href="../backmatter/bibliography.html#id614" title="Paul Hockett. Quantum Metrology with Photoelectrons, Volume 2: Applications and Advances. IOP Publishing, 2018. ISBN 978-1-68174-688-3. URL: http://iopscience.iop.org/book/978-1-6817-4688-3, doi:10.1088/978-1-6817-4688-3.">2</a>]</span>, and in the current case the focus is purely on rotational wavepackets.</p>
<p><a class="reference internal" href="#fig-afterm-linearramp"><span class="std std-numref">Fig. 3.8</span></a> shows <span class="math notranslate nohighlight">\(\tilde{\Delta}_{L,M}(t)\)</span> for various choices of alignment (as per the <a class="reference internal" href="../backmatter/glossary.html#term-ADMs"><span class="xref std std-term">ADMs</span></a> shown in <a class="reference internal" href="#fig-adms-linearramp"><span class="std std-numref">Fig. 3.7</span></a>), and illustrates some of the general features discussed. Note, for example:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(L_{max}\)</span> varies with alignment; in the demonstration case <span class="math notranslate nohighlight">\(K_{max}=8\)</span> at later times, resulting in <span class="math notranslate nohighlight">\(L_{max}=10\)</span>, whilst at <span class="math notranslate nohighlight">\(t=0\)</span> <span class="math notranslate nohighlight">\(K_{max}=0\)</span>, thus restricting terms to <span class="math notranslate nohighlight">\(L_{max}=2\)</span>.</p></li>
<li><p>Odd-<span class="math notranslate nohighlight">\(L\)</span> values are correlated with <span class="math notranslate nohighlight">\(P=1\)</span> terms.</p></li>
<li><p>Only <span class="math notranslate nohighlight">\(M=0\)</span> terms are allowed in this case (<span class="math notranslate nohighlight">\(Q=S=0\)</span>).</p></li>
</ul>
</section>
<section id="d-alignments-and-symmetry-breaking">
<span id="sec-theory-af-alignment-term-3d"></span><h3><span class="section-number">3.3.7.2. </span>3D alignments and symmetry breaking<a class="headerlink" href="#d-alignments-and-symmetry-breaking" title="Permalink to this heading">#</a></h3>
<p>As discussed above, for the case where <span class="math notranslate nohighlight">\(Q\neq0\)</span> and/or <span class="math notranslate nohighlight">\(S\neq0\)</span> additional symmetry breaking can occur. It is simple to examine these effects numerically via changing the trial <a class="reference internal" href="../backmatter/glossary.html#term-ADMs"><span class="xref std std-term">ADMs</span></a> used to determine <span class="math notranslate nohighlight">\(\tilde{\Delta}_{L,M}(t)\)</span> (Eq. <a class="reference internal" href="#equation-eq-basis-aligmentterm-defn">(3.33)</a>).</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#*** Neater version</span>
<span class="c1"># Set ADMs for increasing alignment...</span>
<span class="n">tPoints</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">inputADMs3D</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">tPoints</span><span class="p">)],</span>     <span class="c1"># * np.sqrt(4*np.pi)],  # Optional multiplier for normalisation</span>
             <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">tPoints</span><span class="p">)],</span> 
             <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">tPoints</span><span class="p">)],</span>
             <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">tPoints</span><span class="p">)],</span>
             <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="n">tPoints</span><span class="p">)]]</span>

<span class="n">AKQS</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">setADMs</span><span class="p">(</span><span class="n">ADMs</span> <span class="o">=</span> <span class="n">inputADMs3D</span><span class="p">)</span>  <span class="c1"># TODO WRAP TO CLASS (IF NOT ALREADY!)</span>

<span class="c1"># Compute alignment terms</span>
<span class="n">AFterm</span><span class="p">,</span> <span class="n">DeltaTerm</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">geomCalc</span><span class="o">.</span><span class="n">deltaLMKQS</span><span class="p">(</span><span class="n">EPR</span><span class="p">,</span> <span class="n">AKQS</span><span class="p">)</span>

<span class="c1">#*** Plot all</span>
<span class="c1"># daPlot, daPlotpd, legendList, gFig = ep.lmPlot(AFterm,    #.sel(R=0).sel(Rp=0), </span>
<span class="c1">#                                                xDim = &#39;t&#39;, pType = &#39;r&#39;, squeeze = False, cmap=&#39;vlag&#39;)  # Note squeeze = False required for 1D case (should add this to code!)</span>


<span class="c1">#*** Plot subsection, L&lt;=2</span>
<span class="c1"># .sel(R=0).sel(Rp=0) gives M=0 terms only for R=Rp=0</span>
<span class="c1"># .sel(R=0) gives M=0 terms only</span>
<span class="c1"># .sel(Rp=0) gives M!=0 terms, S-Rp=0 terms only</span>

<span class="n">daPlot</span><span class="p">,</span> <span class="n">daPlotpd</span><span class="p">,</span> <span class="n">legendList</span><span class="p">,</span> <span class="n">gFig</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">lmPlot</span><span class="p">(</span><span class="n">AFterm</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">AFterm</span><span class="o">.</span><span class="n">L</span><span class="o">&lt;=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">Rp</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>    <span class="c1"># .sel(R=0).sel(Rp=0), #M=0 for R=Rp=0</span>
                                               <span class="n">xDim</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">pType</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">squeeze</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;vlag&#39;</span><span class="p">)</span>  <span class="c1"># Note squeeze = False required for 1D case (should add this to code!)</span>

<span class="c1"># Glue versions for JupyterBook output</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;ADMs-3DlinearRamp-lmPlot&quot;</span><span class="p">,</span> <span class="n">gFig</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set dataType (No dataType)
Plotting data (No filename), pType=r, thres=0.01, with Seaborn
</pre></div>
</div>
<img alt="../_images/c7fe87aac6c11749f240583321ca77346dfe75ac4fa6df75d9feb1b9ea7f0912.png" src="../_images/c7fe87aac6c11749f240583321ca77346dfe75ac4fa6df75d9feb1b9ea7f0912.png" />
</div>
</details>
</div>
<figure class="align-default" id="fig-adms-3dlinearramp">
<img alt="../_images/c7fe87aac6c11749f240583321ca77346dfe75ac4fa6df75d9feb1b9ea7f0912.png" src="../_images/c7fe87aac6c11749f240583321ca77346dfe75ac4fa6df75d9feb1b9ea7f0912.png" />
<figcaption>
<p><span class="caption-number">Fig. 3.9 </span><span class="caption-text">Example <span class="math notranslate nohighlight">\(\tilde{\Delta}_{L,M}(t)\)</span> basis values for various choices of “3D” alignment, i.e. including some <span class="math notranslate nohighlight">\(K\neq0\)</span> and <span class="math notranslate nohighlight">\(S\neq0\)</span> terms. Note, in particular, the presence of <span class="math notranslate nohighlight">\(M\neq0\)</span> terms in general, and a complicated dependence of the allowed terms on the alignment (<a class="reference internal" href="../backmatter/glossary.html#term-ADMs"><span class="xref std std-term">ADMs</span></a>), which may increase, decrease, or even change sign for a given <span class="math notranslate nohighlight">\(L,M\)</span>.</span><a class="headerlink" href="#fig-adms-3dlinearramp" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">daPlot</span><span class="p">,</span> <span class="n">daPlotpd</span><span class="p">,</span> <span class="n">legendList</span><span class="p">,</span> <span class="n">gFig</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">lmPlot</span><span class="p">(</span><span class="n">AFterm</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">AFterm</span><span class="o">.</span><span class="n">L</span><span class="o">&lt;=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">M</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>    <span class="c1"># .sel(R=0).sel(Rp=0), #M=0 for R=Rp=0</span>
                                               <span class="n">xDim</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">pType</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">squeeze</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;vlag&#39;</span><span class="p">)</span>  <span class="c1"># Note squeeze = False required for 1D case (should add this to code!)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set dataType (No dataType)
Plotting data (No filename), pType=r, thres=0.01, with Seaborn
</pre></div>
</div>
<img alt="../_images/249852076deefd30cc955567ff7c9ca42b4f9eb9529ed3d50b3b5a807d99770c.png" src="../_images/249852076deefd30cc955567ff7c9ca42b4f9eb9529ed3d50b3b5a807d99770c.png" />
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">daPlot</span><span class="p">,</span> <span class="n">daPlotpd</span><span class="p">,</span> <span class="n">legendList</span><span class="p">,</span> <span class="n">gFig</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">lmPlot</span><span class="p">(</span><span class="n">AFterm</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">AFterm</span><span class="o">.</span><span class="n">L</span><span class="o">&lt;=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">M</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>    <span class="c1"># .sel(R=0).sel(Rp=0), #M=0 for R=Rp=0</span>
                                               <span class="n">xDim</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">pType</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">squeeze</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;vlag&#39;</span><span class="p">)</span>  <span class="c1"># Note squeeze = False required for 1D case (should add this to code!)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set dataType (No dataType)
Plotting data (No filename), pType=r, thres=0.01, with Seaborn
</pre></div>
</div>
<img alt="../_images/d4e7cbf2e5569a158f74f0181bd9a1a14cfa25f2c5fc634e8d0f027038cd96df.png" src="../_images/d4e7cbf2e5569a158f74f0181bd9a1a14cfa25f2c5fc634e8d0f027038cd96df.png" />
</div>
</details>
</div>
<p>For illustration purposes, <a class="reference internal" href="#fig-adms-3dlinearramp"><span class="std std-numref">Fig. 3.9</span></a> shows a subselection of the <span class="math notranslate nohighlight">\(\tilde{\Delta}_{L,M}(t)\)</span> basis values, indicating some of the key features in the full 3D case, subselected for <span class="math notranslate nohighlight">\(L\leq2\)</span> and <span class="math notranslate nohighlight">\(R'=0\)</span> terms only.</p>
<p>Note, in particular, the presence of <span class="math notranslate nohighlight">\(M\neq0\)</span> terms in general, and a complicated dependence of the allowed terms on the alignment, which may increase, decrease, or even change sign. % TODO: give more explict examples here, may want to also reduce and consolidate illustrations further?
As previously, these behaviours are generally useful for understanding specific cases or planning experiments for specific systems; this is explored further in Part II which focuses on the results for particular molecules (hence symmetries and sets of matrix elements).</p>
</section>
</section>
<section id="tensor-product-terms">
<span id="sec-theory-tensor-products"></span><h2><span class="section-number">3.3.8. </span>Tensor product terms<a class="headerlink" href="#tensor-product-terms" title="Permalink to this heading">#</a></h2>
<p>Following the above, further resultant terms can also be examined, up to and including the full channel functions <span class="math notranslate nohighlight">\(\varUpsilon_{L,M}^{u,\zeta\zeta'}\)</span> (see <a class="reference internal" href="#equation-eqn-channel-fns">(3.18)</a>) for a given case. Numerically these are all implemented in the main <a class="reference external" href="https://epsproc.readthedocs.io">ePSproc codebase</a> <span id="id22">[<a class="reference internal" href="../backmatter/bibliography.html#id605" title="Paul Hockett. ePSproc: Post-processing suite for ePolyScat electron-molecule scattering calculations. Authorea, 2016. URL: https://www.authorea.com/users/71114/articles/122402/_show_article, doi:10.6084/m9.figshare.3545639.">12</a>, <a class="reference internal" href="../backmatter/bibliography.html#id547" title="Paul Hockett. ePSproc: Post-processing for ePolyScat (Github repository). Github, 2016. URL: https://github.com/phockett/ePSproc, doi:10.6084/m9.figshare.3545639.">13</a>, <a class="reference internal" href="../backmatter/bibliography.html#id545" title="Paul Hockett. ePSproc: Post-processing for ePolyScat documentation. 2020. URL: https://epsproc.readthedocs.io (visited on 2022-02-18).">14</a>]</span>, and can be returned by these functions for inspection - the full basis set already defined includes some of these product. Custom tensor product terms are also readily computed with the codebase, with tensor multiplications handled natively by the Xarray data objects.</p>
<p>Polarisation &amp; ADM product term: the main product basis returned, <code class="docutils literal notranslate"><span class="pre">polProd</span></code>, contains the tensor product <span class="math notranslate nohighlight">\(\Lambda_{R}\otimes E_{PR}(\hat{e})\otimes \Delta_{L,M}(K,Q,S)\otimes A^{K}_{Q,S}(t)\)</span>, expanded over all quantum numbers (see <a class="reference external" href="https://epsproc.readthedocs.io/en/dev/methods/geometric_method_dev_pt3_AFBLM_090620_010920_dev_bk100920.html#%5Cbeta_%7BL,M%7D%5E%7BAF%7D-rewrite">full definition here</a>). This term, therefore, incorporates all of the dependence (or response) of the AF-<span class="math notranslate nohighlight">\(\beta_{LM}\)</span>s on the polarisation state, and the axis distribution. Example results, making use of the linear-ramp <a class="reference internal" href="../backmatter/glossary.html#term-ADMs"><span class="xref std std-term">ADMs</span></a> of <a class="reference internal" href="#sec-theory-af-alignment-term-basic"><span class="std std-numref">Sect. 3.3.7.1</span></a> are illustrated in <a class="reference internal" href="#fig-polprod-linearramp"><span class="std std-numref">Fig. 3.10</span></a>.</p>
<p>The full channel (response) functions <span class="math notranslate nohighlight">\(\varUpsilon_{L,M}^{u,\zeta\zeta'}\)</span> as defined in <a class="reference internal" href="#equation-eq-channelfunc-mf-defn">(3.23)</a> and <a class="reference internal" href="#equation-eq-channelfunc-af-defn">(3.24)</a> can be determined by the product of this term with the <span class="math notranslate nohighlight">\(B_{L,M}\)</span> tensor. This is essentially the complete geometric basis set,</p>
<p>hence equivalent to the AF-<span class="math notranslate nohighlight">\(\beta_{LM}\)</span> if the ionization matrix elements were set to unity. This illustrates not only the coupling of the geometric terms into the observable <span class="math notranslate nohighlight">\(L,M\)</span>, but also how the partial wave <span class="math notranslate nohighlight">\(|l,m\rangle\)</span> terms map to the observables, and hence the sensitivity of the observables to given partial wave properties. Example results, making use of the linear-ramp <a class="reference internal" href="../backmatter/glossary.html#term-ADMs"><span class="xref std std-term">ADMs</span></a> of <a class="reference internal" href="#sec-theory-af-alignment-term-basic"><span class="std std-numref">Sect. 3.3.7.1</span></a> are illustrated in <a class="reference internal" href="#fig-channelfunc-linearramp"><span class="std std-numref">Fig. 3.11</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set data - set example ADMs to data structure &amp; subset for calculation</span>
<span class="n">data</span><span class="o">.</span><span class="n">setADMs</span><span class="p">(</span><span class="n">ADMs</span> <span class="o">=</span> <span class="n">inputADMs</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">setSubset</span><span class="p">(</span><span class="n">dataKey</span> <span class="o">=</span> <span class="s1">&#39;ADM&#39;</span><span class="p">,</span> <span class="n">dataType</span> <span class="o">=</span> <span class="s1">&#39;ADM&#39;</span><span class="p">)</span>

<span class="c1"># Using PEMtk - this only returns the product basis set as used for fitting</span>
<span class="n">BetaNormX</span><span class="p">,</span> <span class="n">basisProduct</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">afblmMatEfit</span><span class="p">(</span><span class="n">selDims</span><span class="o">=</span><span class="p">{},</span> <span class="n">sqThres</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Subselected from dataset &#39;ADM&#39;, dataType &#39;ADM&#39;: 50 from 50 points (100.00%)
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">basisKey</span> <span class="o">=</span> <span class="s1">&#39;polProd&#39;</span>  <span class="c1"># Key for BLM basis set</span>

<span class="c1"># Reformat basis for display (optional)</span>
<span class="c1"># stackDims = {&#39;LM&#39;:[&#39;L&#39;,&#39;M&#39;]}</span>
<span class="c1"># basisPlot = basis[basisKey].rename({&#39;S-Rp&#39;:&#39;M&#39;}).stack(stackDims)</span>

<span class="c1"># Convert to Pandas</span>
<span class="c1"># pd, _ = ep.multiDimXrToPD(basisPlot, colDims=stackDims)</span>

<span class="c1"># Subselect on pol state</span>
<span class="n">daPlot</span><span class="p">,</span> <span class="n">daPlotpd</span><span class="p">,</span> <span class="n">legendList</span><span class="p">,</span> <span class="n">gFig</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">lmPlot</span><span class="p">(</span><span class="n">basisProduct</span><span class="p">[</span><span class="n">basisKey</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">Labels</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">),</span> <span class="n">xDim</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">mDimLabel</span><span class="o">=</span><span class="s1">&#39;mu&#39;</span><span class="p">);</span> <span class="c1"># , cmap=&#39;vlag&#39;);  # Subselect on pol state</span>
<span class="c1"># ep.lmPlot(basisProduct[basisKey], xDim=&#39;t&#39;, cmap = cmap); # , cmap=&#39;vlag&#39;);  # Subselect on pol state</span>

<span class="c1"># Glue versions for JupyterBook output</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;polProd-linearRamp-lmPlot&quot;</span><span class="p">,</span> <span class="n">gFig</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set dataType (No dataType)
Plotting data (No filename), pType=a, thres=0.01, with Seaborn
</pre></div>
</div>
<img alt="../_images/dc52eda4839ef92e0bd42e710dcebaf1753faa2a7063a7fd4a2c99b8666b4d0b.png" src="../_images/dc52eda4839ef92e0bd42e710dcebaf1753faa2a7063a7fd4a2c99b8666b4d0b.png" />
</div>
</details>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Channel functions</span>
<span class="n">daPlot</span><span class="p">,</span> <span class="n">daPlotpd</span><span class="p">,</span> <span class="n">legendList</span><span class="p">,</span> <span class="n">gFig</span> <span class="o">=</span>  <span class="n">ep</span><span class="o">.</span><span class="n">lmPlot</span><span class="p">((</span><span class="n">basisProduct</span><span class="p">[</span><span class="s1">&#39;BLMtableResort&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">basisProduct</span><span class="p">[</span><span class="s1">&#39;polProd&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">Labels</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">({</span><span class="s1">&#39;S-Rp&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">})</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">xDim</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">mDimLabel</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">);</span>  <span class="c1"># Basic case</span>
<span class="c1"># ep.lmPlot((basis[&#39;BLMtableResort&#39;] * basis[&#39;polProd&#39;]), xDim=&#39;t&#39;, cmap=&#39;vlag&#39;);</span>

<span class="c1"># Glue versions for JupyterBook output</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;channelFunc-linearRamp-lmPlot&quot;</span><span class="p">,</span> <span class="n">gFig</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set dataType (No dataType)
Plotting data (No filename), pType=a, thres=0.01, with Seaborn
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No handles with labels found to put in legend.
</pre></div>
</div>
<img alt="../_images/33f17b18ddf9e22605b75c34c5a55ab35e721af79ecca54469259b5c1e0a4945.png" src="../_images/33f17b18ddf9e22605b75c34c5a55ab35e721af79ecca54469259b5c1e0a4945.png" />
</div>
</details>
</div>
<figure class="align-default" id="fig-polprod-linearramp">
<img alt="../_images/dc52eda4839ef92e0bd42e710dcebaf1753faa2a7063a7fd4a2c99b8666b4d0b.png" src="../_images/dc52eda4839ef92e0bd42e710dcebaf1753faa2a7063a7fd4a2c99b8666b4d0b.png" />
<figcaption>
<p><span class="caption-number">Fig. 3.10 </span><span class="caption-text">Example product basis function for the polarisation and ADM terms.</span><a class="headerlink" href="#fig-polprod-linearramp" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-default" id="fig-channelfunc-linearramp">
<img alt="../_images/33f17b18ddf9e22605b75c34c5a55ab35e721af79ecca54469259b5c1e0a4945.png" src="../_images/33f17b18ddf9e22605b75c34c5a55ab35e721af79ecca54469259b5c1e0a4945.png" />
<figcaption>
<p><span class="caption-number">Fig. 3.11 </span><span class="caption-text">Example of <span class="math notranslate nohighlight">\(\bar{\varUpsilon_{}}_{L,M}^{u,\zeta\zeta'}\)</span> basis values for various choices of alignment (as per <a class="reference internal" href="#fig-adms-linearramp"><span class="std std-numref">Fig. 3.7</span></a>), shown for <span class="math notranslate nohighlight">\(L=2\)</span> only. The basis essentially shows the obsevable terms if the ionization matrix elements are neglected, hence the sensitivity of the configuration to each pair of partial wave terms. Note, in general, that the sensitivity to any given pair $<span class="math notranslate nohighlight">\(\langle l',m'|l,m\rangle\)</span>, increases with alignment (hence with <span class="math notranslate nohighlight">\(t\)</span> in this example) for the linear polarisation case (<span class="math notranslate nohighlight">\(\mu=\mu'=0\)</span>), but typically decreases with alignment for cross-polarised terms.</span><a class="headerlink" href="#fig-channelfunc-linearramp" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./part1"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="theory_photoionization_dynamics_191122.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">3.2. </span>Photoionization dynamics</p>
      </div>
    </a>
    <a class="right-next"
       href="theory_density_matrices_310123.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">3.4. </span>Density matrix representation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#channel-functions">3.3.1. Channel functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#full-tensor-expansion">3.3.2. Full tensor expansion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#numerical-aside-symmetry-defined-channel-functions">3.3.3. Numerical aside: symmetry-defined channel functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#matrix-element-geometric-coupling-term-b-l-m">3.3.4. Matrix element geometric coupling term <span class="math notranslate nohighlight">\(B_{L,M}\)</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#electric-field-geometric-coupling-term-e-p-r-hat-e-mu-0">3.3.5. Electric field geometric coupling term <span class="math notranslate nohighlight">\({E_{P,R}(\hat{e};\mu_{0})}\)</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#molecular-frame-projection-term-lambda">3.3.6. Molecular frame projection term <span class="math notranslate nohighlight">\(\Lambda\)</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alignment-tensor-delta-l-m-k-q-s">3.3.7. Alignment tensor <span class="math notranslate nohighlight">\(\Delta_{L,M}(K,Q,S)\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-cases">3.3.7.1. Basic cases</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#d-alignments-and-symmetry-breaking">3.3.7.2. 3D alignments and symmetry breaking</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tensor-product-terms">3.3.8. Tensor product terms</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Paul Hockett with Varun Makhija
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>